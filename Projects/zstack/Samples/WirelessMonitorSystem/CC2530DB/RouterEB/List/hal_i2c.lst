###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         31/May/2015  21:39:49 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Componen #
#                          ts\hal\target\CC2530EB\hal_i2c.c                   #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\WirelessMonitorSystem\CC2530DB #
#                          \..\..\..\Tools\CC2530DB\f8wRouter.cfg"            #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8         #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "C:\Texas         #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\Too #
#                          ls\CC2530DB\f8wConfig.cfg" (-DZIGBEEPRO            #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=500         #
#                          -DQUEUED_POLL_RATE=30 -DRESPONSE_POLL_RATE=100)    #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Components\hal\ta #
#                          rget\CC2530EB\hal_i2c.c" -D NWK_MAX_DEVICE_LIST=3  #
#                          -lC "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Pro #
#                          jects\zstack\Samples\WirelessMonitorSystem\CC2530D #
#                          B\RouterEB\List\" -lA "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\RouterEB\Lis #
#                          t\" --diag_suppress Pe001,Pa010 -o "C:\Texas       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\RouterEB\Obj #
#                          \" -e --no_code_motion --debug --core=plain        #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\" -I         #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\WirelessMonitorSystem\CC2530DB\.. #
#                          \Source\" -I "C:\Texas Instruments\ZStack-CC2530-2 #
#                          .5.1a\Projects\zstack\Samples\WirelessMonitorSyste #
#                          m\CC2530DB\..\..\..\ZMain\TI2530DB\" -I "C:\Texas  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\hal\include\" -I "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\hal\target\CC2530EB\" -I "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\mac\include\" -I "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\mac\high_level\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\mac\low_level\srf04\" -I "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\mac\low_level\srf04\single_chip\"    #
#                          -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\WirelessMonitorSystem\CC2530DB #
#                          \..\..\..\..\..\Components\mt\" -I "C:\Texas       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\osal\include\" -I "C:\Texas          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\services\saddr\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\services\sdata\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\af\" -I "C:\Texas              #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\nwk\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\sapi\" -I "C:\Texas            #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\sec\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\sys\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\zdo\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\zmac\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\zmac\f8w\" -Ohz --require_prototypes #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\WirelessMonitorSystem\CC2530DB\Rou #
#                          terEB\List\hal_i2c.lst                             #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\WirelessMonitorSystem\CC2530DB\Rou #
#                          terEB\Obj\hal_i2c.r51                              #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.5.1a\Components\hal\target\CC2530EB\hal_i2c.c
      1          /**************************************************************************************************
      2            Filename:       hal_i2c.c
      3            Revised:        $Date: 2010-10-12 17:32:20 -0700 (Tue, 12 Oct 2010) $
      4            Revision:       $Revision: 24108 $
      5          
      6            Description:    I2C driver implementation.
      7          
      8          
      9            Copyright 2006 - 2010 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /**************************************************************************************************
     41              This file contains the I2C interface to off-chip serial EEPROM. While
     42              much of the driver is generic, certain portions are specific to the
     43              Atmel part AT24C1024. For example, the 17th address bit occurs in the
     44              device address byte where one of the address pins should be. Different
     45              1 Mb parts use a different bit location. This could be abstracted at
     46              a later time if this is the only differentce among these parts.
     47          **************************************************************************************************/
     48          
     49          #include "ioCC2530.h"

   \                                 In  segment SFR_AN, at 0x80
   \   union <unnamed> volatile __sfr _A_P0
   \                     _A_P0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf3
   \   unsigned char volatile __sfr P0SEL
   \                     P0SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf5
   \   unsigned char volatile __sfr P2SEL
   \                     P2SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf7
   \   unsigned char volatile __sfr P2INP
   \                     P2INP:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfd
   \   unsigned char volatile __sfr P0DIR
   \                     P0DIR:
   \   000000                DS 1
     50          #include "zcomdef.h"
     51          #include "hal_i2c.h"
     52          
     53          #define STATIC static
     54          
     55          #if !defined HAL_I2C_RETRY_CNT
     56          #define HAL_I2C_RETRY_CNT  3
     57          #endif
     58          
     59          // the default cofiguration below uses P1.6 for SDA and P0.0 for SCL.
     60          // change these as needed.
     61          /*
     62           *
     63           * ReverseTime: 2015/4/19
     64           * Author: smileboy
     65           * SCL P0.7  SDA P0.6
     66           * Change To :
     67           * p2_3, p2_4
     68           */
     69          // the vibrate must use p0_7 and p0_6
     70          #ifndef OCM_CLK_PORT
     71            #define OCM_CLK_PORT  0
     72          #endif
     73          
     74          #ifndef OCM_DATA_PORT
     75            #define OCM_DATA_PORT   0
     76          #endif
     77          
     78          #ifndef OCM_CLK_PIN
     79            #define OCM_CLK_PIN   7
     80          #endif
     81          
     82          #ifndef OCM_DATA_PIN
     83            #define OCM_DATA_PIN    6
     84          #endif
     85          
     86          // General I/O definitions
     87          #define IO_GIO  0  // General purpose I/O
     88          #define IO_PER  1  // Peripheral function
     89          #define IO_IN   0  // Input pin
     90          #define IO_OUT  1  // Output pin
     91          #define IO_PUD  0  // Pullup/pulldn input
     92          #define IO_TRI  1  // Tri-state input
     93          #define IO_PUP  0  // Pull-up input pin
     94          #define IO_PDN  1  // Pull-down input pin
     95          
     96          /**********************************************************
     97           *
     98           * Author: smileboy
     99           * ReverseTime: 2015/4/19
    100           * introduction: 
    101           *				just change this device address to ADXL345
    102           *********************************************************/
    103          #define	ADXL345_ADDRESS	(0x53)		// this is ADXL345 slave addr
    104          //#define OCM_ADDRESS  (0xA0)
    105          
    106          #define OCM_READ     (0x01)
    107          #define OCM_WRITE    (0x00)
    108          #define SMB_ACK      (0)
    109          #define SMB_NAK      (1)
    110          #define SEND_STOP    (0)
    111          #define NOSEND_STOP  (1)
    112          #define SEND_START   (0)
    113          #define NOSEND_START (1)
    114          
    115          // device specific as to where the 17th address bit goes...
    116          #define OCM_ADDRESS_BYTE(target,rw)  (OCM_ADDRESS | rw | ((target > 0xFFFF) ? 0x02 : 0x00))
    117          
    118          // *************************   MACROS   ************************************
    119          #undef P
    120          
    121            /* I/O PORT CONFIGURATION */
    122          #define CAT1(x,y) x##y  // Concatenates 2 strings
    123          #define CAT2(x,y) CAT1(x,y)  // Forces evaluation of CAT1
    124          
    125          // OCM port I/O defintions
    126          // Builds I/O port name: PNAME(1,INP) ==> P1INP
    127          #define PNAME(y,z) CAT2(P,CAT2(y,z))
    128          // Builds I/O bit name: BNAME(1,2) ==> P1_2
    129          #define BNAME(port,pin) CAT2(CAT2(P,port),CAT2(_,pin))
    130          
    131          // OCM port I/O defintions
    132          #define OCM_SCL BNAME(OCM_CLK_PORT, OCM_CLK_PIN)
    133          #define OCM_SDA BNAME(OCM_DATA_PORT, OCM_DATA_PIN)
    134          
    135          #define IO_DIR_PORT_PIN(port, pin, dir) \
    136          {\
    137            if ( dir == IO_OUT ) \
    138              PNAME(port,DIR) |= (1<<(pin)); \
    139            else \
    140              PNAME(port,DIR) &= ~(1<<(pin)); \
    141          }
    142          
    143          #define OCM_DATA_HIGH()\
    144          { \
    145            IO_DIR_PORT_PIN(OCM_DATA_PORT, OCM_DATA_PIN, IO_IN); \
    146          }
    147          
    148          #define OCM_DATA_LOW() \
    149          { \
    150            IO_DIR_PORT_PIN(OCM_DATA_PORT, OCM_DATA_PIN, IO_OUT); \
    151            OCM_SDA = 0;\
    152          }
    153          
    154          #define IO_FUNC_PORT_PIN(port, pin, func) \
    155          { \
    156            if( port < 2 ) \
    157            { \
    158              if ( func == IO_PER ) \
    159                PNAME(port,SEL) |= (1<<(pin)); \
    160              else \
    161                PNAME(port,SEL) &= ~(1<<(pin)); \
    162            } \
    163            else \
    164            { \
    165              if ( func == IO_PER ) \
    166                P2SEL |= (1<<(pin>>1)); \
    167              else \
    168                P2SEL &= ~(1<<(pin>>1)); \
    169            } \
    170          }
    171          
    172          #define IO_IMODE_PORT_PIN(port, pin, mode) \
    173          { \
    174            if ( mode == IO_TRI ) \
    175              PNAME(port,INP) |= (1<<(pin)); \
    176            else \
    177              PNAME(port,INP) &= ~(1<<(pin)); \
    178          }
    179          
    180          #define IO_PUD_PORT(port, dir) \
    181          { \
    182            if ( dir == IO_PDN ) \
    183              P2INP |= (1<<(port+5)); \
    184            else \
    185              P2INP &= ~(1<<(port+5)); \
    186          }
    187          
    188          STATIC void   hali2cSend( uint8 *buffer, uint16 len, uint8 sendStart, uint8 sendStop );
    189          STATIC _Bool  hali2cSendByte( uint8 dByte );
    190          STATIC void   hali2cWrite( bool dBit );
    191          STATIC void   hali2cClock( bool dir );
    192          STATIC void   hali2cStart( void );
    193          STATIC void   hali2cStop( void );
    194          STATIC void   hali2cReceive( uint8 address, uint8 *buffer, uint16 len );
    195          STATIC uint8  hali2cReceiveByte( void );
    196          STATIC _Bool  hali2cRead( void );
    197          STATIC void   hali2cSendDeviceAddress(uint8 address);
    198          
    199          
    200          STATIC __near_func void   hali2cWait( uint8 );
    201          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    202          STATIC uint8 s_xmemIsInit;
   \                     s_xmemIsInit:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    203          
    204          /*********************************************************************
    205           * @fn      HalI2CInit
    206           * @brief   Initializes two-wire serial I/O bus
    207           * @param   void
    208           * @return  void
    209           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    210          void HalI2CInit( void )
   \                     HalI2CInit:
    211          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    212            if (!s_xmemIsInit)  {
   \   000004   90....       MOV     DPTR,#s_xmemIsInit
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7019         JNZ     ??HalI2CInit_0
    213              s_xmemIsInit = 1;
   \   00000A   7401         MOV     A,#0x1
   \   00000C   F0           MOVX    @DPTR,A
    214          
    215              // Set port pins as inputs
    216              IO_DIR_PORT_PIN( OCM_CLK_PORT, OCM_CLK_PIN, IO_IN );
   \   00000D   53FD7F       ANL     0xfd,#0x7f
    217              IO_DIR_PORT_PIN( OCM_DATA_PORT, OCM_DATA_PIN, IO_IN );
   \   000010   53FDBF       ANL     0xfd,#0xbf
    218          
    219              // Set for general I/O operation
    220              IO_FUNC_PORT_PIN( OCM_CLK_PORT, OCM_CLK_PIN, IO_GIO );
   \   000013   53F37F       ANL     0xf3,#0x7f
    221              IO_FUNC_PORT_PIN( OCM_DATA_PORT, OCM_DATA_PIN, IO_GIO );
   \   000016   53F3BF       ANL     0xf3,#0xbf
    222          
    223              // Set I/O mode for pull-up/pull-down
    224              IO_IMODE_PORT_PIN( OCM_CLK_PORT, OCM_CLK_PIN, IO_PUD );
   \   000019   C287         CLR     0x80.7
    225              IO_IMODE_PORT_PIN( OCM_DATA_PORT, OCM_DATA_PIN, IO_PUD );
   \   00001B   C286         CLR     0x80.6
    226          
    227              // Set pins to pull-up
    228              IO_PUD_PORT( OCM_CLK_PORT, IO_PUP );
   \   00001D   53F7DF       ANL     0xf7,#0xdf
    229              IO_PUD_PORT( OCM_DATA_PORT, IO_PUP );
   \   000020   53F7DF       ANL     0xf7,#0xdf
    230            }
    231          }
   \                     ??HalI2CInit_0:
   \   000023                REQUIRE ?Subroutine0
   \   000023                REQUIRE P0DIR
   \   000023                REQUIRE P0SEL
   \   000023                REQUIRE P2SEL
   \   000023                REQUIRE _A_P0
   \   000023                REQUIRE P2INP
   \   000023                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    232          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    233          uint8 HalI2CReceive(uint8 address, uint8 *buf, uint16 len)
   \                     HalI2CReceive:
    234          {
   \   000000   74F3         MOV     A,#-0xd
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 13
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
    235            hali2cReceive(address, buf, len);
   \   00000D   EC           MOV     A,R4
   \   00000E   45..         ORL     A,?V0 + 1
   \   000010   6036         JZ      ??HalI2CReceive_0
   \   000012                ; Setup parameters for call to function hali2cSendDeviceAddress
   \   000012   12....       LCALL   ??hali2cSendDeviceAddress?relay
   \   000015   75..00       MOV     ?V0 + 2,#0x0
   \   000018   75..00       MOV     ?V0 + 3,#0x0
   \   00001B   800B         SJMP    ??CrossCallReturnLabel_4
   \                     ??HalI2CReceive_1:
   \   00001D                ; Setup parameters for call to function hali2cClock
   \   00001D   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000020                ; Setup parameters for call to function hali2cWrite
   \   000020   7900         MOV     R1,#0x0
   \   000022   12....       LCALL   ??hali2cWrite?relay
   \   000025   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000028   E5..         MOV     A,?V0 + 0
   \   00002A   24FF         ADD     A,#-0x1
   \   00002C   F8           MOV     R0,A
   \   00002D   E5..         MOV     A,?V0 + 1
   \   00002F   34FF         ADDC    A,#-0x1
   \   000031   F9           MOV     R1,A
   \   000032   C3           CLR     C
   \   000033   E5..         MOV     A,?V0 + 2
   \   000035   98           SUBB    A,R0
   \   000036   E5..         MOV     A,?V0 + 3
   \   000038   99           SUBB    A,R1
   \   000039   7900         MOV     R1,#0x0
   \   00003B   40E0         JC      ??HalI2CReceive_1
   \   00003D                ; Setup parameters for call to function hali2cClock
   \   00003D   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000040                ; Setup parameters for call to function hali2cWrite
   \   000040   7901         MOV     R1,#0x1
   \   000042   12....       LCALL   ??hali2cWrite?relay
   \   000045                ; Setup parameters for call to function hali2cStop
   \   000045   12....       LCALL   ??hali2cStop?relay
    236          
    237            return 0;
   \                     ??HalI2CReceive_0:
   \   000048   7900         MOV     R1,#0x0
   \   00004A   7F05         MOV     R7,#0x5
   \   00004C   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   00004F                REQUIRE P0DIR
    238          }
    239          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    240          uint8 HalI2CSend(uint8 address, uint8 *buf, uint16 len)
   \                     HalI2CSend:
    241          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
    242            // begin the write sequence with the address byte
    243            hali2cSendDeviceAddress(address);
   \   00000D                ; Setup parameters for call to function hali2cSendDeviceAddress
   \   00000D   12....       LCALL   ??hali2cSendDeviceAddress?relay
    244            hali2cSend(buf, len, NOSEND_START, SEND_STOP);
   \   000010   75..03       MOV     ?V0 + 5,#0x3
   \   000013   EE           MOV     A,R6
   \   000014   4F           ORL     A,R7
   \   000015   602E         JZ      ??HalI2CSend_0
   \   000017   75..00       MOV     ?V0 + 2,#0x0
   \   00001A   75..00       MOV     ?V0 + 3,#0x0
   \                     ??HalI2CSend_1:
   \   00001D                ; Setup parameters for call to function hali2cSendByte
   \   00001D   E5..         MOV     A,?V0 + 0
   \   00001F   25..         ADD     A,?V0 + 2
   \   000021   F582         MOV     DPL,A
   \   000023   E5..         MOV     A,?V0 + 1
   \   000025   35..         ADDC    A,?V0 + 3
   \   000027   F583         MOV     DPH,A
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F9           MOV     R1,A
   \   00002B   12....       LCALL   ??hali2cSendByte?relay
   \   00002E   4006         JC      ??HalI2CSend_2
   \   000030   15..         DEC     ?V0 + 5
   \   000032   E5..         MOV     A,?V0 + 5
   \   000034   70E7         JNZ     ??HalI2CSend_1
   \                     ??HalI2CSend_2:
   \   000036   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000039   C3           CLR     C
   \   00003A   E5..         MOV     A,?V0 + 2
   \   00003C   9E           SUBB    A,R6
   \   00003D   E5..         MOV     A,?V0 + 3
   \   00003F   9F           SUBB    A,R7
   \   000040   40DB         JC      ??HalI2CSend_1
   \   000042                ; Setup parameters for call to function hali2cStop
   \   000042   12....       LCALL   ??hali2cStop?relay
    245          
    246            return 0;
   \                     ??HalI2CSend_0:
   \   000045   7900         MOV     R1,#0x0
   \   000047   7F06         MOV     R7,#0x6
   \   000049   02....       LJMP    ?BANKED_LEAVE_XDATA
    247          }
    248          
    249          /////////////////////////////////////////////////////////////
    250          // ADXL345 Vibrate Sensor
    251          //STATIC void   hali2cSend( uint8 *buffer, uint16 len, uint8 sendStart, uint8 sendStop );
    252          //STATIC _Bool  hali2cSendByte( uint8 dByte );
    253          //STATIC void   hali2cWrite( bool dBit );
    254          //STATIC void   hali2cClock( bool dir );
    255          //STATIC void   hali2cStart( void );
    256          //STATIC void   hali2cStop( void );
    257          //STATIC void   hali2cReceive( uint8 address, uint8 *buffer, uint16 len );
    258          //STATIC uint8  hali2cReceiveByte( void );
    259          //STATIC _Bool  hali2cRead( void );
    260          //STATIC void   hali2cSendDeviceAddress(uint8 address);

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    261          void ADXL345WriteByte(byte address, byte value)
   \                     ADXL345WriteByte:
    262          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FF           MOV     R7,A
    263            // Address and W/R bit
    264            byte firstByte = 0x00;
    265            // wait turns to receive the slave ack
    266            uint8 retry = HAL_I2C_RETRY_CNT;
   \   000009   7E03         MOV     R6,#0x3
    267            
    268            // Send the start condition
    269            hali2cStart();
   \   00000B                ; Setup parameters for call to function hali2cStart
   \   00000B   12....       LCALL   ??hali2cStart?relay
    270            
    271            // Send the slave address + w flag
    272            firstByte = 0xA6;	
    273            do {
    274                if ( hali2cSendByte(firstByte) )  // takes care of ack polling
   \                     ??ADXL345WriteByte_0:
   \   00000E                ; Setup parameters for call to function hali2cSendByte
   \   00000E   79A6         MOV     R1,#-0x5a
   \   000010   12....       LCALL   ??hali2cSendByte?relay
   \   000013   5004         JNC     ??ADXL345WriteByte_1
    275                {
    276          		retry = HAL_I2C_RETRY_CNT;
   \   000015   7E03         MOV     R6,#0x3
    277                  break;
   \   000017   8004         SJMP    ??ADXL345WriteByte_2
    278                }
    279            } while ( --retry );
   \                     ??ADXL345WriteByte_1:
   \   000019   1E           DEC     R6
   \   00001A   EE           MOV     A,R6
   \   00001B   70F1         JNZ     ??ADXL345WriteByte_0
    280            
    281            // Send the reg address
    282            do {
    283                if ( hali2cSendByte(address) )  // takes care of ack polling
   \                     ??ADXL345WriteByte_2:
   \   00001D                ; Setup parameters for call to function hali2cSendByte
   \   00001D   A9..         MOV     R1,?V0 + 0
   \   00001F   12....       LCALL   ??hali2cSendByte?relay
   \   000022   5004         JNC     ??ADXL345WriteByte_3
    284                {
    285          		retry = HAL_I2C_RETRY_CNT;
   \   000024   7E03         MOV     R6,#0x3
    286                  break;
   \   000026   8004         SJMP    ??ADXL345WriteByte_4
    287                }
    288            } while ( --retry );
   \                     ??ADXL345WriteByte_3:
   \   000028   1E           DEC     R6
   \   000029   EE           MOV     A,R6
   \   00002A   70F1         JNZ     ??ADXL345WriteByte_2
    289            
    290            // Send the value
    291            do {
    292                if ( hali2cSendByte(value) )  // takes care of ack polling
   \                     ??ADXL345WriteByte_4:
   \   00002C                ; Setup parameters for call to function hali2cSendByte
   \   00002C   EF           MOV     A,R7
   \   00002D   F9           MOV     R1,A
   \   00002E   12....       LCALL   ??hali2cSendByte?relay
   \   000031   4004         JC      ??ADXL345WriteByte_5
    293                {
    294                  break;
    295                }
    296            } while ( --retry );
   \   000033   1E           DEC     R6
   \   000034   EE           MOV     A,R6
   \   000035   70F5         JNZ     ??ADXL345WriteByte_4
    297            
    298            // Send stop condition
    299            hali2cStop();
   \                     ??ADXL345WriteByte_5:
   \   000037                ; Setup parameters for call to function hali2cStop
   \   000037   12....       LCALL   ??hali2cStop?relay
    300          }
   \   00003A   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    301          
    302          /*****************************************************************************
    303           *
    304           *
    305           *	Read ADXL345
    306           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    307          byte ADXL345ReadByte(byte address)
   \                     ADXL345ReadByte:
    308          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FF           MOV     R7,A
    309            // address and W/R bit
    310            byte firstByte = 0x00;
    311            // reserve the read byte
    312            byte value = 0x00;
    313            
    314            // wait turns to receive the slave ack
    315            uint8 retry = HAL_I2C_RETRY_CNT;
   \   000007   7E03         MOV     R6,#0x3
    316            
    317            // Send the start condition
    318            hali2cStart();
   \   000009                ; Setup parameters for call to function hali2cStart
   \   000009   12....       LCALL   ??hali2cStart?relay
    319            
    320            // Send the slave address and wirte bit
    321            firstByte = 0xA6;	
    322            do {
    323                if ( hali2cSendByte(firstByte) )  // takes care of ack polling
   \                     ??ADXL345ReadByte_0:
   \   00000C                ; Setup parameters for call to function hali2cSendByte
   \   00000C   79A6         MOV     R1,#-0x5a
   \   00000E   12....       LCALL   ??hali2cSendByte?relay
   \   000011   5004         JNC     ??ADXL345ReadByte_1
    324                {
    325          		retry = HAL_I2C_RETRY_CNT;
   \   000013   7E03         MOV     R6,#0x3
    326                  break;
   \   000015   8004         SJMP    ??ADXL345ReadByte_2
    327                }
    328            } while ( --retry );
   \                     ??ADXL345ReadByte_1:
   \   000017   1E           DEC     R6
   \   000018   EE           MOV     A,R6
   \   000019   70F1         JNZ     ??ADXL345ReadByte_0
    329            
    330            // Send the reg address
    331            do {
    332                if ( hali2cSendByte(address) )  // takes care of ack polling
   \                     ??ADXL345ReadByte_2:
   \   00001B                ; Setup parameters for call to function hali2cSendByte
   \   00001B   EF           MOV     A,R7
   \   00001C   F9           MOV     R1,A
   \   00001D   12....       LCALL   ??hali2cSendByte?relay
   \   000020   5004         JNC     ??ADXL345ReadByte_3
    333                {
    334          		retry = HAL_I2C_RETRY_CNT;
   \   000022   7E03         MOV     R6,#0x3
    335                  break;
   \   000024   8004         SJMP    ??ADXL345ReadByte_4
    336                }
    337            } while ( --retry );
   \                     ??ADXL345ReadByte_3:
   \   000026   1E           DEC     R6
   \   000027   EE           MOV     A,R6
   \   000028   70F1         JNZ     ??ADXL345ReadByte_2
    338            
    339            // Send the start condition again
    340            hali2cStart();
   \                     ??ADXL345ReadByte_4:
   \   00002A                ; Setup parameters for call to function hali2cStart
   \   00002A   12....       LCALL   ??hali2cStart?relay
    341            
    342            // Send the slave address and read bit
    343            firstByte = 0xA7;
    344            do {
    345                if ( hali2cSendByte(firstByte) )  // takes care of ack polling
   \                     ??ADXL345ReadByte_5:
   \   00002D                ; Setup parameters for call to function hali2cSendByte
   \   00002D   79A7         MOV     R1,#-0x59
   \   00002F   12....       LCALL   ??hali2cSendByte?relay
   \   000032   4004         JC      ??ADXL345ReadByte_6
    346                {
    347          		retry = HAL_I2C_RETRY_CNT;
    348                  break;
    349                }
    350            } while ( --retry );
   \   000034   1E           DEC     R6
   \   000035   EE           MOV     A,R6
   \   000036   70F5         JNZ     ??ADXL345ReadByte_5
    351            
    352            // Read a byte from ADXL345
    353            value = hali2cReceiveByte();
   \                     ??ADXL345ReadByte_6:
   \   000038                ; Setup parameters for call to function hali2cReceiveByte
   \   000038   12....       LCALL   ??hali2cReceiveByte?relay
   \   00003B   E9           MOV     A,R1
   \   00003C   FE           MOV     R6,A
    354            
    355            // write NACK
    356            hali2cWrite(SMB_NAK);
   \   00003D                ; Setup parameters for call to function hali2cWrite
   \   00003D   7901         MOV     R1,#0x1
   \   00003F   12....       LCALL   ??hali2cWrite?relay
    357            
    358            // Send stop condition
    359            hali2cStop();
   \   000042                ; Setup parameters for call to function hali2cStop
   \   000042   12....       LCALL   ??hali2cStop?relay
    360            
    361            return value;
   \   000045   EE           MOV     A,R6
   \   000046   F9           MOV     R1,A
   \   000047   02....       LJMP    ?Subroutine1 & 0xFFFF
    362          }
    363          
    364          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    365          void ADXL345ReadBytes(uint8 startAddr, uint8* buffer, uint8 len)
   \                     ADXL345ReadBytes:
    366          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 4,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
   \   00000B   8C..         MOV     ?V0 + 6,R4
    367            // wait turns to receive the slave ack
    368            uint8 retry = HAL_I2C_RETRY_CNT;
   \   00000D   75..03       MOV     ?V0 + 0,#0x3
    369            // 7-bit address and W/R bit
    370            byte firstByte = 0x00;
    371            
    372            byte i = 0;
    373            
    374            // Send start condition
    375            hali2cStart();
   \   000010                ; Setup parameters for call to function hali2cStart
   \   000010   12....       LCALL   ??hali2cStart?relay
    376            
    377            // Send the slave address and wirte bit
    378            firstByte = 0xA6;	// seven-bit slave address and write bit '0', 0x1111_1110
    379            do {
    380                if ( hali2cSendByte(firstByte) )  // takes care of ack polling
   \                     ??ADXL345ReadBytes_0:
   \   000013                ; Setup parameters for call to function hali2cSendByte
   \   000013   79A6         MOV     R1,#-0x5a
   \   000015   12....       LCALL   ??hali2cSendByte?relay
   \   000018   5005         JNC     ??ADXL345ReadBytes_1
    381                {
    382          		retry = HAL_I2C_RETRY_CNT;
   \   00001A   75..03       MOV     ?V0 + 0,#0x3
    383                  break;
   \   00001D   8006         SJMP    ??ADXL345ReadBytes_2
    384                }
    385            } while ( --retry );
   \                     ??ADXL345ReadBytes_1:
   \   00001F   15..         DEC     ?V0 + 0
   \   000021   E5..         MOV     A,?V0 + 0
   \   000023   70EE         JNZ     ??ADXL345ReadBytes_0
    386            
    387            // Send the reg address
    388            do {
    389                if ( hali2cSendByte(startAddr) )  // takes care of ack polling
   \                     ??ADXL345ReadBytes_2:
   \   000025                ; Setup parameters for call to function hali2cSendByte
   \   000025   A9..         MOV     R1,?V0 + 4
   \   000027   12....       LCALL   ??hali2cSendByte?relay
   \   00002A   5005         JNC     ??ADXL345ReadBytes_3
    390                {
    391          		retry = HAL_I2C_RETRY_CNT;
   \   00002C   75..03       MOV     ?V0 + 0,#0x3
    392                  break;
   \   00002F   8006         SJMP    ??ADXL345ReadBytes_4
    393                }
    394            } while ( --retry );
   \                     ??ADXL345ReadBytes_3:
   \   000031   15..         DEC     ?V0 + 0
   \   000033   E5..         MOV     A,?V0 + 0
   \   000035   70EE         JNZ     ??ADXL345ReadBytes_2
    395            
    396            // this is the repeat start condition
    397            hali2cStart();
   \                     ??ADXL345ReadBytes_4:
   \   000037                ; Setup parameters for call to function hali2cStart
   \   000037   12....       LCALL   ??hali2cStart?relay
    398            
    399            // Send the slave address and read bit
    400            firstByte = 0xA7;	
    401            do {
    402                if ( hali2cSendByte(firstByte) )  // takes care of ack polling
   \                     ??ADXL345ReadBytes_5:
   \   00003A                ; Setup parameters for call to function hali2cSendByte
   \   00003A   79A7         MOV     R1,#-0x59
   \   00003C   12....       LCALL   ??hali2cSendByte?relay
   \   00003F   4006         JC      ??ADXL345ReadBytes_6
    403                {
    404          		retry = HAL_I2C_RETRY_CNT;
    405                  break;
    406                }
    407            } while ( --retry );
   \   000041   15..         DEC     ?V0 + 0
   \   000043   E5..         MOV     A,?V0 + 0
   \   000045   70F3         JNZ     ??ADXL345ReadBytes_5
    408            
    409            // read several bytes
    410            for ( i = 0; i<len-1; i++ )
   \                     ??ADXL345ReadBytes_6:
   \   000047   75..00       MOV     ?V0 + 5,#0x0
   \   00004A   8017         SJMP    ??ADXL345ReadBytes_7
    411            {
    412              // SCL may be high. set SCL low. If SDA goes high when input
    413              // mode is set the slave won't see a STOP
    414              hali2cClock(0);
   \                     ??ADXL345ReadBytes_8:
   \   00004C                ; Setup parameters for call to function hali2cClock
   \   00004C   7900         MOV     R1,#0x0
   \   00004E   12....       LCALL   ?Subroutine7 & 0xFFFF
    415              OCM_DATA_HIGH();
    416          
    417              buffer[i] = hali2cReceiveByte();
   \                     ??CrossCallReturnLabel_9:
   \   000051   25..         ADD     A,?V0 + 0
   \   000053   F582         MOV     DPL,A
   \   000055   EF           MOV     A,R7
   \   000056   3400         ADDC    A,#0x0
   \   000058   F583         MOV     DPH,A
   \   00005A   E9           MOV     A,R1
   \   00005B   F0           MOVX    @DPTR,A
    418              hali2cWrite(SMB_ACK);           // write leaves SCL high
   \   00005C                ; Setup parameters for call to function hali2cWrite
   \   00005C   7900         MOV     R1,#0x0
   \   00005E   12....       LCALL   ??hali2cWrite?relay
    419            }
   \   000061   05..         INC     ?V0 + 5
   \                     ??ADXL345ReadBytes_7:
   \   000063   85....       MOV     ?V0 + 0,?V0 + 5
   \   000066   85....       MOV     ?V0 + 2,?V0 + 6
   \   000069   E5..         MOV     A,?V0 + 2
   \   00006B   24FF         ADD     A,#-0x1
   \   00006D   F8           MOV     R0,A
   \   00006E   E4           CLR     A
   \   00006F   34FF         ADDC    A,#-0x1
   \   000071   F9           MOV     R1,A
   \   000072   C3           CLR     C
   \   000073   E5..         MOV     A,?V0 + 0
   \   000075   98           SUBB    A,R0
   \   000076   E4           CLR     A
   \   000077   99           SUBB    A,R1
   \   000078   A2D2         MOV     C,0xD0 /* PSW */.2
   \   00007A   65D0         XRL     A,PSW
   \   00007C   33           RLC     A
   \   00007D   40CD         JC      ??ADXL345ReadBytes_8
    420            
    421            // condition SDA one more time...
    422          //  hali2cClock(0);
    423          //  OCM_DATA_HIGH();
    424          //  buffer[i] = hali2cReceiveByte();
    425          //  hali2cWrite(SMB_NAK);
    426            
    427            // Send stop condition
    428            hali2cStop();
   \   00007F                ; Setup parameters for call to function hali2cStop
   \   00007F   12....       LCALL   ??hali2cStop?relay
    429          }
   \   000082   7F07         MOV     R7,#0x7
   \   000084   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000087                REQUIRE P0DIR

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   12....       LCALL   ??hali2cClock?relay
   \   000003   53FDBF       ANL     0xfd,#0xbf
   \   000006                ; Setup parameters for call to function hali2cReceiveByte
   \   000006                ; Setup parameters for call to function hali2cReceiveByte
   \   000006                ; Setup parameters for call to function hali2cReceiveByte
   \   000006   12....       LCALL   ??hali2cReceiveByte?relay
   \   000009   EE           MOV     A,R6
   \   00000A   22           RET
    430          
    431          
    432          
    433          /*********************************************************************
    434           * @fn      hali2cSend
    435           * @brief   Sends buffer contents to SM-Bus device
    436           * @param   buffer - ptr to buffered data to send
    437           * @param   len - number of bytes in buffer
    438           * @param   sendStart - whether or not to send start condition.
    439           * @param   sendStop - whether or not to send stop condition.
    440           * @return  void
    441           */
    442          STATIC void hali2cSend( uint8 *buffer, uint16 len, uint8 sendStart, uint8 sendStop )
    443          {
    444            uint16 i;
    445            uint8 retry = HAL_I2C_RETRY_CNT;
    446          
    447            if (!len)  {
    448              return;
    449            }
    450          
    451            if (sendStart == SEND_START)  {
    452              hali2cStart();
    453            }
    454          
    455            for ( i = 0; i < len; i++ )
    456            {
    457              do {
    458                if ( hali2cSendByte( buffer[i] ) )  // takes care of ack polling
    459                {
    460                  break;
    461                }
    462              } while ( --retry );
    463            }
    464          
    465            if (sendStop == SEND_STOP) {
    466              hali2cStop();
    467            }
    468          }
    469          
    470          /*********************************************************************
    471           * @fn      hali2cSendByte
    472           * @brief   Serialize and send one byte to SM-Bus device
    473           * @param   dByte - data byte to send
    474           * @return  ACK status - 0=none, 1=received
    475           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    476          STATIC _Bool hali2cSendByte( uint8 dByte )
   \                     hali2cSendByte:
    477          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FF           MOV     R7,A
    478            uint8 i;
    479          
    480            for ( i = 0; i < 8; i++ )
   \   000007   7E08         MOV     R6,#0x8
    481            {
    482              // Send the MSB
    483              hali2cWrite( dByte & 0x80 );
   \                     ??hali2cSendByte_0:
   \   000009                ; Setup parameters for call to function hali2cWrite
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??hali2cWrite?relay
    484              // Next bit into MSB
    485              dByte <<= 1;
   \   000010   EF           MOV     A,R7
   \   000011   C3           CLR     C
   \   000012   33           RLC     A
   \   000013   FF           MOV     R7,A
    486            }
   \   000014   1E           DEC     R6
   \   000015   EE           MOV     A,R6
   \   000016   70F1         JNZ     ??hali2cSendByte_0
    487            // need clock low so if the SDA transitions on the next statement the
    488            // slave doesn't stop. Also give opportunity for slave to set SDA
    489            hali2cClock( 0 );
   \   000018                ; Setup parameters for call to function hali2cClock
   \   000018   12....       LCALL   ?Subroutine3 & 0xFFFF
    490            OCM_DATA_HIGH(); // set to input to receive ack...
    491            hali2cClock( 1 );
    492            hali2cWait(1);
    493          
    494            return ( !OCM_SDA );  // Return ACK status
   \                     ??CrossCallReturnLabel_2:
   \   00001B   A286         MOV     C,0x80.6
   \   00001D   B3           CPL     C
   \   00001E   80..         SJMP    ?Subroutine1
   \   000020                REQUIRE P0DIR
   \   000020                REQUIRE _A_P0
    495          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7900         MOV     R1,#0x0
   \   000002   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000005   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   12....       LCALL   ??hali2cClock?relay
   \   000003   53FDBF       ANL     0xfd,#0xbf
   \   000006                ; Setup parameters for call to function hali2cClock
   \   000006                ; Setup parameters for call to function hali2cClock
   \   000006                ; Setup parameters for call to function hali2cWait
   \   000006   7901         MOV     R1,#0x1
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   12....       LCALL   ??hali2cClock?relay
   \   000003                ; Setup parameters for call to function hali2cWait
   \   000003                ; Setup parameters for call to function hali2cWait
   \   000003                ; Setup parameters for call to function hali2cWait
   \   000003                ; Setup parameters for call to function hali2cWait
   \   000003                ; Setup parameters for call to function hali2cWait
   \   000003                ; Setup parameters for call to function hali2cWait
   \   000003   7901         MOV     R1,#0x1
   \   000005   12....       LCALL   hali2cWait & 0xFFFF
   \   000008   22           RET
    496          
    497          /*********************************************************************
    498           * @fn      hali2cWrite
    499           * @brief   Send one bit to SM-Bus device
    500           * @param   dBit - data bit to clock onto SM-Bus
    501           * @return  void
    502           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    503          STATIC void hali2cWrite( bool dBit )
   \                     hali2cWrite:
    504          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    505            hali2cClock( 0 );
   \   000007                ; Setup parameters for call to function hali2cClock
   \   000007   12....       LCALL   ?Subroutine4 & 0xFFFF
    506            hali2cWait(1);
    507            if ( dBit )
   \                     ??CrossCallReturnLabel_12:
   \   00000A   EE           MOV     A,R6
   \   00000B   6005         JZ      ??hali2cWrite_0
    508            {
    509              OCM_DATA_HIGH();
   \   00000D   53FDBF       ANL     0xfd,#0xbf
   \   000010   8005         SJMP    ??hali2cWrite_1
    510            }
    511            else
    512            {
    513              OCM_DATA_LOW();
   \                     ??hali2cWrite_0:
   \   000012   43FD40       ORL     0xfd,#0x40
   \   000015   C286         CLR     0x80.6
    514            }
    515          
    516            hali2cClock( 1 );
   \                     ??hali2cWrite_1:
   \   000017                ; Setup parameters for call to function hali2cClock
   \   000017   7901         MOV     R1,#0x1
   \   000019   12....       LCALL   ??Subroutine10_0 & 0xFFFF
    517            hali2cWait(1);
    518          }
   \                     ??CrossCallReturnLabel_13:
   \   00001C                REQUIRE ?Subroutine1
   \   00001C                REQUIRE P0DIR
   \   00001C                REQUIRE _A_P0
   \   00001C                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7900         MOV     R1,#0x0
   \   000002                REQUIRE ??Subroutine10_0
   \   000002                ; // Fall through to label ??Subroutine10_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine10_0:
   \   000000   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   000003   22           RET
    519          
    520          /*********************************************************************
    521           * @fn      hali2cClock
    522           * @brief   Clocks the SM-Bus. If a negative edge is going out, the
    523           *          I/O pin is set as an output and driven low. If a positive
    524           *          edge is going out, the pin is set as an input and the pin
    525           *          pull-up drives the line high. This way, the slave device
    526           *          can hold the node low if longer setup time is desired.
    527           * @param   dir - clock line direction
    528           * @return  void
    529           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    530          STATIC void hali2cClock( bool dir )
   \                     hali2cClock:
    531          {
   \   000000   EE           MOV     A,R6
   \   000001   C0E0         PUSH    A
   \   000003                ; Saved register size: 1
   \   000003                ; Auto size: 0
   \   000003   E9           MOV     A,R1
    532            if ( dir )
   \   000004   6005         JZ      ??hali2cClock_0
    533            {
    534              IO_DIR_PORT_PIN( OCM_CLK_PORT, OCM_CLK_PIN, IO_IN );
   \   000006   53FD7F       ANL     0xfd,#0x7f
   \   000009   8005         SJMP    ??hali2cClock_1
    535            }
    536            else
    537            {
    538              IO_DIR_PORT_PIN( OCM_CLK_PORT, OCM_CLK_PIN, IO_OUT );
   \                     ??hali2cClock_0:
   \   00000B   43FD80       ORL     0xfd,#0x80
    539              OCM_SCL = 0;
   \   00000E   C287         CLR     0x80.7
    540            }
    541            hali2cWait(1);
   \                     ??hali2cClock_1:
   \   000010                ; Setup parameters for call to function hali2cWait
   \   000010   7901         MOV     R1,#0x1
   \   000012   12....       LCALL   hali2cWait & 0xFFFF
    542          }
   \   000015   D0E0         POP     A
   \   000017   FE           MOV     R6,A
   \   000018   02....       LJMP    ?BRET
   \   00001B                REQUIRE P0DIR
   \   00001B                REQUIRE _A_P0
    543          
    544          /*********************************************************************
    545           * @fn      hali2cStart
    546           * @brief   Initiates SM-Bus communication. Makes sure that both the
    547           *          clock and data lines of the SM-Bus are high. Then the data
    548           *          line is set high and clock line is set low to start I/O.
    549           * @param   void
    550           * @return  void
    551           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    552          STATIC void hali2cStart( void )
   \                     hali2cStart:
    553          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    554            uint8 retry = HAL_I2C_RETRY_CNT;
   \   000005   7E03         MOV     R6,#0x3
    555          
    556            // set SCL to input but with pull-up. if slave is pulling down it will stay down.
    557            hali2cClock(1);
   \   000007                ; Setup parameters for call to function hali2cClock
   \   000007   7901         MOV     R1,#0x1
   \   000009   12....       LCALL   ??hali2cClock?relay
    558          
    559            do {
    560              // wait for slave to release clock line...
    561              if (OCM_SCL)  // wait until the line is high...
   \                     ??hali2cStart_0:
   \   00000C   A287         MOV     C,0x80.7
   \   00000E   4009         JC      ??hali2cStart_1
    562              {
    563                break;
    564              }
    565              hali2cWait(1);
   \   000010                ; Setup parameters for call to function hali2cWait
   \   000010   7901         MOV     R1,#0x1
   \   000012   12....       LCALL   hali2cWait & 0xFFFF
    566            } while ( --retry );
   \   000015   1E           DEC     R6
   \   000016   EE           MOV     A,R6
   \   000017   70F3         JNZ     ??hali2cStart_0
    567          
    568            // SCL low to set SDA high so the transition will be correct.
    569            hali2cClock(0);
   \                     ??hali2cStart_1:
   \   000019                ; Setup parameters for call to function hali2cClock
   \   000019   12....       LCALL   ?Subroutine3 & 0xFFFF
    570            OCM_DATA_HIGH();  // SDA high
    571            hali2cClock(1);   // set up for transition
    572            hali2cWait(1);
    573            OCM_DATA_LOW();   // start
   \                     ??CrossCallReturnLabel_3:
   \   00001C   12....       LCALL   ?Subroutine6 & 0xFFFF
    574          
    575            hali2cWait(1);
    576            hali2cClock( 0 );
   \                     ??CrossCallReturnLabel_6:
   \   00001F                ; Setup parameters for call to function hali2cClock
   \   00001F   7900         MOV     R1,#0x0
   \   000021   12....       LCALL   ??hali2cClock?relay
    577          }
   \   000024   80..         SJMP    ?Subroutine1
   \   000026                REQUIRE _A_P0
   \   000026                REQUIRE P0DIR

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   43FD40       ORL     0xfd,#0x40
   \   000003   C286         CLR     0x80.6
   \   000005                ; Setup parameters for call to function hali2cWait
   \   000005                ; Setup parameters for call to function hali2cWait
   \   000005   7901         MOV     R1,#0x1
   \   000007   12....       LCALL   hali2cWait & 0xFFFF
   \   00000A   22           RET
    578          
    579          /*********************************************************************
    580           * @fn      hali2cStop
    581           * @brief   Terminates SM-Bus communication. Waits unitl the data line
    582           *          is low and the clock line is high. Then sets the data line
    583           *          high, keeping the clock line high to stop I/O.
    584           * @param   void
    585           * @return  void
    586           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    587          STATIC void hali2cStop( void )
   \                     hali2cStop:
    588          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    589            // Wait for clock high and data low
    590            hali2cClock(0);
   \   000004                ; Setup parameters for call to function hali2cClock
   \   000004   7900         MOV     R1,#0x0
   \   000006   12....       LCALL   ??hali2cClock?relay
    591            OCM_DATA_LOW();  // force low with SCL low
   \   000009   12....       LCALL   ?Subroutine6 & 0xFFFF
    592            hali2cWait(1);
    593          
    594            hali2cClock( 1 );
   \                     ??CrossCallReturnLabel_7:
   \   00000C                ; Setup parameters for call to function hali2cClock
   \   00000C   7901         MOV     R1,#0x1
   \   00000E   12....       LCALL   ?Subroutine9 & 0xFFFF
    595            OCM_DATA_HIGH(); // stop condition
    596            hali2cWait(1);
   \                     ??CrossCallReturnLabel_11:
   \   000011   12....       LCALL   hali2cWait & 0xFFFF
    597          
    598          }
   \   000014   02....       LJMP    ?Subroutine0 & 0xFFFF
   \   000017                REQUIRE P0DIR
   \   000017                REQUIRE _A_P0
    599          
    600          /*********************************************************************
    601           * @fn      hali2cWait
    602           * @brief   Wastes a an amount of time.
    603           * @param   count: down count in busy-wait
    604           * @return  void
    605           */

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    606          STATIC __near_func void hali2cWait( uint8 count )
   \                     hali2cWait:
    607          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    608            while ( count-- );
   \                     ??hali2cWait_0:
   \   000000   E9           MOV     A,R1
   \   000001   F8           MOV     R0,A
   \   000002   74FF         MOV     A,#-0x1
   \   000004   28           ADD     A,R0
   \   000005   19           DEC     R1
   \   000006   04           INC     A
   \   000007   70F7         JNZ     ??hali2cWait_0
    609          }
   \   000009   22           RET
    610          
    611          /*********************************************************************
    612           * @fn      hali2cReceiveByte
    613           * @brief   Read the 8 data bits.
    614           * @param   void
    615           * @return  character read
    616           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    617          STATIC uint8 hali2cReceiveByte()
   \                     hali2cReceiveByte:
    618          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
    619            int8 i, rval = 0;
   \   000005   75..00       MOV     ?V0 + 0,#0x0
    620          
    621            for (i=7; i>=0; --i)  {
   \   000008   7E07         MOV     R6,#0x7
    622              if (hali2cRead())  {
   \                     ??hali2cReceiveByte_0:
   \   00000A                ; Setup parameters for call to function hali2cClock
   \   00000A   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   00000D                ; Setup parameters for call to function hali2cClock
   \   00000D   7901         MOV     R1,#0x1
   \   00000F   12....       LCALL   ??Subroutine10_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000012   A286         MOV     C,0x80.6
   \   000014   5010         JNC     ??hali2cReceiveByte_1
    623                rval |= 1<<i;
   \   000016   75..01       MOV     ?V0 + 2,#0x1
   \   000019   75..00       MOV     ?V0 + 3,#0x0
   \   00001C   EE           MOV     A,R6
   \   00001D   78..         MOV     R0,#?V0 + 2
   \   00001F   12....       LCALL   ?S_SHL
   \   000022   E5..         MOV     A,?V0 + 2
   \   000024   42..         ORL     ?V0 + 0,A
    624              }
    625            }
   \                     ??hali2cReceiveByte_1:
   \   000026   74FF         MOV     A,#-0x1
   \   000028   2E           ADD     A,R6
   \   000029   1E           DEC     R6
   \   00002A   C3           CLR     C
   \   00002B   9400         SUBB    A,#0x0
   \   00002D   A2D2         MOV     C,0xD0 /* PSW */.2
   \   00002F   65D0         XRL     A,PSW
   \   000031   33           RLC     A
   \   000032   50D6         JNC     ??hali2cReceiveByte_0
    626          
    627            return rval;
   \   000034   A9..         MOV     R1,?V0 + 0
   \   000036   7F04         MOV     R7,#0x4
   \   000038   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   00003B                REQUIRE _A_P0
    628          }
    629          /**************************************************************************************************
    630          **************************************************************************************************/
    631          /*********************************************************************
    632           * @fn      hali2cReceive
    633           * @brief   reads data into a buffer
    634           * @param   address: linear address on part from which to read
    635           * @param   buffer: target array for read characters
    636           * @param   len: max number of characters to read
    637           * @return  void
    638           */
    639          STATIC void hali2cReceive( uint8 address, uint8 *buffer, uint16 len )
    640          {
    641          //  uint8  ch;
    642            uint16 i;
    643          
    644            if (!len)  {
    645              return;
    646            }
    647          
    648            hali2cSendDeviceAddress(address);
    649          
    650          //  ch = OCM_ADDRESS_BYTE(0, OCM_READ);
    651          //  hali2cSend(&ch, 1, SEND_START, NOSEND_STOP);
    652          
    653            for ( i = 0; i < len-1; i++ )
    654            {
    655              // SCL may be high. set SCL low. If SDA goes high when input
    656              // mode is set the slave won't see a STOP
    657              hali2cClock(0);
    658              OCM_DATA_HIGH();
    659          
    660              buffer[i] = hali2cReceiveByte();
    661              hali2cWrite(SMB_ACK);           // write leaves SCL high
    662            }
    663          
    664            // condition SDA one more time...
    665            hali2cClock(0);
    666            OCM_DATA_HIGH();
    667            buffer[i] = hali2cReceiveByte();
    668            hali2cWrite(SMB_NAK);
    669          
    670            hali2cStop();
    671          }
    672          
    673          /*********************************************************************
    674           * @fn      hali2cRead
    675           * @brief   Toggle the clock line to let the slave set the data line.
    676           *          Then read the data line.
    677           * @param   void
    678           * @return  TRUE if bit read is 1 else FALSE
    679           */
    680          STATIC _Bool hali2cRead( void )
    681          {
    682            // SCL low to let slave set SDA. SCL high for SDA
    683            // valid and then get bit
    684            hali2cClock( 0 );
    685            hali2cWait(1);
    686            hali2cClock( 1 );
    687            hali2cWait(1);
    688          
    689            return OCM_SDA;
    690          }
    691          
    692          /*********************************************************************
    693           * @fn      hali2cSendDeviceAddress
    694           * @brief   Send onlythe device address. Do ack polling
    695           *
    696           * @param   void
    697           * @return  none
    698           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    699          STATIC void hali2cSendDeviceAddress(uint8 address)
   \                     hali2cSendDeviceAddress:
    700          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    701            uint8 retry = HAL_I2C_RETRY_CNT;
   \   000007   7F03         MOV     R7,#0x3
    702          
    703            do {
    704              hali2cStart();
   \                     ??hali2cSendDeviceAddress_0:
   \   000009                ; Setup parameters for call to function hali2cStart
   \   000009   12....       LCALL   ??hali2cStart?relay
    705              if (hali2cSendByte(address))  // do ack polling...
   \   00000C                ; Setup parameters for call to function hali2cSendByte
   \   00000C   EE           MOV     A,R6
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??hali2cSendByte?relay
   \   000011   4004         JC      ??hali2cSendDeviceAddress_1
    706              {
    707                break;
    708              }
    709            } while ( --retry );
   \   000013   1F           DEC     R7
   \   000014   EF           MOV     A,R7
   \   000015   70F2         JNZ     ??hali2cSendDeviceAddress_0
    710          }
   \                     ??hali2cSendDeviceAddress_1:
   \   000017   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000003   25..         ADD     A,?V0 + 2
   \   000005   F582         MOV     DPL,A
   \   000007   EF           MOV     A,R7
   \   000008   35..         ADDC    A,?V0 + 3
   \   00000A   F583         MOV     DPH,A
   \   00000C   E9           MOV     A,R1
   \   00000D   F0           MOVX    @DPTR,A
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   E5..         MOV     A,?V0 + 2
   \   000002   2401         ADD     A,#0x1
   \   000004   F5..         MOV     ?V0 + 2,A
   \   000006   E5..         MOV     A,?V0 + 3
   \   000008   3400         ADDC    A,#0x0
   \   00000A   F5..         MOV     ?V0 + 3,A
   \   00000C   22           RET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalI2CInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalI2CInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalI2CReceive?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalI2CReceive

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalI2CSend?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalI2CSend

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ADXL345WriteByte?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ADXL345WriteByte

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ADXL345ReadByte?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ADXL345ReadByte

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ADXL345ReadBytes?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ADXL345ReadBytes

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hali2cSendByte?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hali2cSendByte

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hali2cWrite?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hali2cWrite

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hali2cClock?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hali2cClock

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hali2cStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hali2cStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hali2cStop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hali2cStop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hali2cReceiveByte?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hali2cReceiveByte

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hali2cSendDeviceAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hali2cSendDeviceAddress

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     ADXL345ReadByte                  0      0      9
       -> hali2cStart                 0      0     18
       -> hali2cSendByte              0      0     18
       -> hali2cSendByte              0      0     18
       -> hali2cStart                 0      0     18
       -> hali2cSendByte              0      0     18
       -> hali2cReceiveByte           0      0     18
       -> hali2cWrite                 0      0     18
       -> hali2cStop                  0      0     18
     ADXL345ReadBytes                 1      0     15
       -> hali2cStart                 0      0     30
       -> hali2cSendByte              0      0     30
       -> hali2cSendByte              0      0     30
       -> hali2cStart                 0      0     30
       -> hali2cSendByte              0      0     30
       -> hali2cClock                 0      0     30
       -> hali2cReceiveByte           0      0     30
       -> hali2cWrite                 0      0     30
       -> hali2cStop                  0      0     30
     ADXL345WriteByte                 0      0      9
       -> hali2cStart                 0      0     18
       -> hali2cSendByte              0      0     18
       -> hali2cSendByte              0      0     18
       -> hali2cSendByte              0      0     18
       -> hali2cStop                  0      0     18
     HalI2CInit                       2      0      0
     HalI2CReceive                    1      0     13
       -> hali2cSendDeviceAddress     0      0     26
       -> hali2cClock                 0      0     26
       -> hali2cReceiveByte           0      0     26
       -> hali2cWrite                 0      0     26
       -> hali2cClock                 0      0     26
       -> hali2cReceiveByte           0      0     26
       -> hali2cWrite                 0      0     26
       -> hali2cStop                  0      0     26
     HalI2CSend                       0      0     14
       -> hali2cSendDeviceAddress     0      0     28
       -> hali2cSendByte              0      0     28
       -> hali2cStop                  0      0     28
     hali2cClock                      1      0     15
       -> hali2cWait                  2      0      0
     hali2cReceiveByte                0      0     27
       -> hali2cClock                 0      0     24
       -> hali2cWait                  0      0     24
       -> hali2cClock                 0      0     24
       -> hali2cWait                  0      0     24
     hali2cSendByte                   0      0     24
       -> hali2cWrite                 0      0     18
       -> hali2cClock                 0      0     18
       -> hali2cClock                 0      0     18
       -> hali2cWait                  0      0     18
     hali2cSendDeviceAddress          0      0     23
       -> hali2cStart                 0      0     18
       -> hali2cSendByte              0      0     18
     hali2cStart                      0      0     24
       -> hali2cClock                 0      0     18
       -> hali2cWait                  0      0     18
       -> hali2cClock                 0      0     18
       -> hali2cClock                 0      0     18
       -> hali2cWait                  0      0     18
       -> hali2cWait                  0      0     18
       -> hali2cClock                 0      0     18
     hali2cStop                       2      0     15
       -> hali2cClock                 4      0      0
       -> hali2cWait                  4      0      0
       -> hali2cClock                 4      0      0
       -> hali2cWait                  4      0      0
     hali2cWait                       0      0     12
     hali2cWrite                      0      0     24
       -> hali2cClock                 0      0     18
       -> hali2cWait                  0      0     18
       -> hali2cClock                 0      0     18
       -> hali2cWait                  0      0     18


   Segment part sizes:

     Function/Label                  Bytes
     --------------                  -----
     _A_P0                              1
     P0SEL                              1
     P2SEL                              1
     P2INP                              1
     P0DIR                              1
     s_xmemIsInit                       1
     HalI2CInit                        35
     ?Subroutine0                       7
     HalI2CReceive                     79
     HalI2CSend                        76
     ADXL345WriteByte                  61
     ?Subroutine1                       5
     ADXL345ReadByte                   74
     ADXL345ReadBytes                 135
     ?Subroutine7                      11
     hali2cSendByte                    32
     ?Subroutine3                       9
     ?Subroutine9                       9
     ?Subroutine8                       9
     hali2cWrite                       28
     ?Subroutine4                       2
     ??Subroutine10_0                   4
     hali2cClock                       27
     hali2cStart                       38
     ?Subroutine6                      11
     hali2cStop                        23
     hali2cWait                        10
     hali2cReceiveByte                 59
     hali2cSendDeviceAddress           26
     ?Subroutine2                      15
     ?Subroutine5                      13
     ??HalI2CInit?relay                 6
     ??HalI2CReceive?relay              6
     ??HalI2CSend?relay                 6
     ??ADXL345WriteByte?relay           6
     ??ADXL345ReadByte?relay            6
     ??ADXL345ReadBytes?relay           6
     ??hali2cSendByte?relay             6
     ??hali2cWrite?relay                6
     ??hali2cClock?relay                6
     ??hali2cStart?relay                6
     ??hali2cStop?relay                 6
     ??hali2cReceiveByte?relay          6
     ??hali2cSendDeviceAddress?relay    6

 
 788 bytes in segment BANKED_CODE
  78 bytes in segment BANK_RELAYS
  10 bytes in segment NEAR_CODE
   5 bytes in segment SFR_AN
   1 byte  in segment XDATA_Z
 
 876 bytes of CODE  memory
   0 bytes of DATA  memory (+ 5 bytes shared)
   1 byte  of XDATA memory

Errors: none
Warnings: none
