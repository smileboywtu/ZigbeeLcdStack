###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         13/Jul/2015  17:23:52 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Componen #
#                          ts\stack\zdo\ZDApp.c                               #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\WirelessMonitorSystem\CC2530DB #
#                          \..\..\..\Tools\CC2530DB\f8wEndev.cfg"             #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_TX_DATA_MAX=3 -DMAC_CFG_TX_MAX=6         #
#                          -DMAC_CFG_RX_MAX=3) -f "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\Too #
#                          ls\CC2530DB\f8wConfig.cfg" (-DZIGBEEPRO            #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=500         #
#                          -DQUEUED_POLL_RATE=30 -DRESPONSE_POLL_RATE=100)    #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Components\stack\ #
#                          zdo\ZDApp.c" -D HAL_UART -lC "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\Camera\List\ #
#                          " -lA "C:\Texas Instruments\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\WirelessMonitorSystem\CC253 #
#                          0DB\Camera\List\" --diag_suppress Pe001,Pa010 -o   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\WirelessMonitorSystem\CC2530DB\Ca #
#                          mera\Obj\" -e --no_cse --no_unroll --no_inline     #
#                          --no_code_motion --no_tbaa --debug --core=plain    #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\" -I         #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\WirelessMonitorSystem\CC2530DB\.. #
#                          \Source\" -I "C:\Texas Instruments\ZStack-CC2530-2 #
#                          .5.1a\Projects\zstack\Samples\WirelessMonitorSyste #
#                          m\CC2530DB\..\..\..\ZMain\TI2530DB\" -I "C:\Texas  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\hal\include\" -I "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\hal\target\CC2530EB\" -I "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\mac\include\" -I "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\mac\high_level\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\mac\low_level\srf04\" -I "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\mac\low_level\srf04\single_chip\"    #
#                          -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\WirelessMonitorSystem\CC2530DB #
#                          \..\..\..\..\..\Components\mt\" -I "C:\Texas       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\osal\include\" -I "C:\Texas          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\services\saddr\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\services\sdata\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\af\" -I "C:\Texas              #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\nwk\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\sapi\" -I "C:\Texas            #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\sec\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\sys\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\zdo\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\zmac\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WirelessMonitorSystem\CC2530DB\..\..\..\..\ #
#                          ..\Components\zmac\f8w\" -On --require_prototypes  #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\WirelessMonitorSystem\CC2530DB\Cam #
#                          era\List\ZDApp.lst                                 #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\WirelessMonitorSystem\CC2530DB\Cam #
#                          era\Obj\ZDApp.r51                                  #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.5.1a\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2012-02-16 16:04:32 -0800 (Thu, 16 Feb 2012) $
      4            Revision:       $Revision: 29348 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the user can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2012 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          
     45          #include "ZComDef.h"
     46          #include "ZMac.h"
     47          #include "OSAL.h"
     48          #include "OSAL_Tasks.h"
     49          #include "OSAL_PwrMgr.h"
     50          #include "OSAL_Nv.h"
     51          #include "AF.h"
     52          #include "APSMEDE.h"
     53          #include "NLMEDE.h"
     54          #include "AddrMgr.h"
     55          #include "ZDProfile.h"
     56          #include "ZDObject.h"
     57          #include "ZDConfig.h"
     58          #include "ZDSecMgr.h"
     59          #include "ZDApp.h"
     60          #include "DebugTrace.h"
     61          #include "nwk_util.h"
     62          #include "OnBoard.h"
     63          #include "ZGlobals.h"
     64          #include "ZDNwkMgr.h"
     65          #include "rtg.h"
     66          
     67          #include "ssp.h"
     68          
     69          /* HAL */
     70          #include "hal_led.h"
     71          #include "hal_lcd.h"
     72          #include "hal_key.h"
     73          
     74          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     75            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     76          #endif
     77          
     78          /*********************************************************************
     79           * CONSTANTS
     80           */
     81          
     82          #if !defined( NWK_START_DELAY )
     83            #define NWK_START_DELAY             100   // in milliseconds
     84          #endif
     85          
     86          #if !defined( LEAVE_RESET_DELAY )
     87            #define LEAVE_RESET_DELAY           5000  // in milliseconds
     88          #endif
     89          
     90          // Init ZDO, but hold and wait for application to start the joining or
     91          // forming network
     92          #define ZDO_INIT_HOLD_NWK_START       0xFFFF
     93          
     94          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     95            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     96          #endif
     97          
     98          #if !defined( BEACON_REQUEST_DELAY )
     99            #define BEACON_REQUEST_DELAY        100   // in milliseconds
    100          #endif
    101          
    102          #if !defined( BEACON_REQ_DELAY_MASK )
    103            #define BEACON_REQ_DELAY_MASK       0x007F
    104          #endif
    105          
    106          #define MAX_RESUME_RETRY            3
    107          
    108          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    109          
    110          // Beacon Order Settings (see NLMEDE.h)
    111          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    112          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    113          
    114          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    115            // The number of times the frame counter can change before
    116            // saving to NV
    117            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    118          #endif
    119          
    120          // Leave control bits
    121          #define ZDAPP_LEAVE_CTRL_INIT 0
    122          #define ZDAPP_LEAVE_CTRL_SET  1
    123          #define ZDAPP_LEAVE_CTRL_RA   2
    124          
    125          // Address Manager Stub Implementation
    126          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    127          
    128          
    129          #if !defined ZDO_NV_SAVE_RFDs
    130          #define ZDO_NV_SAVE_RFDs  TRUE
    131          #endif
    132          
    133          // Delay time before updating NWK NV data to force fewer writes during high activity.
    134          #if ZDO_NV_SAVE_RFDs
    135          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    136          #else
    137          #define ZDAPP_UPDATE_NWK_NV_TIME 65000
    138          #endif
    139          
    140          /*********************************************************************
    141           * GLOBAL VARIABLES
    142           */
    143          
    144          #if defined( LCD_SUPPORTED )
    145            uint8 MatchRsps = 0;
    146          #endif
    147          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    148          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    149          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    151          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    153          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    155          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    157          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    158          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    159          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    160          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    161          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    162          
    163          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    164          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    165          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    166          pfnZdoCb zdoCBFunc[MAX_ZDO_CB_FUNC];
   \                     zdoCBFunc:
   \   000000                DS 14
   \   00000E                REQUIRE __INIT_XDATA_Z
    167          
    168          /*********************************************************************
    169           * EXTERNAL VARIABLES
    170           */
    171          
    172          /*********************************************************************
    173           * EXTERNAL FUNCTIONS
    174           */
    175          
    176          /*********************************************************************
    177           * LOCAL FUNCTIONS
    178           */
    179          
    180          void ZDApp_NetworkStartEvt( void );
    181          void ZDApp_DeviceAuthEvt( void );
    182          void ZDApp_SaveNetworkStateEvt( void );
    183          
    184          uint8 ZDApp_ReadNetworkRestoreState( void );
    185          uint8 ZDApp_RestoreNetworkState( void );
    186          void ZDAppDetermineDeviceType( void );
    187          void ZDApp_InitUserDesc( void );
    188          void ZDAppCheckForHoldKey( void );
    189          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    190          void ZDApp_ProcessNetworkJoin( void );
    191          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    192          uint8 ZDApp_RestoreNwkKey( void );
    193          networkDesc_t* ZDApp_NwkDescListProcessing(void);
    194          
    195          void ZDApp_SecInit( uint8 state );
    196          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    197          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    198          
    199          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    200          
    201          void ZDApp_ResetTimerStart( uint16 delay );
    202          void ZDApp_ResetTimerCancel( void );
    203          void ZDApp_LeaveCtrlInit( void );
    204          void ZDApp_LeaveCtrlSet( uint8 ra );
    205          uint8 ZDApp_LeaveCtrlBypass( void );
    206          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    207          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    208                                  uint8 removeChildren );
    209          void ZDApp_NodeProfileSync( uint8 stackProfile );
    210          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    211          void ZDApp_RegisterCBs( void );
    212          void ZDApp_InitZdoCBFunc(void);
    213          
    214          /*********************************************************************
    215           * LOCAL VARIABLES
    216           */
    217          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    218          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    219          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    220          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    221          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    222          
    223          #if defined( HOLD_AUTO_START )
    224            devStates_t devState = DEV_HOLD;
    225          #else

   \                                 In  segment XDATA_I, align 1, keep-with-next
    226            devStates_t devState = DEV_INIT;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devState>`
   \   000001                REQUIRE __INIT_XDATA_I
    227          #endif
    228          
    229          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    230            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    231            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    232                                  // to parent. Set to make the device do an Orphan scan.
    233          #else
    234            // Set the default to coodinator
    235            devStartModes_t devStartMode = MODE_HARD;
    236          #endif
    237          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    238          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    239          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    240          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    241          {
    242            ZDO_EP,
    243            &ZDAppTaskID,
    244            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    245            (afNetworkLatencyReq_t)0            // No Network Latency req
    246          };
    247          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    248          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    249          
    250          /*********************************************************************
    251           * @fn      ZDApp_Init
    252           *
    253           * @brief   ZDApp Initialization function.
    254           *
    255           * @param   task_id - ZDApp Task ID
    256           *
    257           * @return  None
    258           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    259          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    260          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    261            // Save the task ID
    262            ZDAppTaskID = task_id;
   \   000007   90....       MOV     DPTR,#ZDAppTaskID
   \   00000A   F0           MOVX    @DPTR,A
    263          
    264            // Initialize the ZDO global device short address storage
    265            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   00000B   90....       MOV     DPTR,#ZDAppNwkAddr + 8
   \   00000E   7402         MOV     A,#0x2
   \   000010   F0           MOVX    @DPTR,A
    266            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   000011   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000014   74FE         MOV     A,#-0x2
   \   000016   F0           MOVX    @DPTR,A
   \   000017   A3           INC     DPTR
   \   000018   74FF         MOV     A,#-0x1
   \   00001A   F0           MOVX    @DPTR,A
    267            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   00001B                ; Setup parameters for call to function NLME_GetExtAddr
   \   00001B   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00001E   8A..         MOV     ?V0 + 2,R2
   \   000020   8B..         MOV     ?V0 + 3,R3
   \   000022   85....       MOV     ?V0 + 0,?V0 + 2
   \   000025   85....       MOV     ?V0 + 1,?V0 + 3
    268          
    269            // Check for manual "Hold Auto Start"
    270            ZDAppCheckForHoldKey();
   \   000028                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   000028   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    271          
    272            // Initialize ZDO items and setup the device - type of device to create.
    273            ZDO_Init();
   \   00002B                ; Setup parameters for call to function ZDO_Init
   \   00002B   12....       LCALL   ??ZDO_Init?relay
    274          
    275            // Register the endpoint description with the AF
    276            // This task doesn't have a Simple description, but we still need
    277            // to register the endpoint.
    278            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   00002E                ; Setup parameters for call to function afRegister
   \   00002E   7A..         MOV     R2,#ZDApp_epDesc & 0xff
   \   000030   7B..         MOV     R3,#(ZDApp_epDesc >> 8) & 0xff
   \   000032   12....       LCALL   ??afRegister?relay
   \   000035   E9           MOV     A,R1
    279          
    280          #if defined( ZDO_USERDESC_RESPONSE )
    281            ZDApp_InitUserDesc();
    282          #endif // ZDO_USERDESC_RESPONSE
    283          
    284            // Start the device?
    285            if ( devState != DEV_HOLD )
   \   000036   90....       MOV     DPTR,#devState
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   600A         JZ      ??ZDApp_Init_0
    286            {
    287              ZDOInitDevice( 0 );
   \   00003C                ; Setup parameters for call to function ZDOInitDevice
   \   00003C   7A00         MOV     R2,#0x0
   \   00003E   7B00         MOV     R3,#0x0
   \   000040   12....       LCALL   ??ZDOInitDevice?relay
   \   000043   E9           MOV     A,R1
   \   000044   8015         SJMP    ??ZDApp_Init_1
    288            }
    289            else
    290            {
    291              ZDOInitDevice( ZDO_INIT_HOLD_NWK_START );
   \                     ??ZDApp_Init_0:
   \   000046                ; Setup parameters for call to function ZDOInitDevice
   \   000046   7AFF         MOV     R2,#-0x1
   \   000048   7BFF         MOV     R3,#-0x1
   \   00004A   12....       LCALL   ??ZDOInitDevice?relay
   \   00004D   E9           MOV     A,R1
    292              // Blink LED to indicate HOLD_START
    293              HalLedBlink ( HAL_LED_4, 0, 50, 500 );
   \   00004E                ; Setup parameters for call to function HalLedBlink
   \   00004E   7CF4         MOV     R4,#-0xc
   \   000050   7D01         MOV     R5,#0x1
   \   000052   7B32         MOV     R3,#0x32
   \   000054   7A00         MOV     R2,#0x0
   \   000056   7908         MOV     R1,#0x8
   \   000058   12....       LCALL   ??HalLedBlink?relay
    294            }
    295          
    296            // Initialize the ZDO callback function pointers zdoCBFunc[]
    297            ZDApp_InitZdoCBFunc();
   \                     ??ZDApp_Init_1:
   \   00005B                ; Setup parameters for call to function ZDApp_InitZdoCBFunc
   \   00005B   12....       LCALL   ??ZDApp_InitZdoCBFunc?relay
    298          
    299            ZDApp_RegisterCBs();
   \   00005E                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   00005E   12....       LCALL   ??ZDApp_RegisterCBs?relay
    300          } /* ZDApp_Init() */
   \   000061   7F04         MOV     R7,#0x4
   \   000063   02....       LJMP    ?BANKED_LEAVE_XDATA
    301          
    302          /*********************************************************************
    303           * @fn          ZDApp_SecInit
    304           *
    305           * @brief       ZDApp initialize security.
    306           *
    307           * @param       state - device initialization state
    308           *
    309           * @return      none
    310           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    311          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    312          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    313            uint8 zgPreConfigKey[SEC_KEY_LEN];
    314          
    315            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    316            {
    317              // Set the Trust Center bit
    318              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    319            }
    320          
    321            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    322            {
    323              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    324            }
    325          
    326            // Initialize ZigBee Device Security Manager
    327            ZDSecMgrInit(state);
   \   000007                ; Setup parameters for call to function ZDSecMgrInit
   \   000007   F9           MOV     R1,A
   \   000008   12....       LCALL   ??ZDSecMgrInit?relay
    328          
    329            if ( ZG_SECURE_ENABLED )
    330            {
    331              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
    332              {
    333                nwkFrameCounter = 0;
    334          
    335                if( _NIB.nwkKeyLoaded == FALSE )
    336                {
    337                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    338                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
    339                  {
    340                      ZDSecMgrReadKeyFromNv(ZCD_NV_PRECFGKEY, zgPreConfigKey);
    341                      SSP_UpdateNwkKey( zgPreConfigKey, 0);
    342                      SSP_SwitchNwkKey( 0 );
    343          
    344                      // clear local copy of key
    345                      osal_memset(zgPreConfigKey, 0x00, SEC_KEY_LEN);
    346                  }
    347                }
    348              }
    349            }
    350          }
   \   00000B   7F01         MOV     R7,#0x1
   \   00000D   02....       LJMP    ?BANKED_LEAVE_XDATA
    351          
    352          /*********************************************************************
    353           * @fn      ZDApp_event_loop()
    354           *
    355           * @brief   Main event loop for Zigbee device objects task. This function
    356           *          should be called at periodic intervals.
    357           *
    358           * @param   task_id - Task ID
    359           * @param   events  - Bitmap of events
    360           *
    361           * @return  none
    362           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    363          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    364          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    365            uint8 *msg_ptr;
    366          
    367            if ( events & SYS_EVENT_MSG )
   \   00000B   EE           MOV     A,R6
   \   00000C   5400         ANL     A,#0x0
   \   00000E   F8           MOV     R0,A
   \   00000F   EF           MOV     A,R7
   \   000010   5480         ANL     A,#0x80
   \   000012   F9           MOV     R1,A
   \   000013   E8           MOV     A,R0
   \   000014   49           ORL     A,R1
   \   000015   6034         JZ      ??ZDApp_event_loop_0
    368            {
    369              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
   \                     ??ZDApp_event_loop_1:
   \   000017                ; Setup parameters for call to function osal_msg_receive
   \   000017   90....       MOV     DPTR,#ZDAppTaskID
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F9           MOV     R1,A
   \   00001C   12....       LCALL   ??osal_msg_receive?relay
   \   00001F   8A..         MOV     ?V0 + 4,R2
   \   000021   8B..         MOV     ?V0 + 5,R3
   \   000023   A8..         MOV     R0,?V0 + 4
   \   000025   A9..         MOV     R1,?V0 + 5
   \   000027   88..         MOV     ?V0 + 2,R0
   \   000029   89..         MOV     ?V0 + 3,R1
   \   00002B   E8           MOV     A,R0
   \   00002C   49           ORL     A,R1
   \   00002D   6011         JZ      ??ZDApp_event_loop_2
    370              {
    371                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
   \   00002F                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   00002F   AA..         MOV     R2,?V0 + 2
   \   000031   AB..         MOV     R3,?V0 + 3
   \   000033   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
    372          
    373                // Release the memory
    374                osal_msg_deallocate( msg_ptr );
   \   000036                ; Setup parameters for call to function osal_msg_deallocate
   \   000036   AA..         MOV     R2,?V0 + 2
   \   000038   AB..         MOV     R3,?V0 + 3
   \   00003A   12....       LCALL   ??osal_msg_deallocate?relay
   \   00003D   E9           MOV     A,R1
   \   00003E   80D7         SJMP    ??ZDApp_event_loop_1
    375              }
    376          
    377              // Return unprocessed events
    378              return (events ^ SYS_EVENT_MSG);
   \                     ??ZDApp_event_loop_2:
   \   000040   EE           MOV     A,R6
   \   000041   6400         XRL     A,#0x0
   \   000043   FA           MOV     R2,A
   \   000044   EF           MOV     A,R7
   \   000045   6480         XRL     A,#0x80
   \   000047   FB           MOV     R3,A
   \   000048   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    379            }
    380          
    381            if ( events & ZDO_NETWORK_INIT )
   \                     ??ZDApp_event_loop_0:
   \   00004B   EE           MOV     A,R6
   \   00004C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00004E   5030         JNC     ??ZDApp_event_loop_4
    382            {
    383              // Initialize apps and start the network
    384              devState = DEV_INIT;
   \   000050   90....       MOV     DPTR,#devState
   \   000053   7401         MOV     A,#0x1
   \   000055   F0           MOVX    @DPTR,A
    385              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000056                ; Setup parameters for call to function osal_set_event
   \   000056   7A10         MOV     R2,#0x10
   \   000058   7B00         MOV     R3,#0x0
   \   00005A   90....       MOV     DPTR,#ZDAppTaskID
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   F9           MOV     R1,A
   \   00005F   12....       LCALL   ??osal_set_event?relay
   \   000062   E9           MOV     A,R1
    386          
    387              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    388                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \   000063                ; Setup parameters for call to function ZDO_StartDevice
   \   000063   7C0F         MOV     R4,#0xf
   \   000065   7B0F         MOV     R3,#0xf
   \   000067   90....       MOV     DPTR,#devStartMode
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   FA           MOV     R2,A
   \   00006C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   5407         ANL     A,#0x7
   \   000072   F9           MOV     R1,A
   \   000073   12....       LCALL   ??ZDO_StartDevice?relay
    389          
    390              // Return unprocessed events
    391              return (events ^ ZDO_NETWORK_INIT);
   \   000076   EE           MOV     A,R6
   \   000077   6401         XRL     A,#0x1
   \   000079   FA           MOV     R2,A
   \   00007A   EF           MOV     A,R7
   \   00007B   6400         XRL     A,#0x0
   \   00007D   FB           MOV     R3,A
   \   00007E   806C         SJMP    ??ZDApp_event_loop_3
    392            }
    393          
    394            if ( ZSTACK_ROUTER_BUILD )
    395            {
    396              if ( events & ZDO_NETWORK_START )
    397              {
    398                ZDApp_NetworkStartEvt();
    399          
    400                // Return unprocessed events
    401                return (events ^ ZDO_NETWORK_START);
    402              }
    403          
    404              if ( events & ZDO_ROUTER_START )
    405              {
    406                if ( nwkStatus == ZSuccess )
    407                {
    408                  if ( devState == DEV_END_DEVICE )
    409                    devState = DEV_ROUTER;
    410          
    411                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
    412                }
    413                else
    414                {
    415                  // remain as end device!!
    416                }
    417                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    418          
    419                // Return unprocessed events
    420                return (events ^ ZDO_ROUTER_START);
    421              }
    422            }
    423          
    424            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_4:
   \   000080   EE           MOV     A,R6
   \   000081   5410         ANL     A,#0x10
   \   000083   602B         JZ      ??ZDApp_event_loop_5
    425            {
    426              ZDO_UpdateNwkStatus( devState );
   \   000085                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   000085   90....       MOV     DPTR,#devState
   \   000088   E0           MOVX    A,@DPTR
   \   000089   F9           MOV     R1,A
   \   00008A   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    427          
    428              // At start up, do one MTO route discovery if the device is a concentrator
    429              if ( zgConcentratorEnable == TRUE )
   \   00008D   90....       MOV     DPTR,#zgConcentratorEnable
   \   000090   E0           MOVX    A,@DPTR
   \   000091   6401         XRL     A,#0x1
   \   000093   7011         JNZ     ??ZDApp_event_loop_6
    430              {
    431                // Start next event
    432                osal_start_timerEx( NWK_TaskID, NWK_MTO_RTG_REQ_EVT, 100 );
   \   000095                ; Setup parameters for call to function osal_start_timerEx
   \   000095   7C64         MOV     R4,#0x64
   \   000097   7D00         MOV     R5,#0x0
   \   000099   7A00         MOV     R2,#0x0
   \   00009B   7B08         MOV     R3,#0x8
   \   00009D   90....       MOV     DPTR,#NWK_TaskID
   \   0000A0   E0           MOVX    A,@DPTR
   \   0000A1   F9           MOV     R1,A
   \   0000A2   12....       LCALL   ??osal_start_timerEx?relay
   \   0000A5   E9           MOV     A,R1
    433              }
    434          
    435              // Return unprocessed events
    436              return (events ^ ZDO_STATE_CHANGE_EVT);
   \                     ??ZDApp_event_loop_6:
   \   0000A6   EE           MOV     A,R6
   \   0000A7   6410         XRL     A,#0x10
   \   0000A9   FA           MOV     R2,A
   \   0000AA   EF           MOV     A,R7
   \   0000AB   6400         XRL     A,#0x0
   \   0000AD   FB           MOV     R3,A
   \   0000AE   803C         SJMP    ??ZDApp_event_loop_3
    437            }
    438          
    439            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_5:
   \   0000B0   EE           MOV     A,R6
   \   0000B1   5408         ANL     A,#0x8
   \   0000B3   600A         JZ      ??ZDApp_event_loop_7
    440            {
    441              // User defined logic
    442          
    443              // Return unprocessed events
    444              return (events ^ ZDO_COMMAND_CNF);
   \   0000B5   EE           MOV     A,R6
   \   0000B6   6408         XRL     A,#0x8
   \   0000B8   FA           MOV     R2,A
   \   0000B9   EF           MOV     A,R7
   \   0000BA   6400         XRL     A,#0x0
   \   0000BC   FB           MOV     R3,A
   \   0000BD   802D         SJMP    ??ZDApp_event_loop_3
    445            }
    446          
    447            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_7:
   \   0000BF   EE           MOV     A,R6
   \   0000C0   5400         ANL     A,#0x0
   \   0000C2   F8           MOV     R0,A
   \   0000C3   EF           MOV     A,R7
   \   0000C4   5402         ANL     A,#0x2
   \   0000C6   F9           MOV     R1,A
   \   0000C7   E8           MOV     A,R0
   \   0000C8   49           ORL     A,R1
   \   0000C9   600D         JZ      ??ZDApp_event_loop_8
    448            {
    449              ZDApp_SaveNetworkStateEvt();
   \   0000CB                ; Setup parameters for call to function ZDApp_SaveNetworkStateEvt
   \   0000CB   12....       LCALL   ??ZDApp_SaveNetworkStateEvt?relay
    450          
    451              // Return unprocessed events
    452              return (events ^ ZDO_NWK_UPDATE_NV);
   \   0000CE   EE           MOV     A,R6
   \   0000CF   6400         XRL     A,#0x0
   \   0000D1   FA           MOV     R2,A
   \   0000D2   EF           MOV     A,R7
   \   0000D3   6402         XRL     A,#0x2
   \   0000D5   FB           MOV     R3,A
   \   0000D6   8014         SJMP    ??ZDApp_event_loop_3
    453            }
    454          
    455            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_8:
   \   0000D8   EE           MOV     A,R6
   \   0000D9   5404         ANL     A,#0x4
   \   0000DB   600B         JZ      ??ZDApp_event_loop_9
    456            {
    457          #ifdef ZBA_FALLBACK_NWKKEY
    458              if ( devState == DEV_END_DEVICE_UNAUTH )
    459              {
    460                ZDSecMgrFallbackNwkKey();
    461              }
    462              else
    463          #endif
    464              {
    465                // Set the NV startup option to force a "new" join.
    466                zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   0000DD                ; Setup parameters for call to function zgWriteStartupOptions
   \   0000DD   7A02         MOV     R2,#0x2
   \   0000DF   79FF         MOV     R1,#-0x1
   \   0000E1   12....       LCALL   ??zgWriteStartupOptions?relay
   \   0000E4   E9           MOV     A,R1
    467          
    468                // The device has been in the UNAUTH state, so reset
    469                // Note: there will be no return from this call
    470                SystemResetSoft();
   \   0000E5                ; Setup parameters for call to function Onboard_soft_reset
   \   0000E5   12....       LCALL   Onboard_soft_reset & 0xFFFF
    471              }
    472            }
    473          
    474            if ( ZG_SECURE_ENABLED )
    475            {
    476              return ( ZDApp_ProcessSecEvent( task_id, events ) );
    477            }
    478            else
    479            {
    480              // Discard or make more handlers
    481              return 0;
   \                     ??ZDApp_event_loop_9:
   \   0000E8   7A00         MOV     R2,#0x0
   \   0000EA   7B00         MOV     R3,#0x0
   \                     ??ZDApp_event_loop_3:
   \   0000EC   7F06         MOV     R7,#0x6
   \   0000EE   02....       LJMP    ?BANKED_LEAVE_XDATA
    482            }
    483          }
    484          
    485          /*********************************************************************
    486           * @fn      ZDApp_ProcessSecEvent()
    487           *
    488           * @brief   Process incoming security events.
    489           *
    490           * @param   task_id - Task ID
    491           * @param   events  - Bitmap of events
    492           *
    493           * @return  none
    494           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    495          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    496          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    497            (void)task_id;  // Intentionally unreferenced parameter
    498          
    499            if ( ZSTACK_ROUTER_BUILD )
    500            {
    501              if ( events & ZDO_NEW_DEVICE )
    502              {
    503                // process the new device event
    504                if ( ZDSecMgrNewDeviceEvent() == TRUE )
    505                {
    506                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
    507                }
    508          
    509                // Return unprocessed events
    510                return (events ^ ZDO_NEW_DEVICE);
    511              }
    512            }
    513          
    514            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH)
    515                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    516            {
    517              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    518              {
    519                if ( events & ZDO_SECMGR_EVENT )
    520                {
    521                  ZDSecMgrEvent();
    522          
    523                  // Return unprocessed events
    524                  return (events ^ ZDO_SECMGR_EVENT);
    525                }
    526              }
    527            }
    528          
    529            if ( events & ZDO_DEVICE_AUTH )
   \   00000B   EE           MOV     A,R6
   \   00000C   5480         ANL     A,#0x80
   \   00000E   600D         JZ      ??ZDApp_ProcessSecEvent_0
    530            {
    531              ZDApp_DeviceAuthEvt();
   \   000010                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   000010   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    532          
    533              // Return unprocessed events
    534              return (events ^ ZDO_DEVICE_AUTH);
   \   000013   EE           MOV     A,R6
   \   000014   6480         XRL     A,#0x80
   \   000016   FA           MOV     R2,A
   \   000017   EF           MOV     A,R7
   \   000018   6400         XRL     A,#0x0
   \   00001A   FB           MOV     R3,A
   \   00001B   806D         SJMP    ??ZDApp_ProcessSecEvent_1
    535            }
    536          
    537            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   00001D   EE           MOV     A,R6
   \   00001E   5400         ANL     A,#0x0
   \   000020   F8           MOV     R0,A
   \   000021   EF           MOV     A,R7
   \   000022   5404         ANL     A,#0x4
   \   000024   F9           MOV     R1,A
   \   000025   E8           MOV     A,R0
   \   000026   49           ORL     A,R1
   \   000027   602E         JZ      ??ZDApp_ProcessSecEvent_2
    538            {
    539              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   000029   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F8           MOV     R0,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   E8           MOV     A,R0
   \   000032   2401         ADD     A,#0x1
   \   000034   FA           MOV     R2,A
   \   000035   E9           MOV     A,R1
   \   000036   3400         ADDC    A,#0x0
   \   000038   FB           MOV     R3,A
   \   000039   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00003C   EA           MOV     A,R2
   \   00003D   F0           MOVX    @DPTR,A
   \   00003E   A3           INC     DPTR
   \   00003F   EB           MOV     A,R3
   \   000040   F0           MOVX    @DPTR,A
   \   000041   C3           CLR     C
   \   000042   E8           MOV     A,R0
   \   000043   94E9         SUBB    A,#-0x17
   \   000045   E9           MOV     A,R1
   \   000046   9403         SUBB    A,#0x3
   \   000048   4003         JC      ??ZDApp_ProcessSecEvent_3
    540              {
    541                ZDApp_SaveNwkKey();
   \   00004A                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   00004A   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    542              }
    543          
    544              // Return unprocessed events
    545              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_3:
   \   00004D   EE           MOV     A,R6
   \   00004E   6400         XRL     A,#0x0
   \   000050   FA           MOV     R2,A
   \   000051   EF           MOV     A,R7
   \   000052   6404         XRL     A,#0x4
   \   000054   FB           MOV     R3,A
   \   000055   8033         SJMP    ??ZDApp_ProcessSecEvent_1
    546            }
    547          
    548            if ( events & ZDO_APS_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_2:
   \   000057   EE           MOV     A,R6
   \   000058   5400         ANL     A,#0x0
   \   00005A   F8           MOV     R0,A
   \   00005B   EF           MOV     A,R7
   \   00005C   5410         ANL     A,#0x10
   \   00005E   F9           MOV     R1,A
   \   00005F   E8           MOV     A,R0
   \   000060   49           ORL     A,R1
   \   000061   600A         JZ      ??ZDApp_ProcessSecEvent_4
    549            {
    550          #if defined (NV_RESTORE)
    551              ZDSecMgrSaveApsLinkKey();
    552          #endif // (NV_RESTORE)
    553          
    554              // Return unprocessed events
    555              return (events ^ ZDO_APS_FRAMECOUNTER_CHANGE);
   \   000063   EE           MOV     A,R6
   \   000064   6400         XRL     A,#0x0
   \   000066   FA           MOV     R2,A
   \   000067   EF           MOV     A,R7
   \   000068   6410         XRL     A,#0x10
   \   00006A   FB           MOV     R3,A
   \   00006B   801D         SJMP    ??ZDApp_ProcessSecEvent_1
    556            }
    557          
    558            if ( events & ZDO_TCLK_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_4:
   \   00006D   EE           MOV     A,R6
   \   00006E   5400         ANL     A,#0x0
   \   000070   F8           MOV     R0,A
   \   000071   EF           MOV     A,R7
   \   000072   5408         ANL     A,#0x8
   \   000074   F9           MOV     R1,A
   \   000075   E8           MOV     A,R0
   \   000076   49           ORL     A,R1
   \   000077   600D         JZ      ??ZDApp_ProcessSecEvent_5
    559            {
    560              ZDSecMgrSaveTCLinkKey();
   \   000079                ; Setup parameters for call to function ZDSecMgrSaveTCLinkKey
   \   000079   12....       LCALL   ??ZDSecMgrSaveTCLinkKey?relay
    561          
    562              // Return unprocessed events
    563              return (events ^ ZDO_TCLK_FRAMECOUNTER_CHANGE);
   \   00007C   EE           MOV     A,R6
   \   00007D   6400         XRL     A,#0x0
   \   00007F   FA           MOV     R2,A
   \   000080   EF           MOV     A,R7
   \   000081   6408         XRL     A,#0x8
   \   000083   FB           MOV     R3,A
   \   000084   8004         SJMP    ??ZDApp_ProcessSecEvent_1
    564            }
    565          
    566            // Discard or make more handlers
    567            return 0;
   \                     ??ZDApp_ProcessSecEvent_5:
   \   000086   7A00         MOV     R2,#0x0
   \   000088   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_1:
   \   00008A   7F01         MOV     R7,#0x1
   \   00008C   02....       LJMP    ?BANKED_LEAVE_XDATA
    568          }
    569          
    570          /*********************************************************************
    571           * Application Functions
    572           */
    573          
    574          /*********************************************************************
    575           * @fn      ZDOInitDevice
    576           *
    577           * @brief   Start the device in the network.  This function will read
    578           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    579           *   restore the network state of the device.
    580           *
    581           * @param   startDelay - timeDelay to start device (in milliseconds).
    582           *                       There is a jitter added to this delay:
    583           *                       ((NWK_START_DELAY + startDelay)
    584           *                       + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    585           *                       When startDelay is set to ZDO_INIT_HOLD_NWK_START
    586           *                       this function will hold the network init. Application
    587           *                       can start the device.
    588           *
    589           * NOTE:    If the application would like to force a "new" join, the
    590           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    591           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    592           *          this function. "new" join means to not restore the network
    593           *          state of the device. Use zgWriteStartupOptions() to set these
    594           *          options.
    595           *
    596           * @return
    597           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    598           *          restored.
    599           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    600           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    601           *          it could mean that there was no network state to restore.
    602           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    603           *          with the rejoin option set to TRUE.  So, the device was not
    604           *          started in the network (one time only).  The next time this
    605           *          function is called it will start.
    606           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    607          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    608          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
    609            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   000015   75..01       MOV     ?V0 + 0,#0x1
    610            uint16 extendedDelay = 0;
   \   000018   7E00         MOV     R6,#0x0
   \   00001A   7F00         MOV     R7,#0x0
    611          
    612            if ( devState == DEV_HOLD )
   \   00001C   90....       MOV     DPTR,#devState
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   7005         JNZ     ??ZDOInitDevice_0
    613            {
    614              // Initialize the RAM items table, in case an NV item has been updated.
    615              zgInitItems( FALSE );
   \   000022                ; Setup parameters for call to function zgInitItems
   \   000022   7900         MOV     R1,#0x0
   \   000024   12....       LCALL   ??zgInitItems?relay
    616            }
    617          
    618            ZDConfig_InitDescriptors();
   \                     ??ZDOInitDevice_0:
   \   000027                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   000027   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    619            //devtag.071807.todo - fix this temporary solution
    620            _NIB.CapabilityFlags = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   00002A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   90....       MOV     DPTR,#_NIB + 14
   \   000031   F0           MOVX    @DPTR,A
    621          
    622          #if defined ( NV_RESTORE )
    623            // Get Keypad directly to see if a reset nv is needed.
    624            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    625            // while booting to skip past NV Restore.
    626            if ( HalKeyRead() == SW_BYPASS_NV )
    627              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    628            else
    629            {
    630              // Determine if NV should be restored
    631              networkStateNV = ZDApp_ReadNetworkRestoreState();
    632            }
    633          
    634            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    635            {
    636              networkStateNV = ZDApp_RestoreNetworkState();
    637            }
    638            else
    639            {
    640              // Wipe out the network state in NV
    641              NLME_InitNV();
    642              NLME_SetDefaultNV();
    643              // clear NWK key values
    644              ZDSecMgrClearNVKeyValues();
    645            }
    646          #endif
    647          
    648            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
   \   000032   7401         MOV     A,#0x1
   \   000034   65..         XRL     A,?V0 + 0
   \   000036   7031         JNZ     ??ZDOInitDevice_1
    649            {
    650              ZDAppDetermineDeviceType();
   \   000038                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000038   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    651          
    652              // Only delay if joining network - not restoring network state
    653              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    654                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   00003B                ; Setup parameters for call to function osal_rand
   \   00003B   12....       LCALL   ??osal_rand?relay
   \   00003E   8A..         MOV     ?V0 + 2,R2
   \   000040   8B..         MOV     ?V0 + 3,R3
   \   000042   A8..         MOV     R0,?V0 + 2
   \   000044   A9..         MOV     R1,?V0 + 3
   \   000046   85..82       MOV     DPL,?XSP + 0
   \   000049   85..83       MOV     DPH,?XSP + 1
   \   00004C   E5..         MOV     A,?V0 + 2
   \   00004E   547F         ANL     A,#0x7f
   \   000050   F8           MOV     R0,A
   \   000051   E5..         MOV     A,?V0 + 3
   \   000053   5400         ANL     A,#0x0
   \   000055   F9           MOV     R1,A
   \   000056   E0           MOVX    A,@DPTR
   \   000057   28           ADD     A,R0
   \   000058   F8           MOV     R0,A
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   39           ADDC    A,R1
   \   00005C   F9           MOV     R1,A
   \   00005D   E8           MOV     A,R0
   \   00005E   2464         ADD     A,#0x64
   \   000060   F8           MOV     R0,A
   \   000061   E9           MOV     A,R1
   \   000062   3400         ADDC    A,#0x0
   \   000064   F9           MOV     R1,A
   \   000065   E8           MOV     A,R0
   \   000066   FE           MOV     R6,A
   \   000067   E9           MOV     A,R1
   \   000068   FF           MOV     R7,A
    655            }
    656          
    657            // Initialize the security for type of device
    658            ZDApp_SecInit( networkStateNV );
   \                     ??ZDOInitDevice_1:
   \   000069                ; Setup parameters for call to function ZDApp_SecInit
   \   000069   A9..         MOV     R1,?V0 + 0
   \   00006B   12....       LCALL   ??ZDApp_SecInit?relay
    659          
    660            if( ZDO_INIT_HOLD_NWK_START != startDelay )
   \   00006E   85..82       MOV     DPL,?XSP + 0
   \   000071   85..83       MOV     DPH,?XSP + 1
   \   000074   E0           MOVX    A,@DPTR
   \   000075   64FF         XRL     A,#0xff
   \   000077   7004         JNZ     ??ZDOInitDevice_2
   \   000079   A3           INC     DPTR
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   64FF         XRL     A,#0xff
   \                     ??ZDOInitDevice_2:
   \   00007D   6040         JZ      ??ZDOInitDevice_3
    661            {
    662              devState = DEV_INIT;    // Remove the Hold state
   \   00007F   90....       MOV     DPTR,#devState
   \   000082   7401         MOV     A,#0x1
   \   000084   F0           MOVX    @DPTR,A
    663          
    664              // Initialize leave control logic
    665              ZDApp_LeaveCtrlInit();
   \   000085                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000085   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    666          
    667              // Check leave control reset settings
    668              ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   000088                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   000088   85..82       MOV     DPL,?XSP + 0
   \   00008B   85..83       MOV     DPH,?XSP + 1
   \   00008E   AC82         MOV     R4,DPL
   \   000090   AD83         MOV     R5,DPH
   \   000092   7A..         MOV     R2,#devState & 0xff
   \   000094   7B..         MOV     R3,#(devState >> 8) & 0xff
   \   000096   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    669          
    670              // Leave may make the hold state come back
    671              if ( devState == DEV_HOLD )
   \   000099   90....       MOV     DPTR,#devState
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   7019         JNZ     ??ZDOInitDevice_4
    672              {
    673                // Set the NV startup option to force a "new" join.
    674                zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   00009F                ; Setup parameters for call to function zgWriteStartupOptions
   \   00009F   7A02         MOV     R2,#0x2
   \   0000A1   79FF         MOV     R1,#-0x1
   \   0000A3   12....       LCALL   ??zgWriteStartupOptions?relay
   \   0000A6   E9           MOV     A,R1
    675          
    676                // Notify the applications
    677                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   0000A7                ; Setup parameters for call to function osal_set_event
   \   0000A7   7A10         MOV     R2,#0x10
   \   0000A9   7B00         MOV     R3,#0x0
   \   0000AB   90....       MOV     DPTR,#ZDAppTaskID
   \   0000AE   E0           MOVX    A,@DPTR
   \   0000AF   F9           MOV     R1,A
   \   0000B0   12....       LCALL   ??osal_set_event?relay
   \   0000B3   E9           MOV     A,R1
    678          
    679                return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \   0000B4   7902         MOV     R1,#0x2
   \   0000B6   8011         SJMP    ??ZDOInitDevice_5
    680              }
    681          
    682              // Trigger the network start
    683              ZDApp_NetworkInit( extendedDelay );
   \                     ??ZDOInitDevice_4:
   \   0000B8                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000B8   EE           MOV     A,R6
   \   0000B9   FA           MOV     R2,A
   \   0000BA   EF           MOV     A,R7
   \   0000BB   FB           MOV     R3,A
   \   0000BC   12....       LCALL   ??ZDApp_NetworkInit?relay
    684            }
    685          
    686            // set broadcast address mask to support broadcast filtering
    687            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \                     ??ZDOInitDevice_3:
   \   0000BF                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   0000BF   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   0000C2   E0           MOVX    A,@DPTR
   \   0000C3   F9           MOV     R1,A
   \   0000C4   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    688          
    689            return ( networkStateNV );
   \   0000C7   A9..         MOV     R1,?V0 + 0
   \                     ??ZDOInitDevice_5:
   \   0000C9   7402         MOV     A,#0x2
   \   0000CB   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000CE   7F04         MOV     R7,#0x4
   \   0000D0   02....       LJMP    ?BANKED_LEAVE_XDATA
    690          }
    691          
    692          /*********************************************************************
    693           * @fn      ZDApp_ReadNetworkRestoreState
    694           *
    695           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    696           *          or not to restore the network state.
    697           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    698           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    699           *
    700           * @param   none
    701           *
    702           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    703           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    704           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    705           *          ZCD_NV_STARTUP_OPTION
    706           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    707          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    708          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    709            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    710          
    711            // Look for the New Network State option.
    712            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   F8           MOV     R0,A
   \   00000C   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000E   5002         JNC     ??ZDApp_ReadNetworkRestoreState_0
    713            {
    714              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   000010   7E01         MOV     R6,#0x1
    715            }
    716          
    717            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000012   EE           MOV     A,R6
   \   000013   F9           MOV     R1,A
   \   000014   7F01         MOV     R7,#0x1
   \   000016   02....       LJMP    ?BANKED_LEAVE_XDATA
    718          }
    719          
    720          /*********************************************************************
    721           * @fn      ZDAppDetermineDeviceType()
    722           *
    723           * @brief   Determines the type of device to start.
    724           *
    725           *          Looks at zgDeviceLogicalType and determines what type of
    726           *          device to start.  The types are:
    727           *            ZG_DEVICETYPE_COORDINATOR
    728           *            ZG_DEVICETYPE_ROUTER
    729           *            ZG_DEVICETYPE_ENDDEVICE
    730           *
    731           * @param   none
    732           *
    733           * @return  none
    734           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    735          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    736          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    737            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700F         JNZ     ??ZDAppDetermineDeviceType_0
    738            {
    739              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   90....       MOV     DPTR,#devStartMode
   \   00000D   7402         MOV     A,#0x2
   \   00000F   F0           MOVX    @DPTR,A
    740              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   F0           MOVX    @DPTR,A
   \   000017   8042         SJMP    ??ZDAppDetermineDeviceType_1
    741            }
    742            else
    743            {
    744              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000019   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6401         XRL     A,#0x1
   \   00001F   700E         JNZ     ??ZDAppDetermineDeviceType_2
    745                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   000021   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000024   E0           MOVX    A,@DPTR
   \   000025   54F8         ANL     A,#0xf8
   \   000027   4401         ORL     A,#0x1
   \   000029   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002C   F0           MOVX    @DPTR,A
   \   00002D   8014         SJMP    ??ZDAppDetermineDeviceType_3
    746              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   00002F   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000032   E0           MOVX    A,@DPTR
   \   000033   6402         XRL     A,#0x2
   \   000035   700C         JNZ     ??ZDAppDetermineDeviceType_3
    747                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000037   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00003A   E0           MOVX    A,@DPTR
   \   00003B   54F8         ANL     A,#0xf8
   \   00003D   4402         ORL     A,#0x2
   \   00003F   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000042   F0           MOVX    @DPTR,A
    748          
    749              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    750              // The device shall do rejoin the network. Otherwise, do normal join
    751              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_3:
   \   000043                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000043   7A..         MOV     R2,#AIB_apsUseExtendedPANID & 0xff
   \   000045   7B..         MOV     R3,#(AIB_apsUseExtendedPANID >> 8) & 0xff
   \   000047   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00004A   E9           MOV     A,R1
   \   00004B   7008         JNZ     ??ZDAppDetermineDeviceType_4
    752              {
    753                devStartMode = MODE_JOIN;     // Assume joining
   \   00004D   90....       MOV     DPTR,#devStartMode
   \   000050   7400         MOV     A,#0x0
   \   000052   F0           MOVX    @DPTR,A
   \   000053   8006         SJMP    ??ZDAppDetermineDeviceType_1
    754              }
    755              else
    756              {
    757                devStartMode = MODE_REJOIN;
   \                     ??ZDAppDetermineDeviceType_4:
   \   000055   90....       MOV     DPTR,#devStartMode
   \   000058   7403         MOV     A,#0x3
   \   00005A   F0           MOVX    @DPTR,A
    758              }
    759            }
    760          }
   \                     ??ZDAppDetermineDeviceType_1:
   \   00005B   D083         POP     DPH
   \   00005D   D082         POP     DPL
   \   00005F   02....       LJMP    ?BRET
    761          
    762          /*********************************************************************
    763           * @fn      ZDApp_NetworkStartEvt()
    764           *
    765           * @brief   Process the Network Start Event
    766           *
    767           * @param   none
    768           *
    769           * @return  none
    770           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    771          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    772          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    773            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7022         JNZ     ??ZDApp_NetworkStartEvt_0
    774            {
    775              // Successfully started a ZigBee network
    776              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7006         JNZ     ??ZDApp_NetworkStartEvt_1
    777              {
    778                devState = DEV_ZB_COORD;
   \   000012   90....       MOV     DPTR,#devState
   \   000015   7409         MOV     A,#0x9
   \   000017   F0           MOVX    @DPTR,A
    779              }
    780          
    781              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000018                ; Setup parameters for call to function osal_pwrmgr_device
   \   000018   7900         MOV     R1,#0x0
   \   00001A   12....       LCALL   ??osal_pwrmgr_device?relay
    782              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001D                ; Setup parameters for call to function osal_set_event
   \   00001D   7A10         MOV     R2,#0x10
   \   00001F   7B00         MOV     R3,#0x0
   \   000021   90....       MOV     DPTR,#ZDAppTaskID
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F9           MOV     R1,A
   \   000026   12....       LCALL   ??osal_set_event?relay
   \   000029   E9           MOV     A,R1
   \   00002A   8048         SJMP    ??ZDApp_NetworkStartEvt_2
    783            }
    784            else
    785            {
    786              // Try again with a higher energy threshold !!
    787              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00002C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00002C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00002F   E9           MOV     A,R1
   \   000030   F8           MOV     R0,A
   \   000031   7900         MOV     R1,#0x0
   \   000033   2410         ADD     A,#0x10
   \   000035   F8           MOV     R0,A
   \   000036   E9           MOV     A,R1
   \   000037   3400         ADDC    A,#0x0
   \   000039   F9           MOV     R1,A
   \   00003A   C3           CLR     C
   \   00003B   E8           MOV     A,R0
   \   00003C   94FF         SUBB    A,#-0x1
   \   00003E   E9           MOV     A,R1
   \   00003F   9400         SUBB    A,#0x0
   \   000041   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000043   65D0         XRL     A,PSW
   \   000045   33           RLC     A
   \   000046   5019         JNC     ??ZDApp_NetworkStartEvt_3
    788              {
    789                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000048                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000048                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000048   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00004B   E9           MOV     A,R1
   \   00004C   2410         ADD     A,#0x10
   \   00004E   F9           MOV     R1,A
   \   00004F   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    790                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   000052                ; Setup parameters for call to function osal_set_event
   \   000052   7A01         MOV     R2,#0x1
   \   000054   7B00         MOV     R3,#0x0
   \   000056   90....       MOV     DPTR,#ZDAppTaskID
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F9           MOV     R1,A
   \   00005B   12....       LCALL   ??osal_set_event?relay
   \   00005E   E9           MOV     A,R1
   \   00005F   8013         SJMP    ??ZDApp_NetworkStartEvt_2
    791              }
    792              else
    793              {
    794                // Failed to start network. Enter a dormant state (until user intervenes)
    795                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000061   90....       MOV     DPTR,#devState
   \   000064   7401         MOV     A,#0x1
   \   000066   F0           MOVX    @DPTR,A
    796                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000067                ; Setup parameters for call to function osal_set_event
   \   000067   7A10         MOV     R2,#0x10
   \   000069   7B00         MOV     R3,#0x0
   \   00006B   90....       MOV     DPTR,#ZDAppTaskID
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F9           MOV     R1,A
   \   000070   12....       LCALL   ??osal_set_event?relay
   \   000073   E9           MOV     A,R1
    797              }
    798            }
    799          }
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000074   D083         POP     DPH
   \   000076   D082         POP     DPL
   \   000078   02....       LJMP    ?BRET
    800          
    801          /*********************************************************************
    802           * @fn      ZDApp_DeviceAuthEvt()
    803           *
    804           * @brief   Process the Device Authentic Event
    805           *
    806           * @param   none
    807           *
    808           * @return  none
    809           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    810          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    811          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    812            // received authentication from trust center
    813            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   7034         JNZ     ??ZDApp_DeviceAuthEvt_0
    814            {
    815              // Stop the reset timer so it doesn't reset
    816              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    817          
    818              devState = DEV_END_DEVICE;
   \   00000F   90....       MOV     DPTR,#devState
   \   000012   7406         MOV     A,#0x6
   \   000014   F0           MOVX    @DPTR,A
    819              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000015                ; Setup parameters for call to function osal_set_event
   \   000015   7A10         MOV     R2,#0x10
   \   000017   7B00         MOV     R3,#0x0
   \   000019   90....       MOV     DPTR,#ZDAppTaskID
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   12....       LCALL   ??osal_set_event?relay
   \   000021   E9           MOV     A,R1
    820          
    821              // Set the Power Manager Device
    822          #if defined ( POWER_SAVING )
    823              osal_pwrmgr_device( PWRMGR_BATTERY );
    824          #endif
    825          
    826              if ( ZSTACK_ROUTER_BUILD )
    827              {
    828                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
    829                {
    830                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    831                  NLME_StartRouterRequest( 0, 0, false );
    832                }
    833              }
    834          
    835              // Notify to save info into NV
    836              ZDApp_NVUpdate();
   \   000022                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000022   12....       LCALL   ??ZDApp_NVUpdate?relay
    837          
    838              // Save off the security
    839              ZDApp_SaveNwkKey();
   \   000025                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000025   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    840          
    841              ZDApp_AnnounceNewAddress();
   \   000028                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000028   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    842          
    843              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   00002B   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   A2E3         MOV     C,0xE0 /* A   */.3
   \   000031   4010         JC      ??ZDApp_DeviceAuthEvt_1
    844              {
    845                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   000033                ; Setup parameters for call to function NLME_SetPollRate
   \   000033   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000036   E0           MOVX    A,@DPTR
   \   000037   FA           MOV     R2,A
   \   000038   A3           INC     DPTR
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   FB           MOV     R3,A
   \   00003B   12....       LCALL   ??NLME_SetPollRate?relay
   \   00003E   8003         SJMP    ??ZDApp_DeviceAuthEvt_1
    846              }
    847            }
    848            else
    849            {
    850              ZDApp_NVUpdate();
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   000040                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000040   12....       LCALL   ??ZDApp_NVUpdate?relay
    851            }
    852          }
   \                     ??ZDApp_DeviceAuthEvt_1:
   \   000043   D083         POP     DPH
   \   000045   D082         POP     DPL
   \   000047   02....       LJMP    ?BRET
    853          
    854          /*********************************************************************
    855           * @fn      ZDApp_SaveNetworkStateEvt()
    856           *
    857           * @brief   Process the Save the Network State Event
    858           *
    859           * @param   none
    860           *
    861           * @return  none
    862           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    863          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    864          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    865          #if defined ( NV_RESTORE )
    866           #if defined ( NV_TURN_OFF_RADIO )
    867            // Turn off the radio's receiver during an NV update
    868            uint8 RxOnIdle;
    869            uint8 x = false;
    870            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    871            ZMacSetReq( ZMacRxOnIdle, &x );
    872           #endif
    873          
    874            // Update the Network State in NV
    875            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    876                           NWK_NV_DEVICELIST_ENABLE |
    877                           NWK_NV_BINDING_ENABLE    |
    878                           NWK_NV_ADDRMGR_ENABLE );
    879          
    880            // Reset the NV startup option to resume from NV by
    881            // clearing the "New" join option.
    882            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    883          
    884           #if defined ( NV_TURN_OFF_RADIO )
    885            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    886           #endif
    887          #endif  // NV_RESTORE
    888          }
   \   000000   02....       LJMP    ?BRET
    889          
    890          /*********************************************************************
    891           * @fn      ZDApp_RestoreNetworkState()
    892           *
    893           * @brief   This function will restore the network state of the
    894           *          device if the network state is stored in NV.
    895           *
    896           * @param   none
    897           *
    898           * @return
    899           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    900           *          restored.
    901           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    902           *          This could mean that zgStartupOption said to not restore, or
    903           *          it could mean that there was no network state to restore.
    904           *
    905           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    906          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    907          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    908            uint8 nvStat;
    909          
    910            // Initialize NWK NV items
    911            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    912          
    913            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   6039         JZ      ??ZDApp_RestoreNetworkState_0
    914            {
    915              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6031         JZ      ??ZDApp_RestoreNetworkState_1
    916              {
    917                // Are we a coordinator
    918                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   EA           MOV     A,R2
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   EB           MOV     A,R3
   \   00001F   F0           MOVX    @DPTR,A
    919                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \   000020   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F8           MOV     R0,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F9           MOV     R1,A
   \   000028   E8           MOV     A,R0
   \   000029   49           ORL     A,R1
   \   00002A   7007         JNZ     ??ZDApp_RestoreNetworkState_2
    920                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   00002C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   54F8         ANL     A,#0xf8
   \   000032   F0           MOVX    @DPTR,A
    921                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_2:
   \   000033   90....       MOV     DPTR,#devStartMode
   \   000036   7401         MOV     A,#0x1
   \   000038   F0           MOVX    @DPTR,A
    922                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   000039                ; Setup parameters for call to function sAddrExtCpy
   \   000039   7C..         MOV     R4,#(_NIB + 53) & 0xff
   \   00003B   7D..         MOV     R5,#((_NIB + 53) >> 8) & 0xff
   \   00003D   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00003F   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000041   12....       LCALL   ??sAddrExtCpy?relay
   \   000044   8002         SJMP    ??ZDApp_RestoreNetworkState_0
    923              }
    924              else
    925                nvStat = NV_ITEM_UNINIT;
   \                     ??ZDApp_RestoreNetworkState_1:
   \   000046   7E09         MOV     R6,#0x9
    926          
    927              if ( ZG_SECURE_ENABLED )
    928              {
    929                nwkFrameCounterChanges = 0;
    930          
    931                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    932                {
    933                  ZDApp_RestoreNwkKey();
    934                }
    935              }
    936          
    937              // The default for RxOnWhenIdle is true for Routers and false for end devices
    938              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    939              // other than default.
    940            }
    941          
    942            if ( nvStat == ZSUCCESS )
   \                     ??ZDApp_RestoreNetworkState_0:
   \   000048   EE           MOV     A,R6
   \   000049   7004         JNZ     ??ZDApp_RestoreNetworkState_3
    943              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   00004B   7900         MOV     R1,#0x0
   \   00004D   8002         SJMP    ??ZDApp_RestoreNetworkState_4
    944            else
    945              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_3:
   \   00004F   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_4:
   \   000051   7F01         MOV     R7,#0x1
   \   000053   02....       LJMP    ?BANKED_LEAVE_XDATA
    946          }
    947          
    948          /*********************************************************************
    949           * @fn      ZDApp_InitUserDesc()
    950           *
    951           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    952           *          when needed.  If you want to initialize the User descriptor to
    953           *          something other than all zero, do it here.
    954           *
    955           * @param   none
    956           *
    957           * @return  none
    958           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    959          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    960          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    961            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    962          
    963            // Initialize the User Descriptor, the descriptor is read from NV
    964            // when needed.  If you want to initialize the User descriptor to something
    965            // other than all zero, do it here.
    966            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
    967            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    968                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   00001D                ; Setup parameters for call to function osal_nv_item_init
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C11         MOV     R4,#0x11
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A81         MOV     R2,#-0x7f
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_item_init?relay
   \   000039   7402         MOV     A,#0x2
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003E   E9           MOV     A,R1
   \   00003F   703F         JNZ     ??ZDApp_InitUserDesc_0
    969            {
    970              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    971                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000041                ; Setup parameters for call to function osal_nv_read
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   8582..       MOV     ?V0 + 0,DPL
   \   00004A   8583..       MOV     ?V0 + 1,DPH
   \   00004D   78..         MOV     R0,#?V0 + 0
   \   00004F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000052   75..11       MOV     ?V0 + 0,#0x11
   \   000055   75..00       MOV     ?V0 + 1,#0x0
   \   000058   78..         MOV     R0,#?V0 + 0
   \   00005A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005D   7C00         MOV     R4,#0x0
   \   00005F   7D00         MOV     R5,#0x0
   \   000061   7A81         MOV     R2,#-0x7f
   \   000063   7B00         MOV     R3,#0x0
   \   000065   12....       LCALL   ??osal_nv_read?relay
   \   000068   7404         MOV     A,#0x4
   \   00006A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006D   E9           MOV     A,R1
   \   00006E   7010         JNZ     ??ZDApp_InitUserDesc_0
    972              {
    973                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000070   85..82       MOV     DPL,?XSP + 0
   \   000073   85..83       MOV     DPH,?XSP + 1
   \   000076   E0           MOVX    A,@DPTR
   \   000077   6007         JZ      ??ZDApp_InitUserDesc_0
    974                {
    975                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000079   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   D2E4         SETB    0xE0 /* A   */.4
   \   00007F   F0           MOVX    @DPTR,A
    976                }
    977              }
    978            }
    979          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000080   7411         MOV     A,#0x11
   \   000082   12....       LCALL   ?DEALLOC_XSTACK8
   \   000085   7F02         MOV     R7,#0x2
   \   000087   02....       LJMP    ?BANKED_LEAVE_XDATA
    980          
    981          /*********************************************************************
    982           * @fn      ZDAppCheckForHoldKey()
    983           *
    984           * @brief   Check for key to set the device into Hold Auto Start
    985           *
    986           * @param   none
    987           *
    988           * @return  none
    989           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    990          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
    991          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    992          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
    993            // Get Keypad directly to see if a HOLD_START is needed.
    994            // Hold down the SW_BYPASS_START key (see OnBoard.h)
    995            // while booting to avoid starting up the device.
    996            if ( HalKeyRead () == SW_BYPASS_START)
    997            {
    998              // Change the device state to HOLD on start up
    999              devState = DEV_HOLD;
   1000            }
   1001          #endif // HAL_KEY
   1002          }
   \   000000   02....       LJMP    ?BRET
   1003          
   1004          /*********************************************************************
   1005           * @fn      ZDApp_ProcessOSALMsg()
   1006           *
   1007           * @brief   Process the incoming task message.
   1008           *
   1009           * @param   msgPtr - message to process
   1010           *
   1011           * @return  none
   1012           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1013          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
   1014          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1015            // Data Confirmation message fields
   1016            uint8 sentEP;       // This should always be 0
   1017            uint8 sentStatus;
   1018            afDataConfirm_t *afDataConfirm;
   1019            uint8 tmp;
   1020          
   1021            switch ( msgPtr->event )
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   E0           MOVX    A,@DPTR
   \   000013   14           DEC     A
   \   000014   604B         JZ      ??ZDApp_ProcessOSALMsg_0
   \   000016   14           DEC     A
   \   000017   7003         JNZ     $+5
   \   000019   02....       LJMP    ??ZDApp_ProcessOSALMsg_1 & 0xFFFF
   \   00001C   14           DEC     A
   \   00001D   7003         JNZ     $+5
   \   00001F   02....       LJMP    ??ZDApp_ProcessOSALMsg_2 & 0xFFFF
   \   000022   24E9         ADD     A,#-0x17
   \   000024   600B         JZ      ??ZDApp_ProcessOSALMsg_3
   \   000026   2447         ADD     A,#0x47
   \   000028   6011         JZ      ??ZDApp_ProcessOSALMsg_4
   \   00002A   24D6         ADD     A,#-0x2a
   \   00002C   6017         JZ      ??ZDApp_ProcessOSALMsg_5
   \   00002E   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1022            {
   1023              // Incoming ZDO Message
   1024              case AF_INCOMING_MSG_CMD:
   1025                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   000031                ; Setup parameters for call to function ZDP_IncomingData
   \   000031   EE           MOV     A,R6
   \   000032   FA           MOV     R2,A
   \   000033   EF           MOV     A,R7
   \   000034   FB           MOV     R3,A
   \   000035   12....       LCALL   ??ZDP_IncomingData?relay
   1026                break;
   \   000038   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1027          
   1028              case ZDO_CB_MSG:
   1029                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   00003B                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   00003B   EE           MOV     A,R6
   \   00003C   FA           MOV     R2,A
   \   00003D   EF           MOV     A,R7
   \   00003E   FB           MOV     R3,A
   \   00003F   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   1030                break;
   \   000042   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1031          
   1032              case AF_DATA_CONFIRM_CMD:
   1033                // This message is received as a confirmation of a data packet sent.
   1034                // The status is of ZStatus_t type [defined in NLMEDE.h]
   1035                // The message fields are defined in AF.h
   1036                afDataConfirm = (afDataConfirm_t *)msgPtr;
   \                     ??ZDApp_ProcessOSALMsg_5:
   \   000045   8E..         MOV     ?V0 + 2,R6
   \   000047   8F..         MOV     ?V0 + 3,R7
   1037                sentEP = afDataConfirm->endpoint;
   \   000049   85..82       MOV     DPL,?V0 + 2
   \   00004C   85..83       MOV     DPH,?V0 + 3
   \   00004F   A3           INC     DPTR
   \   000050   A3           INC     DPTR
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F5..         MOV     ?V0 + 5,A
   1038                sentStatus = afDataConfirm->hdr.status;
   \   000054   85..82       MOV     DPL,?V0 + 2
   \   000057   85..83       MOV     DPH,?V0 + 3
   \   00005A   A3           INC     DPTR
   \   00005B   E0           MOVX    A,@DPTR
   \   00005C   F5..         MOV     ?V0 + 4,A
   1039          
   1040                // Action taken when confirmation is received.
   1041          #if defined ( ZIGBEE_FREQ_AGILITY )
   1042                if ( pZDNwkMgr_ProcessDataConfirm )
   1043                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
   1044          #endif
   1045                (void)sentEP;
   1046                (void)sentStatus;
   1047                break;
   \   00005E   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1048          
   1049              case ZDO_NWK_DISC_CNF:
   1050                if (devState != DEV_NWK_DISC)
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000061   90....       MOV     DPTR,#devState
   \   000064   E0           MOVX    A,@DPTR
   \   000065   6402         XRL     A,#0x2
   \   000067   6003         JZ      $+5
   \   000069   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1051                  break;
   1052          
   1053                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \   00006C   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   6401         XRL     A,#0x1
   \   000072   600B         JZ      ??ZDApp_ProcessOSALMsg_7
   \   000074   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000077   E0           MOVX    A,@DPTR
   \   000078   6402         XRL     A,#0x2
   \   00007A   6003         JZ      $+5
   \   00007C   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1054                {
   1055                  // Process the network discovery scan results and choose a parent
   1056                  // device to join/rejoin itself
   1057                  networkDesc_t *pChosenNwk;
   1058                  if ( ( (pChosenNwk = ZDApp_NwkDescListProcessing()) != NULL ) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   \                     ??ZDApp_ProcessOSALMsg_7:
   \   00007F                ; Setup parameters for call to function ZDApp_NwkDescListProcessing
   \   00007F   12....       LCALL   ??ZDApp_NwkDescListProcessing?relay
   \   000082   8A..         MOV     ?V0 + 6,R2
   \   000084   8B..         MOV     ?V0 + 7,R3
   \   000086   A8..         MOV     R0,?V0 + 6
   \   000088   A9..         MOV     R1,?V0 + 7
   \   00008A   88..         MOV     ?V0 + 0,R0
   \   00008C   89..         MOV     ?V0 + 1,R1
   \   00008E   E8           MOV     A,R0
   \   00008F   49           ORL     A,R1
   \   000090   7003         JNZ     $+5
   \   000092   02....       LJMP    ??ZDApp_ProcessOSALMsg_8 & 0xFFFF
   \   000095   90....       MOV     DPTR,#zdoDiscCounter
   \   000098   E0           MOVX    A,@DPTR
   \   000099   C3           CLR     C
   \   00009A   9403         SUBB    A,#0x3
   \   00009C   5003         JNC     $+5
   \   00009E   02....       LJMP    ??ZDApp_ProcessOSALMsg_8 & 0xFFFF
   1059                  {
   1060                    if ( devStartMode == MODE_JOIN )
   \   0000A1   90....       MOV     DPTR,#devStartMode
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   6003         JZ      $+5
   \   0000A7   02....       LJMP    ??ZDApp_ProcessOSALMsg_9 & 0xFFFF
   1061                    {
   1062                      devState = DEV_NWK_JOINING;
   \   0000AA   90....       MOV     DPTR,#devState
   \   0000AD   7403         MOV     A,#0x3
   \   0000AF   F0           MOVX    @DPTR,A
   1063          
   1064                      ZDApp_NodeProfileSync( pChosenNwk->stackProfile);
   \   0000B0                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   0000B0   85..82       MOV     DPL,?V0 + 0
   \   0000B3   85..83       MOV     DPH,?V0 + 1
   \   0000B6   A3           INC     DPTR
   \   0000B7   A3           INC     DPTR
   \   0000B8   A3           INC     DPTR
   \   0000B9   A3           INC     DPTR
   \   0000BA   A3           INC     DPTR
   \   0000BB   A3           INC     DPTR
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   F9           MOV     R1,A
   \   0000BE   12....       LCALL   ??ZDApp_NodeProfileSync?relay
   1065          
   1066                      if ( NLME_JoinRequest( pChosenNwk->extendedPANID, pChosenNwk->panId,
   1067                                            pChosenNwk->logicalChannel,
   1068                                            ZDO_Config_Node_Descriptor.CapabilityFlags,
   1069                                            pChosenNwk->chosenRouter, pChosenNwk->chosenRouterDepth ) != ZSuccess )
   \   0000C1                ; Setup parameters for call to function NLME_JoinRequest
   \   0000C1   85..82       MOV     DPL,?V0 + 0
   \   0000C4   85..83       MOV     DPH,?V0 + 1
   \   0000C7   A3           INC     DPTR
   \   0000C8   A3           INC     DPTR
   \   0000C9   A3           INC     DPTR
   \   0000CA   A3           INC     DPTR
   \   0000CB   A3           INC     DPTR
   \   0000CC   A3           INC     DPTR
   \   0000CD   A3           INC     DPTR
   \   0000CE   A3           INC     DPTR
   \   0000CF   A3           INC     DPTR
   \   0000D0   A3           INC     DPTR
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   F5..         MOV     ?V0 + 6,A
   \   0000D4   78..         MOV     R0,#?V0 + 6
   \   0000D6   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000D9   85..82       MOV     DPL,?V0 + 0
   \   0000DC   85..83       MOV     DPH,?V0 + 1
   \   0000DF   A3           INC     DPTR
   \   0000E0   A3           INC     DPTR
   \   0000E1   A3           INC     DPTR
   \   0000E2   A3           INC     DPTR
   \   0000E3   A3           INC     DPTR
   \   0000E4   A3           INC     DPTR
   \   0000E5   A3           INC     DPTR
   \   0000E6   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   0000E9   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   0000EC   E0           MOVX    A,@DPTR
   \   0000ED   F5..         MOV     ?V0 + 6,A
   \   0000EF   78..         MOV     R0,#?V0 + 6
   \   0000F1   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000F4   85..82       MOV     DPL,?V0 + 0
   \   0000F7   85..83       MOV     DPH,?V0 + 1
   \   0000FA   A3           INC     DPTR
   \   0000FB   A3           INC     DPTR
   \   0000FC   E0           MOVX    A,@DPTR
   \   0000FD   F9           MOV     R1,A
   \   0000FE   85..82       MOV     DPL,?V0 + 0
   \   000101   85..83       MOV     DPH,?V0 + 1
   \   000104   E0           MOVX    A,@DPTR
   \   000105   FC           MOV     R4,A
   \   000106   A3           INC     DPTR
   \   000107   E0           MOVX    A,@DPTR
   \   000108   FD           MOV     R5,A
   \   000109   E5..         MOV     A,?V0 + 0
   \   00010B   240B         ADD     A,#0xb
   \   00010D   FA           MOV     R2,A
   \   00010E   E5..         MOV     A,?V0 + 1
   \   000110   3400         ADDC    A,#0x0
   \   000112   FB           MOV     R3,A
   \   000113   12....       LCALL   ??NLME_JoinRequest?relay
   \   000116   7404         MOV     A,#0x4
   \   000118   12....       LCALL   ?DEALLOC_XSTACK8
   \   00011B   E9           MOV     A,R1
   \   00011C   7003         JNZ     $+5
   \   00011E   02....       LJMP    ??ZDApp_ProcessOSALMsg_10 & 0xFFFF
   1070                      {
   1071                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1072                                                    + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   000121                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000121                ; Setup parameters for call to function osal_rand
   \   000121   12....       LCALL   ??osal_rand?relay
   \   000124   8A..         MOV     ?V0 + 6,R2
   \   000126   8B..         MOV     ?V0 + 7,R3
   \   000128   E5..         MOV     A,?V0 + 6
   \   00012A   547F         ANL     A,#0x7f
   \   00012C   F8           MOV     R0,A
   \   00012D   E5..         MOV     A,?V0 + 7
   \   00012F   5400         ANL     A,#0x0
   \   000131   F9           MOV     R1,A
   \   000132   E8           MOV     A,R0
   \   000133   2464         ADD     A,#0x64
   \   000135   FA           MOV     R2,A
   \   000136   E9           MOV     A,R1
   \   000137   3400         ADDC    A,#0x0
   \   000139   FB           MOV     R3,A
   \   00013A   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   00013D   02....       LJMP    ??ZDApp_ProcessOSALMsg_10 & 0xFFFF
   1073                      }
   1074                    } // if ( devStartMode == MODE_JOIN )
   1075                    else if ( devStartMode == MODE_REJOIN )
   \                     ??ZDApp_ProcessOSALMsg_9:
   \   000140   90....       MOV     DPTR,#devStartMode
   \   000143   E0           MOVX    A,@DPTR
   \   000144   6403         XRL     A,#0x3
   \   000146   6003         JZ      $+5
   \   000148   02....       LJMP    ??ZDApp_ProcessOSALMsg_10 & 0xFFFF
   1076                    {
   1077                      devState = DEV_NWK_REJOIN;
   \   00014B   90....       MOV     DPTR,#devState
   \   00014E   7404         MOV     A,#0x4
   \   000150   F0           MOVX    @DPTR,A
   1078          
   1079                      // Before trying to do rejoin, check if the device has a valid short address
   1080                      // If not, generate a random short address for itself
   1081                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   \   000151   90....       MOV     DPTR,#_NIB + 20
   \   000154   E0           MOVX    A,@DPTR
   \   000155   64FE         XRL     A,#0xfe
   \   000157   7004         JNZ     ??ZDApp_ProcessOSALMsg_11
   \   000159   A3           INC     DPTR
   \   00015A   E0           MOVX    A,@DPTR
   \   00015B   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_11:
   \   00015D   7015         JNZ     ??ZDApp_ProcessOSALMsg_12
   1082                      {
   1083                        _NIB.nwkDevAddress = osal_rand();
   \   00015F                ; Setup parameters for call to function osal_rand
   \   00015F   12....       LCALL   ??osal_rand?relay
   \   000162   90....       MOV     DPTR,#_NIB + 20
   \   000165   EA           MOV     A,R2
   \   000166   F0           MOVX    @DPTR,A
   \   000167   A3           INC     DPTR
   \   000168   EB           MOV     A,R3
   \   000169   F0           MOVX    @DPTR,A
   1084                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   \   00016A                ; Setup parameters for call to function ZMacSetReq
   \   00016A   7A..         MOV     R2,#(_NIB + 20) & 0xff
   \   00016C   7B..         MOV     R3,#((_NIB + 20) >> 8) & 0xff
   \   00016E   7953         MOV     R1,#0x53
   \   000170   12....       LCALL   ??ZMacSetReq?relay
   \   000173   E9           MOV     A,R1
   1085                      }
   1086          
   1087                      if ( ZG_SECURE_ENABLED )
   1088                      {
   1089                        ZDApp_RestoreNwkKey();
   1090                      }
   1091          
   1092                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1093                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   \                     ??ZDApp_ProcessOSALMsg_12:
   \   000174   90....       MOV     DPTR,#_NIB + 33
   \   000177   E0           MOVX    A,@DPTR
   \   000178   64FE         XRL     A,#0xfe
   \   00017A   7004         JNZ     ??ZDApp_ProcessOSALMsg_13
   \   00017C   A3           INC     DPTR
   \   00017D   E0           MOVX    A,@DPTR
   \   00017E   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_13:
   \   000180   701D         JNZ     ??ZDApp_ProcessOSALMsg_14
   1094                      {
   1095                        _NIB.nwkPanId = pChosenNwk->panId;
   \   000182   85..82       MOV     DPL,?V0 + 0
   \   000185   85..83       MOV     DPH,?V0 + 1
   \   000188   E0           MOVX    A,@DPTR
   \   000189   F8           MOV     R0,A
   \   00018A   A3           INC     DPTR
   \   00018B   E0           MOVX    A,@DPTR
   \   00018C   F9           MOV     R1,A
   \   00018D   90....       MOV     DPTR,#_NIB + 33
   \   000190   E8           MOV     A,R0
   \   000191   F0           MOVX    @DPTR,A
   \   000192   A3           INC     DPTR
   \   000193   E9           MOV     A,R1
   \   000194   F0           MOVX    @DPTR,A
   1096                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   \   000195                ; Setup parameters for call to function ZMacSetReq
   \   000195   7A..         MOV     R2,#(_NIB + 33) & 0xff
   \   000197   7B..         MOV     R3,#((_NIB + 33) >> 8) & 0xff
   \   000199   7950         MOV     R1,#0x50
   \   00019B   12....       LCALL   ??ZMacSetReq?relay
   \   00019E   E9           MOV     A,R1
   1097                      }
   1098          
   1099                      tmp = true;
   \                     ??ZDApp_ProcessOSALMsg_14:
   \   00019F   85..82       MOV     DPL,?XSP + 0
   \   0001A2   85..83       MOV     DPH,?XSP + 1
   \   0001A5   7401         MOV     A,#0x1
   \   0001A7   F0           MOVX    @DPTR,A
   1100                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin
   \   0001A8                ; Setup parameters for call to function ZMacSetReq
   \   0001A8   85..82       MOV     DPL,?XSP + 0
   \   0001AB   85..83       MOV     DPH,?XSP + 1
   \   0001AE   AA82         MOV     R2,DPL
   \   0001B0   AB83         MOV     R3,DPH
   \   0001B2   7952         MOV     R1,#0x52
   \   0001B4   12....       LCALL   ??ZMacSetReq?relay
   \   0001B7   E9           MOV     A,R1
   1101                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, pChosenNwk->logicalChannel) != ZSuccess )
   \   0001B8                ; Setup parameters for call to function NLME_ReJoinRequest
   \   0001B8   85..82       MOV     DPL,?V0 + 0
   \   0001BB   85..83       MOV     DPH,?V0 + 1
   \   0001BE   A3           INC     DPTR
   \   0001BF   A3           INC     DPTR
   \   0001C0   E0           MOVX    A,@DPTR
   \   0001C1   F9           MOV     R1,A
   \   0001C2   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   0001C4   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   0001C6   12....       LCALL   ??NLME_ReJoinRequest?relay
   \   0001C9   E9           MOV     A,R1
   \   0001CA   601C         JZ      ??ZDApp_ProcessOSALMsg_10
   1102                      {
   1103                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1104                                                    + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0001CC                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001CC                ; Setup parameters for call to function osal_rand
   \   0001CC   12....       LCALL   ??osal_rand?relay
   \   0001CF   8A..         MOV     ?V0 + 6,R2
   \   0001D1   8B..         MOV     ?V0 + 7,R3
   \   0001D3   E5..         MOV     A,?V0 + 6
   \   0001D5   547F         ANL     A,#0x7f
   \   0001D7   F8           MOV     R0,A
   \   0001D8   E5..         MOV     A,?V0 + 7
   \   0001DA   5400         ANL     A,#0x0
   \   0001DC   F9           MOV     R1,A
   \   0001DD   E8           MOV     A,R0
   \   0001DE   2464         ADD     A,#0x64
   \   0001E0   FA           MOV     R2,A
   \   0001E1   E9           MOV     A,R1
   \   0001E2   3400         ADDC    A,#0x0
   \   0001E4   FB           MOV     R3,A
   \   0001E5   12....       LCALL   ??ZDApp_NetworkInit?relay
   1105                      }
   1106                    } // else if ( devStartMode == MODE_REJOIN )
   1107          
   1108                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??ZDApp_ProcessOSALMsg_10:
   \   0001E8   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   0001EB   E0           MOVX    A,@DPTR
   \   0001EC   A2E3         MOV     C,0xE0 /* A   */.3
   \   0001EE   5040         JNC     ??ZDApp_ProcessOSALMsg_15
   1109                    {
   1110                      // The receiver is on, turn network layer polling off.
   1111                      NLME_SetPollRate( 0 );
   \   0001F0                ; Setup parameters for call to function NLME_SetPollRate
   \   0001F0   7A00         MOV     R2,#0x0
   \   0001F2   7B00         MOV     R3,#0x0
   \   0001F4   12....       LCALL   ??NLME_SetPollRate?relay
   1112                      NLME_SetQueuedPollRate( 0 );
   \   0001F7                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   0001F7   7A00         MOV     R2,#0x0
   \   0001F9   7B00         MOV     R3,#0x0
   \   0001FB   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1113                      NLME_SetResponseRate( 0 );
   \   0001FE                ; Setup parameters for call to function NLME_SetResponseRate
   \   0001FE   7A00         MOV     R2,#0x0
   \   000200   7B00         MOV     R3,#0x0
   \   000202   12....       LCALL   ??NLME_SetResponseRate?relay
   \   000205   807A         SJMP    ??ZDApp_ProcessOSALMsg_6
   1114                    }
   1115                    else
   1116                    {
   1117                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   1118                      {
   1119                        ZDApp_SavedPollRate = zgPollRate;
   1120                        NLME_SetPollRate( zgRejoinPollRate );
   1121                      }
   1122                    }
   1123                  }
   1124                  else
   1125                  {
   1126                    if ( continueJoining )
   \                     ??ZDApp_ProcessOSALMsg_8:
   \   000207   90....       MOV     DPTR,#continueJoining
   \   00020A   E0           MOVX    A,@DPTR
   \   00020B   6074         JZ      ??ZDApp_ProcessOSALMsg_6
   1127                    {
   1128              #if defined ( MANAGED_SCAN )
   1129                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1130              #else
   1131                      zdoDiscCounter++;
   \   00020D   90....       MOV     DPTR,#zdoDiscCounter
   \   000210   E0           MOVX    A,@DPTR
   \   000211   2401         ADD     A,#0x1
   \   000213   F0           MOVX    @DPTR,A
   1132                      ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1133                            + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   \   000214                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000214                ; Setup parameters for call to function osal_rand
   \   000214   12....       LCALL   ??osal_rand?relay
   \   000217   8A..         MOV     ?V0 + 6,R2
   \   000219   8B..         MOV     ?V0 + 7,R3
   \   00021B   E5..         MOV     A,?V0 + 6
   \   00021D   54FF         ANL     A,#0xff
   \   00021F   F8           MOV     R0,A
   \   000220   E5..         MOV     A,?V0 + 7
   \   000222   5400         ANL     A,#0x0
   \   000224   F9           MOV     R1,A
   \   000225   E8           MOV     A,R0
   \   000226   2464         ADD     A,#0x64
   \   000228   FA           MOV     R2,A
   \   000229   E9           MOV     A,R1
   \   00022A   3400         ADDC    A,#0x0
   \   00022C   FB           MOV     R3,A
   \   00022D   12....       LCALL   ??ZDApp_NetworkInit?relay
   1134              #endif
   1135                    }
   1136                  }
   1137                }
   1138                break;
   \                     ??ZDApp_ProcessOSALMsg_15:
   \   000230   804F         SJMP    ??ZDApp_ProcessOSALMsg_6
   1139          
   1140              case ZDO_NWK_JOIN_IND:
   1141                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   000232   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000235   E0           MOVX    A,@DPTR
   \   000236   6401         XRL     A,#0x1
   \   000238   6008         JZ      ??ZDApp_ProcessOSALMsg_16
   \   00023A   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00023D   E0           MOVX    A,@DPTR
   \   00023E   6402         XRL     A,#0x2
   \   000240   703F         JNZ     ??ZDApp_ProcessOSALMsg_6
   1142                {
   1143                  ZDApp_ProcessNetworkJoin();
   \                     ??ZDApp_ProcessOSALMsg_16:
   \   000242                ; Setup parameters for call to function ZDApp_ProcessNetworkJoin
   \   000242   12....       LCALL   ??ZDApp_ProcessNetworkJoin?relay
   1144                }
   1145                break;
   \   000245   803A         SJMP    ??ZDApp_ProcessOSALMsg_6
   1146          
   1147              case ZDO_NWK_JOIN_REQ:
   1148                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   000247   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00024A   E0           MOVX    A,@DPTR
   \   00024B   6401         XRL     A,#0x1
   \   00024D   6008         JZ      ??ZDApp_ProcessOSALMsg_17
   \   00024F   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000252   E0           MOVX    A,@DPTR
   \   000253   6402         XRL     A,#0x2
   \   000255   702A         JNZ     ??ZDApp_ProcessOSALMsg_6
   1149                {
   1150                  retryCnt = 0;
   \                     ??ZDApp_ProcessOSALMsg_17:
   \   000257   90....       MOV     DPTR,#retryCnt
   \   00025A   7400         MOV     A,#0x0
   \   00025C   F0           MOVX    @DPTR,A
   1151                  devStartMode = MODE_RESUME;
   \   00025D   90....       MOV     DPTR,#devStartMode
   \   000260   7401         MOV     A,#0x1
   \   000262   F0           MOVX    @DPTR,A
   1152                  _tmpRejoinState = true;
   \   000263   90....       MOV     DPTR,#_tmpRejoinState
   \   000266   7401         MOV     A,#0x1
   \   000268   F0           MOVX    @DPTR,A
   1153                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   000269                ; Setup parameters for call to function sAddrExtCpy
   \   000269   7C..         MOV     R4,#(_NIB + 53) & 0xff
   \   00026B   7D..         MOV     R5,#((_NIB + 53) >> 8) & 0xff
   \   00026D   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00026F   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000271   12....       LCALL   ??sAddrExtCpy?relay
   1154                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   \   000274   90....       MOV     DPTR,#zgDefaultStartingScanDuration
   \   000277   7402         MOV     A,#0x2
   \   000279   F0           MOVX    @DPTR,A
   1155                  ZDApp_NetworkInit( 0 );
   \   00027A                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00027A   7A00         MOV     R2,#0x0
   \   00027C   7B00         MOV     R3,#0x0
   \   00027E   12....       LCALL   ??ZDApp_NetworkInit?relay
   1156                }
   1157                break;
   1158          
   1159              default:
   1160                if ( ZG_SECURE_ENABLED )
   1161                  ZDApp_ProcessSecMsg( msgPtr );
   1162                break;
   1163            }
   1164          
   1165          }
   \                     ??ZDApp_ProcessOSALMsg_6:
   \   000281   7401         MOV     A,#0x1
   \   000283   12....       LCALL   ?DEALLOC_XSTACK8
   \   000286   7F08         MOV     R7,#0x8
   \   000288   02....       LJMP    ?BANKED_LEAVE_XDATA
   1166          
   1167          /*********************************************************************
   1168           * @fn      ZDApp_ProcessMsgCBs()
   1169           *
   1170           * @brief   Process response messages
   1171           *
   1172           * @param   none
   1173           *
   1174           * @return  none
   1175           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1176          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1177          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1178            switch ( inMsg->clusterID )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   F582         MOV     DPL,A
   \   000013   EF           MOV     A,R7
   \   000014   3400         ADDC    A,#0x0
   \   000016   F583         MOV     DPH,A
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 0,A
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F5..         MOV     ?V0 + 1,A
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000024   0200         DW        2
   \   000026   2100         DW        33
   \   000028   2200         DW        34
   \   00002A   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   00002C   0080         DW        32768
   \   00002E   0180         DW        32769
   \   000030   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000032   0000         DW        0
   \   000034   ....         DW        ??ZDApp_ProcessMsgCBs_2
   1179            {
   1180          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1181              case NWK_addr_rsp:
   1182              case IEEE_addr_rsp:
   1183                {
   1184                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1185                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   000036                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   000036   EE           MOV     A,R6
   \   000037   FA           MOV     R2,A
   \   000038   EF           MOV     A,R7
   \   000039   FB           MOV     R3,A
   \   00003A   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   00003D   8A..         MOV     ?V0 + 2,R2
   \   00003F   8B..         MOV     ?V0 + 3,R3
   \   000041   85....       MOV     ?V0 + 0,?V0 + 2
   \   000044   85....       MOV     ?V0 + 1,?V0 + 3
   1186                  if ( pAddrRsp )
   \   000047   E5..         MOV     A,?V0 + 0
   \   000049   45..         ORL     A,?V0 + 1
   \   00004B   604D         JZ      ??ZDApp_ProcessMsgCBs_2
   1187                  {
   1188                    if ( pAddrRsp->status == ZSuccess )
   \   00004D   85..82       MOV     DPL,?V0 + 0
   \   000050   85..83       MOV     DPH,?V0 + 1
   \   000053   E0           MOVX    A,@DPTR
   \   000054   7019         JNZ     ??ZDApp_ProcessMsgCBs_3
   1189                    {
   1190                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000056                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000056   E5..         MOV     A,?V0 + 0
   \   000058   2403         ADD     A,#0x3
   \   00005A   FC           MOV     R4,A
   \   00005B   E5..         MOV     A,?V0 + 1
   \   00005D   3400         ADDC    A,#0x0
   \   00005F   FD           MOV     R5,A
   \   000060   85..82       MOV     DPL,?V0 + 0
   \   000063   85..83       MOV     DPH,?V0 + 1
   \   000066   A3           INC     DPTR
   \   000067   E0           MOVX    A,@DPTR
   \   000068   FA           MOV     R2,A
   \   000069   A3           INC     DPTR
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   FB           MOV     R3,A
   \   00006C   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1191                    }
   1192                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   00006F                ; Setup parameters for call to function osal_mem_free
   \   00006F   AA..         MOV     R2,?V0 + 0
   \   000071   AB..         MOV     R3,?V0 + 1
   \   000073   12....       LCALL   ??osal_mem_free?relay
   1193                  }
   1194                }
   1195                break;
   \   000076   8022         SJMP    ??ZDApp_ProcessMsgCBs_2
   1196          #endif
   1197          
   1198          #if defined ( REFLECTOR )
   1199              case Bind_req:
   1200              case Unbind_req:
   1201                {
   1202                  ZDO_BindUnbindReq_t bindReq;
   1203                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   000078                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   000078   85..82       MOV     DPL,?XSP + 0
   \   00007B   85..83       MOV     DPH,?XSP + 1
   \   00007E   AC82         MOV     R4,DPL
   \   000080   AD83         MOV     R5,DPH
   \   000082   EE           MOV     A,R6
   \   000083   FA           MOV     R2,A
   \   000084   EF           MOV     A,R7
   \   000085   FB           MOV     R3,A
   \   000086   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1204                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000089                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000089   85..82       MOV     DPL,?XSP + 0
   \   00008C   85..83       MOV     DPH,?XSP + 1
   \   00008F   AC82         MOV     R4,DPL
   \   000091   AD83         MOV     R5,DPH
   \   000093   EE           MOV     A,R6
   \   000094   FA           MOV     R2,A
   \   000095   EF           MOV     A,R7
   \   000096   FB           MOV     R3,A
   \   000097   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1205                }
   1206                break;
   1207          #endif
   1208          
   1209          #if ( ZG_BUILD_COORDINATOR_TYPE )
   1210              case Bind_rsp:
   1211              case Unbind_rsp:
   1212                if (ZG_DEVICE_COORDINATOR_TYPE && matchED)
   1213                {
   1214                  ZDMatchSendState(
   1215                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1216                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   1217                }
   1218                break;
   1219          
   1220              case End_Device_Bind_req:
   1221                if (ZG_DEVICE_COORDINATOR_TYPE)
   1222                {
   1223                  ZDEndDeviceBind_t bindReq;
   1224                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   1225                  ZDO_MatchEndDeviceBind( &bindReq );
   1226          
   1227                  // Freeing the cluster lists - if allocated.
   1228                  if ( bindReq.numInClusters )
   1229                    osal_mem_free( bindReq.inClusters );
   1230                  if ( bindReq.numOutClusters )
   1231                    osal_mem_free( bindReq.outClusters );
   1232                }
   1233                break;
   1234          #endif
   1235            }
   1236          }
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   00009A   7415         MOV     A,#0x15
   \   00009C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009F   7F04         MOV     R7,#0x4
   \   0000A1   02....       LJMP    ?BANKED_LEAVE_XDATA
   1237          
   1238          /*********************************************************************
   1239           * @fn      ZDApp_RegisterCBs()
   1240           *
   1241           * @brief   Process response messages
   1242           *
   1243           * @param   none
   1244           *
   1245           * @return  none
   1246           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1247          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1248          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1249          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1250            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   7B80         MOV     R3,#-0x80
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000010   E9           MOV     A,R1
   1251          #endif
   1252          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1253            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \   000011                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000011   7A00         MOV     R2,#0x0
   \   000013   7B80         MOV     R3,#-0x80
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   00001D   E9           MOV     A,R1
   1254          #endif
   1255          #if ZG_BUILD_COORDINATOR_TYPE
   1256            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   1257            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   1258            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   1259          #endif
   1260          #if defined ( REFLECTOR )
   1261            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \   00001E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00001E   7A21         MOV     R2,#0x21
   \   000020   7B00         MOV     R3,#0x0
   \   000022   90....       MOV     DPTR,#ZDAppTaskID
   \   000025   E0           MOVX    A,@DPTR
   \   000026   F9           MOV     R1,A
   \   000027   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   00002A   E9           MOV     A,R1
   1262            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \   00002B                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00002B   7A22         MOV     R2,#0x22
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   90....       MOV     DPTR,#ZDAppTaskID
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F9           MOV     R1,A
   \   000034   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000037   E9           MOV     A,R1
   1263          #endif
   1264          }
   \   000038   D083         POP     DPH
   \   00003A   D082         POP     DPL
   \   00003C   02....       LJMP    ?BRET
   1265          
   1266          /*********************************************************************
   1267           * @fn      ZDApp_ProcessSecMsg()
   1268           *
   1269           * @brief   Process the incoming security message.
   1270           *
   1271           * @param   msgPtr - message to process
   1272           *
   1273           * @return  none
   1274           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1275          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1276          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   1277            switch ( msgPtr->event )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   24FC         ADD     A,#-0x4
   \   000010   604A         JZ      ??ZDApp_ProcessSecMsg_0
   \   000012   14           DEC     A
   \   000013   6047         JZ      ??ZDApp_ProcessSecMsg_0
   \   000015   14           DEC     A
   \   000016   6014         JZ      ??ZDApp_ProcessSecMsg_1
   \   000018   14           DEC     A
   \   000019   6041         JZ      ??ZDApp_ProcessSecMsg_0
   \   00001B   14           DEC     A
   \   00001C   603E         JZ      ??ZDApp_ProcessSecMsg_0
   \   00001E   14           DEC     A
   \   00001F   603B         JZ      ??ZDApp_ProcessSecMsg_0
   \   000021   14           DEC     A
   \   000022   6021         JZ      ??ZDApp_ProcessSecMsg_2
   \   000024   14           DEC     A
   \   000025   6035         JZ      ??ZDApp_ProcessSecMsg_0
   \   000027   14           DEC     A
   \   000028   6032         JZ      ??ZDApp_ProcessSecMsg_0
   \   00002A   8030         SJMP    ??ZDApp_ProcessSecMsg_0
   1278            {
   1279              case ZDO_ESTABLISH_KEY_CFM:
   1280                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1281                {
   1282                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1283                }
   1284                break;
   1285          
   1286              case ZDO_ESTABLISH_KEY_IND:
   1287                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1288                {
   1289                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1290                  {
   1291                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1292                  }
   1293                }
   1294                break;
   1295          
   1296              case ZDO_TRANSPORT_KEY_IND:
   1297                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_1:
   \   00002C   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   6401         XRL     A,#0x1
   \   000032   6008         JZ      ??ZDApp_ProcessSecMsg_3
   \   000034   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000037   E0           MOVX    A,@DPTR
   \   000038   6402         XRL     A,#0x2
   \   00003A   7020         JNZ     ??ZDApp_ProcessSecMsg_0
   1298                {
   1299                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_3:
   \   00003C                ; Setup parameters for call to function ZDSecMgrTransportKeyInd
   \   00003C   EE           MOV     A,R6
   \   00003D   FA           MOV     R2,A
   \   00003E   EF           MOV     A,R7
   \   00003F   FB           MOV     R3,A
   \   000040   12....       LCALL   ??ZDSecMgrTransportKeyInd?relay
   1300                }
   1301                break;
   \   000043   8017         SJMP    ??ZDApp_ProcessSecMsg_0
   1302          
   1303              case ZDO_UPDATE_DEVICE_IND:
   1304                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1305                {
   1306                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   1307                }
   1308                break;
   1309          
   1310              case ZDO_REMOVE_DEVICE_IND:
   1311                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   1312                {
   1313                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   1314                }
   1315                break;
   1316          
   1317              case ZDO_REQUEST_KEY_IND:
   1318                if (( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH ) ||
   1319                    ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD ))
   1320                {
   1321                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1322                  {
   1323                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1324                  }
   1325                }
   1326                break;
   1327          
   1328              case ZDO_SWITCH_KEY_IND:
   1329                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_2:
   \   000045   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000048   E0           MOVX    A,@DPTR
   \   000049   6401         XRL     A,#0x1
   \   00004B   6008         JZ      ??ZDApp_ProcessSecMsg_4
   \   00004D   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000050   E0           MOVX    A,@DPTR
   \   000051   6402         XRL     A,#0x2
   \   000053   7007         JNZ     ??ZDApp_ProcessSecMsg_0
   1330                {
   1331                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_4:
   \   000055                ; Setup parameters for call to function ZDSecMgrSwitchKeyInd
   \   000055   EE           MOV     A,R6
   \   000056   FA           MOV     R2,A
   \   000057   EF           MOV     A,R7
   \   000058   FB           MOV     R3,A
   \   000059   12....       LCALL   ??ZDSecMgrSwitchKeyInd?relay
   1332                }
   1333                break;
   1334          
   1335              case ZDO_AUTHENTICATE_IND:
   1336                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1337                {
   1338                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1339                }
   1340                break;
   1341          
   1342              case ZDO_AUTHENTICATE_CFM:
   1343                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1344                {
   1345                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1346                }
   1347                break;
   1348          
   1349              default:
   1350                // Unsupported messages
   1351                break;
   1352            }
   1353          }
   \                     ??ZDApp_ProcessSecMsg_0:
   \   00005C   7F01         MOV     R7,#0x1
   \   00005E   02....       LJMP    ?BANKED_LEAVE_XDATA
   1354          
   1355          /*********************************************************************
   1356           * @fn      ZDApp_ProcessNetworkJoin()
   1357           *
   1358           * @brief
   1359           *
   1360           *   Save off the Network key information.
   1361           *
   1362           * @param   none
   1363           *
   1364           * @return  none
   1365           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1366          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1367          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1368            if ( (devState == DEV_NWK_JOINING) ||
   1369                ((devState == DEV_NWK_ORPHAN)  &&
   1370                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6018         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   90....       MOV     DPTR,#devState
   \   000015   E0           MOVX    A,@DPTR
   \   000016   640A         XRL     A,#0xa
   \   000018   6003         JZ      $+5
   \   00001A   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000020   E0           MOVX    A,@DPTR
   \   000021   5407         ANL     A,#0x7
   \   000023   6401         XRL     A,#0x1
   \   000025   6003         JZ      $+5
   \   000027   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   1371            {
   1372              // Result of a Join attempt by this device.
   1373              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   00002A   90....       MOV     DPTR,#nwkStatus
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   7021         JNZ     ??ZDApp_ProcessNetworkJoin_2
   1374              {
   1375                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000030                ; Setup parameters for call to function osal_set_event
   \   000030   7A10         MOV     R2,#0x10
   \   000032   7B00         MOV     R3,#0x0
   \   000034   90....       MOV     DPTR,#ZDAppTaskID
   \   000037   E0           MOVX    A,@DPTR
   \   000038   F9           MOV     R1,A
   \   000039   12....       LCALL   ??osal_set_event?relay
   \   00003C   E9           MOV     A,R1
   1376          
   1377          #if defined ( POWER_SAVING )
   1378                osal_pwrmgr_device( PWRMGR_BATTERY );
   1379          #endif
   1380          
   1381                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   1382                {
   1383                  // wait for auth from trust center!!
   1384                  devState = DEV_END_DEVICE_UNAUTH;
   1385          
   1386                  // Start the reset timer for MAX UNAUTH time
   1387                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   1388                }
   1389                else
   1390                {
   1391                  if ( ZSTACK_ROUTER_BUILD )
   1392                  {
   1393                    if ( devState == DEV_NWK_ORPHAN
   1394                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1395                    {
   1396                      // Change NIB state to router for restore
   1397                      _NIB.nwkState = NWK_ROUTER;
   1398                    }
   1399                  }
   1400          
   1401                  if ( devState == DEV_NWK_JOINING )
   \   00003D   90....       MOV     DPTR,#devState
   \   000040   E0           MOVX    A,@DPTR
   \   000041   6403         XRL     A,#0x3
   \   000043   7003         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1402                  {
   1403                    ZDApp_AnnounceNewAddress();
   \   000045                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000045   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1404                  }
   1405          
   1406                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000048   90....       MOV     DPTR,#devState
   \   00004B   7406         MOV     A,#0x6
   \   00004D   F0           MOVX    @DPTR,A
   1407                  if ( ZSTACK_ROUTER_BUILD )
   \   00004E   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1408                  {
   1409                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1410                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1411                    {
   1412                      NLME_StartRouterRequest( 0, 0, false );
   1413                    }
   1414                  }
   1415                }
   1416              }
   1417              else
   1418              {
   1419                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   000051   90....       MOV     DPTR,#devStartMode
   \   000054   E0           MOVX    A,@DPTR
   \   000055   6401         XRL     A,#0x1
   \   000057   703F         JNZ     ??ZDApp_ProcessNetworkJoin_5
   \   000059   90....       MOV     DPTR,#retryCnt
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   2401         ADD     A,#0x1
   \   00005F   90....       MOV     DPTR,#retryCnt
   \   000062   F0           MOVX    @DPTR,A
   \   000063   C3           CLR     C
   \   000064   9403         SUBB    A,#0x3
   \   000066   4030         JC      ??ZDApp_ProcessNetworkJoin_5
   1420                {
   1421                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000068   90....       MOV     DPTR,#_NIB + 33
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   64FF         XRL     A,#0xff
   \   00006E   7004         JNZ     ??ZDApp_ProcessNetworkJoin_6
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   000074   600E         JZ      ??ZDApp_ProcessNetworkJoin_7
   \   000076   90....       MOV     DPTR,#_NIB + 33
   \   000079   E0           MOVX    A,@DPTR
   \   00007A   64FE         XRL     A,#0xfe
   \   00007C   7004         JNZ     ??ZDApp_ProcessNetworkJoin_8
   \   00007E   A3           INC     DPTR
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   000082   7008         JNZ     ??ZDApp_ProcessNetworkJoin_9
   1422                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   000084   90....       MOV     DPTR,#devStartMode
   \   000087   7400         MOV     A,#0x0
   \   000089   F0           MOVX    @DPTR,A
   \   00008A   800C         SJMP    ??ZDApp_ProcessNetworkJoin_5
   1423                  else
   1424                  {
   1425                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   00008C   90....       MOV     DPTR,#devStartMode
   \   00008F   7403         MOV     A,#0x3
   \   000091   F0           MOVX    @DPTR,A
   1426                    _tmpRejoinState = true;
   \   000092   90....       MOV     DPTR,#_tmpRejoinState
   \   000095   7401         MOV     A,#0x1
   \   000097   F0           MOVX    @DPTR,A
   1427                  }
   1428                }
   1429          
   1430                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1431                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   000098                ; Setup parameters for call to function NLME_GetShortAddr
   \   000098   12....       LCALL   ??NLME_GetShortAddr?relay
   \   00009B   8A..         MOV     ?V0 + 0,R2
   \   00009D   8B..         MOV     ?V0 + 1,R3
   \   00009F   74FE         MOV     A,#-0x2
   \   0000A1   65..         XRL     A,?V0 + 0
   \   0000A3   7004         JNZ     ??ZDApp_ProcessNetworkJoin_10
   \   0000A5   74FF         MOV     A,#-0x1
   \   0000A7   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   0000A9   700E         JNZ     ??ZDApp_ProcessNetworkJoin_11
   \   0000AB   90....       MOV     DPTR,#_NIB + 20
   \   0000AE   E0           MOVX    A,@DPTR
   \   0000AF   64FE         XRL     A,#0xfe
   \   0000B1   7004         JNZ     ??ZDApp_ProcessNetworkJoin_12
   \   0000B3   A3           INC     DPTR
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   0000B7   6027         JZ      ??ZDApp_ProcessNetworkJoin_13
   1432                {
   1433                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   0000B9   85..82       MOV     DPL,?XSP + 0
   \   0000BC   85..83       MOV     DPH,?XSP + 1
   \   0000BF   74FE         MOV     A,#-0x2
   \   0000C1   F0           MOVX    @DPTR,A
   \   0000C2   A3           INC     DPTR
   \   0000C3   74FF         MOV     A,#-0x1
   \   0000C5   F0           MOVX    @DPTR,A
   1434                  // Invalidate nwk addr so end device does not use in its data reqs.
   1435                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000C6   90....       MOV     DPTR,#_NIB + 20
   \   0000C9   74FE         MOV     A,#-0x2
   \   0000CB   F0           MOVX    @DPTR,A
   \   0000CC   A3           INC     DPTR
   \   0000CD   74FF         MOV     A,#-0x1
   \   0000CF   F0           MOVX    @DPTR,A
   1436                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   0000D0                ; Setup parameters for call to function ZMacSetReq
   \   0000D0   85..82       MOV     DPL,?XSP + 0
   \   0000D3   85..83       MOV     DPH,?XSP + 1
   \   0000D6   AA82         MOV     R2,DPL
   \   0000D8   AB83         MOV     R3,DPH
   \   0000DA   7953         MOV     R1,#0x53
   \   0000DC   12....       LCALL   ??ZMacSetReq?relay
   \   0000DF   E9           MOV     A,R1
   1437                }
   1438          
   1439                // Clear the neighbor Table and network discovery tables.
   1440                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000E0                ; Setup parameters for call to function nwkNeighborInitTable
   \   0000E0   12....       LCALL   ??nwkNeighborInitTable?relay
   1441                NLME_NwkDiscTerm();
   \   0000E3                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0000E3   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1442          
   1443                zdoDiscCounter = 1;
   \   0000E6   90....       MOV     DPTR,#zdoDiscCounter
   \   0000E9   7401         MOV     A,#0x1
   \   0000EB   F0           MOVX    @DPTR,A
   1444          
   1445          //      ZDApp_NetworkInit( (uint16)
   1446          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1447          //                          (NWK_START_DELAY * 5)) );
   1448                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1449                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000EC                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000EC                ; Setup parameters for call to function osal_rand
   \   0000EC   12....       LCALL   ??osal_rand?relay
   \   0000EF   8A..         MOV     ?V0 + 0,R2
   \   0000F1   8B..         MOV     ?V0 + 1,R3
   \   0000F3   E5..         MOV     A,?V0 + 0
   \   0000F5   547F         ANL     A,#0x7f
   \   0000F7   F8           MOV     R0,A
   \   0000F8   E5..         MOV     A,?V0 + 1
   \   0000FA   5400         ANL     A,#0x0
   \   0000FC   F9           MOV     R1,A
   \   0000FD   E8           MOV     A,R0
   \   0000FE   2464         ADD     A,#0x64
   \   000100   FA           MOV     R2,A
   \   000101   E9           MOV     A,R1
   \   000102   3400         ADDC    A,#0x0
   \   000104   FB           MOV     R3,A
   \   000105   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   000108   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1450              }
   1451            }
   1452            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   00010B   90....       MOV     DPTR,#devState
   \   00010E   E0           MOVX    A,@DPTR
   \   00010F   640A         XRL     A,#0xa
   \   000111   600B         JZ      ??ZDApp_ProcessNetworkJoin_14
   \   000113   90....       MOV     DPTR,#devState
   \   000116   E0           MOVX    A,@DPTR
   \   000117   6404         XRL     A,#0x4
   \   000119   6003         JZ      $+5
   \   00011B   02....       LJMP    ??ZDApp_ProcessNetworkJoin_15 & 0xFFFF
   1453            {
   1454              // results of an orphaning attempt by this device
   1455              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   00011E   90....       MOV     DPTR,#nwkStatus
   \   000121   E0           MOVX    A,@DPTR
   \   000122   7036         JNZ     ??ZDApp_ProcessNetworkJoin_16
   1456              {
   1457                if ( ZG_SECURE_ENABLED )
   1458                {
   1459                  ZDApp_RestoreNwkKey();
   1460                }
   1461          
   1462                devState = DEV_END_DEVICE;
   \   000124   90....       MOV     DPTR,#devState
   \   000127   7406         MOV     A,#0x6
   \   000129   F0           MOVX    @DPTR,A
   1463                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00012A                ; Setup parameters for call to function osal_set_event
   \   00012A   7A10         MOV     R2,#0x10
   \   00012C   7B00         MOV     R3,#0x0
   \   00012E   90....       MOV     DPTR,#ZDAppTaskID
   \   000131   E0           MOVX    A,@DPTR
   \   000132   F9           MOV     R1,A
   \   000133   12....       LCALL   ??osal_set_event?relay
   \   000136   E9           MOV     A,R1
   1464                // setup Power Manager Device
   1465          #if defined ( POWER_SAVING )
   1466                osal_pwrmgr_device( PWRMGR_BATTERY );
   1467          #endif
   1468          
   1469                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \   000137   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00013A   E0           MOVX    A,@DPTR
   \   00013B   A2E3         MOV     C,0xE0 /* A   */.3
   \   00013D   5015         JNC     ??ZDApp_ProcessNetworkJoin_17
   1470                {
   1471                  // The receiver is on, turn network layer polling off.
   1472                  NLME_SetPollRate( 0 );
   \   00013F                ; Setup parameters for call to function NLME_SetPollRate
   \   00013F   7A00         MOV     R2,#0x0
   \   000141   7B00         MOV     R3,#0x0
   \   000143   12....       LCALL   ??NLME_SetPollRate?relay
   1473                  NLME_SetQueuedPollRate( 0 );
   \   000146                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000146   7A00         MOV     R2,#0x0
   \   000148   7B00         MOV     R3,#0x0
   \   00014A   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1474                  NLME_SetResponseRate( 0 );
   \   00014D                ; Setup parameters for call to function NLME_SetResponseRate
   \   00014D   7A00         MOV     R2,#0x0
   \   00014F   7B00         MOV     R3,#0x0
   \   000151   12....       LCALL   ??NLME_SetResponseRate?relay
   1475                }
   1476          
   1477                if ( ZSTACK_ROUTER_BUILD )
   1478                {
   1479                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1480                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1481                  {
   1482                    NLME_StartRouterRequest( 0, 0, false );
   1483                  }
   1484                }
   1485          
   1486                ZDApp_AnnounceNewAddress();
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   000154                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000154   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   000157   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1487              }
   1488              else
   1489              {
   1490                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   00015A   90....       MOV     DPTR,#devStartMode
   \   00015D   E0           MOVX    A,@DPTR
   \   00015E   6401         XRL     A,#0x1
   \   000160   704F         JNZ     ??ZDApp_ProcessNetworkJoin_18
   1491                {
   1492                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   000162   90....       MOV     DPTR,#retryCnt
   \   000165   E0           MOVX    A,@DPTR
   \   000166   2401         ADD     A,#0x1
   \   000168   90....       MOV     DPTR,#retryCnt
   \   00016B   F0           MOVX    @DPTR,A
   \   00016C   C3           CLR     C
   \   00016D   9404         SUBB    A,#0x4
   \   00016F   5032         JNC     ??ZDApp_ProcessNetworkJoin_19
   1493                  {
   1494                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000171   90....       MOV     DPTR,#_NIB + 33
   \   000174   E0           MOVX    A,@DPTR
   \   000175   64FF         XRL     A,#0xff
   \   000177   7004         JNZ     ??ZDApp_ProcessNetworkJoin_20
   \   000179   A3           INC     DPTR
   \   00017A   E0           MOVX    A,@DPTR
   \   00017B   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   00017D   600E         JZ      ??ZDApp_ProcessNetworkJoin_21
   \   00017F   90....       MOV     DPTR,#_NIB + 33
   \   000182   E0           MOVX    A,@DPTR
   \   000183   64FE         XRL     A,#0xfe
   \   000185   7004         JNZ     ??ZDApp_ProcessNetworkJoin_22
   \   000187   A3           INC     DPTR
   \   000188   E0           MOVX    A,@DPTR
   \   000189   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   00018B   7008         JNZ     ??ZDApp_ProcessNetworkJoin_23
   1495                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   00018D   90....       MOV     DPTR,#devStartMode
   \   000190   7400         MOV     A,#0x0
   \   000192   F0           MOVX    @DPTR,A
   \   000193   801C         SJMP    ??ZDApp_ProcessNetworkJoin_18
   1496                    else
   1497                    {
   1498                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   000195   90....       MOV     DPTR,#devStartMode
   \   000198   7403         MOV     A,#0x3
   \   00019A   F0           MOVX    @DPTR,A
   1499                      _tmpRejoinState = true;
   \   00019B   90....       MOV     DPTR,#_tmpRejoinState
   \   00019E   7401         MOV     A,#0x1
   \   0001A0   F0           MOVX    @DPTR,A
   \   0001A1   800E         SJMP    ??ZDApp_ProcessNetworkJoin_18
   1500                    }
   1501                  }
   1502                  // Do a normal join to the network after certain times of rejoin retries
   1503                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   0001A3   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   0001A6   E0           MOVX    A,@DPTR
   \   0001A7   6401         XRL     A,#0x1
   \   0001A9   7006         JNZ     ??ZDApp_ProcessNetworkJoin_18
   1504                  {
   1505                    devStartMode = MODE_JOIN;
   \   0001AB   90....       MOV     DPTR,#devStartMode
   \   0001AE   7400         MOV     A,#0x0
   \   0001B0   F0           MOVX    @DPTR,A
   1506                  }
   1507                }
   1508          
   1509                // Clear the neighbor Table and network discovery tables.
   1510                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   0001B1                ; Setup parameters for call to function nwkNeighborInitTable
   \   0001B1   12....       LCALL   ??nwkNeighborInitTable?relay
   1511                NLME_NwkDiscTerm();
   \   0001B4                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0001B4   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1512          
   1513                // setup a retry for later...
   1514                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1515                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \   0001B7                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001B7                ; Setup parameters for call to function osal_rand
   \   0001B7   12....       LCALL   ??osal_rand?relay
   \   0001BA   8A..         MOV     ?V0 + 0,R2
   \   0001BC   8B..         MOV     ?V0 + 1,R3
   \   0001BE   E5..         MOV     A,?V0 + 0
   \   0001C0   547F         ANL     A,#0x7f
   \   0001C2   F8           MOV     R0,A
   \   0001C3   E5..         MOV     A,?V0 + 1
   \   0001C5   5400         ANL     A,#0x0
   \   0001C7   F9           MOV     R1,A
   \   0001C8   E8           MOV     A,R0
   \   0001C9   2464         ADD     A,#0x64
   \   0001CB   FA           MOV     R2,A
   \   0001CC   E9           MOV     A,R1
   \   0001CD   3400         ADDC    A,#0x0
   \   0001CF   FB           MOV     R3,A
   \   0001D0   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   0001D3   8018         SJMP    ??ZDApp_ProcessNetworkJoin_4
   1516              }
   1517            }
   1518          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1519            else
   1520            {
   1521              // Assume from address conflict
   1522              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   0001D5   90....       MOV     DPTR,#_NIB + 96
   \   0001D8   E0           MOVX    A,@DPTR
   \   0001D9   6402         XRL     A,#0x2
   \   0001DB   7010         JNZ     ??ZDApp_ProcessNetworkJoin_4
   1523              {
   1524                // Notify the network
   1525                ZDApp_AnnounceNewAddress();
   \   0001DD                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   0001DD   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1526          
   1527                // Notify apps
   1528                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   0001E0                ; Setup parameters for call to function osal_set_event
   \   0001E0   7A10         MOV     R2,#0x10
   \   0001E2   7B00         MOV     R3,#0x0
   \   0001E4   90....       MOV     DPTR,#ZDAppTaskID
   \   0001E7   E0           MOVX    A,@DPTR
   \   0001E8   F9           MOV     R1,A
   \   0001E9   12....       LCALL   ??osal_set_event?relay
   \   0001EC   E9           MOV     A,R1
   1529              }
   1530            }
   1531          #endif
   1532          }
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   0001ED   7402         MOV     A,#0x2
   \   0001EF   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001F2   7F02         MOV     R7,#0x2
   \   0001F4   02....       LJMP    ?BANKED_LEAVE_XDATA
   1533          
   1534          /*********************************************************************
   1535           * @fn      ZDApp_SaveNwkKey()
   1536           *
   1537           * @brief   Save off the Network key information.
   1538           *
   1539           * @param   none
   1540           *
   1541           * @return  none
   1542           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1543          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1544          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1545            nwkActiveKeyItems keyItems;
   1546          
   1547            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1548            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1549          
   1550            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1551                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   7C00         MOV     R4,#0x0
   \   000047   7D00         MOV     R5,#0x0
   \   000049   7A82         MOV     R2,#-0x7e
   \   00004B   7B00         MOV     R3,#0x0
   \   00004D   12....       LCALL   ??osal_nv_write?relay
   \   000050   7404         MOV     A,#0x4
   \   000052   12....       LCALL   ?DEALLOC_XSTACK8
   \   000055   E9           MOV     A,R1
   1552          
   1553            nwkFrameCounterChanges = 0;
   \   000056   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000059   7400         MOV     A,#0x0
   \   00005B   F0           MOVX    @DPTR,A
   \   00005C   A3           INC     DPTR
   \   00005D   7400         MOV     A,#0x0
   \   00005F   F0           MOVX    @DPTR,A
   1554          
   1555            // Clear copy in RAM before return.
   1556            osal_memset( &keyItems, 0x00, sizeof(keyItems) );
   \   000060                ; Setup parameters for call to function osal_memset
   \   000060   7C15         MOV     R4,#0x15
   \   000062   7D00         MOV     R5,#0x0
   \   000064   7900         MOV     R1,#0x0
   \   000066   85..82       MOV     DPL,?XSP + 0
   \   000069   85..83       MOV     DPH,?XSP + 1
   \   00006C   AA82         MOV     R2,DPL
   \   00006E   AB83         MOV     R3,DPH
   \   000070   12....       LCALL   ??osal_memset?relay
   1557          
   1558          }
   \   000073   7415         MOV     A,#0x15
   \   000075   12....       LCALL   ?DEALLOC_XSTACK8
   \   000078   7F04         MOV     R7,#0x4
   \   00007A   02....       LJMP    ?BANKED_LEAVE_XDATA
   1559          
   1560          /*********************************************************************
   1561           * @fn      ZDApp_ResetNwkKey()
   1562           *
   1563           * @brief   Reset the Network key information in NV.
   1564           *
   1565           * @param   none
   1566           *
   1567           * @return  none
   1568           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1569          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1570          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1571            nwkActiveKeyItems keyItems;
   1572          
   1573            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
   1574            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1575                          (void *)&keyItems );
   \   00001D                ; Setup parameters for call to function osal_nv_write
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   75..15       MOV     ?V0 + 0,#0x15
   \   000031   75..00       MOV     ?V0 + 1,#0x0
   \   000034   78..         MOV     R0,#?V0 + 0
   \   000036   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000039   7C00         MOV     R4,#0x0
   \   00003B   7D00         MOV     R5,#0x0
   \   00003D   7A82         MOV     R2,#-0x7e
   \   00003F   7B00         MOV     R3,#0x0
   \   000041   12....       LCALL   ??osal_nv_write?relay
   \   000044   7404         MOV     A,#0x4
   \   000046   12....       LCALL   ?DEALLOC_XSTACK8
   \   000049   E9           MOV     A,R1
   1576          }
   \   00004A   7415         MOV     A,#0x15
   \   00004C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00004F   7F02         MOV     R7,#0x2
   \   000051   02....       LJMP    ?BANKED_LEAVE_XDATA
   1577          
   1578          /*********************************************************************
   1579           * @fn      ZDApp_RestoreNwkKey()
   1580           *
   1581           * @brief
   1582           *
   1583           *   Save off the Network key information.
   1584           *
   1585           * @param   none
   1586           *
   1587           * @return  true if restored from NV, false if not
   1588           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1589          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1590          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1591            nwkActiveKeyItems keyItems;
   1592            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1593          
   1594            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1595                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   75..00       MOV     ?V0 + 1,#0x0
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000028   7C00         MOV     R4,#0x0
   \   00002A   7D00         MOV     R5,#0x0
   \   00002C   7A82         MOV     R2,#-0x7e
   \   00002E   7B00         MOV     R3,#0x0
   \   000030   12....       LCALL   ??osal_nv_read?relay
   \   000033   7404         MOV     A,#0x4
   \   000035   12....       LCALL   ?DEALLOC_XSTACK8
   \   000038   E9           MOV     A,R1
   \   000039   7040         JNZ     ??ZDApp_RestoreNwkKey_0
   1596            {
   1597              if ( keyItems.frameCounter > 0 )
   \   00003B   7411         MOV     A,#0x11
   \   00003D   12....       LCALL   ?XSTACK_DISP0_8
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?L_MOV_X
   \   000045   E5..         MOV     A,?V0 + 0
   \   000047   45..         ORL     A,?V0 + 1
   \   000049   45..         ORL     A,?V0 + 2
   \   00004B   45..         ORL     A,?V0 + 3
   \   00004D   6022         JZ      ??ZDApp_RestoreNwkKey_1
   1598              {
   1599                // Restore the key information
   1600                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   \   00004F   90....       MOV     DPTR,#__Constant_3e8
   \   000052   78..         MOV     R0,#?V0 + 0
   \   000054   12....       LCALL   ?L_MOV_X
   \   000057   7411         MOV     A,#0x11
   \   000059   12....       LCALL   ?XSTACK_DISP0_8
   \   00005C   78..         MOV     R0,#?V0 + 0
   \   00005E   12....       LCALL   ?L_ADD_TO_X
   1601                nwkFrameCounter = keyItems.frameCounter;
   \   000061   7411         MOV     A,#0x11
   \   000063   12....       LCALL   ?XSTACK_DISP0_8
   \   000066   12....       LCALL   ?XLOAD_R2345
   \   000069   90....       MOV     DPTR,#nwkFrameCounter
   \   00006C   12....       LCALL   ?XSTORE_R2345
   1602                ret = true;
   \   00006F   7E01         MOV     R6,#0x1
   1603              }
   1604          
   1605              // Force a save for the first frame counter increment
   1606              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   000071   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000074   74E9         MOV     A,#-0x17
   \   000076   F0           MOVX    @DPTR,A
   \   000077   A3           INC     DPTR
   \   000078   7403         MOV     A,#0x3
   \   00007A   F0           MOVX    @DPTR,A
   1607            }
   1608            // Clear copy in RAM before return.
   1609            osal_memset( &keyItems, 0x00, sizeof(keyItems) );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   00007B                ; Setup parameters for call to function osal_memset
   \   00007B   7C15         MOV     R4,#0x15
   \   00007D   7D00         MOV     R5,#0x0
   \   00007F   7900         MOV     R1,#0x0
   \   000081   85..82       MOV     DPL,?XSP + 0
   \   000084   85..83       MOV     DPH,?XSP + 1
   \   000087   AA82         MOV     R2,DPL
   \   000089   AB83         MOV     R3,DPH
   \   00008B   12....       LCALL   ??osal_memset?relay
   1610          
   1611            return ( ret );
   \   00008E   EE           MOV     A,R6
   \   00008F   F9           MOV     R1,A
   \   000090   7415         MOV     A,#0x15
   \   000092   12....       LCALL   ?DEALLOC_XSTACK8
   \   000095   7F04         MOV     R7,#0x4
   \   000097   02....       LJMP    ?BANKED_LEAVE_XDATA
   1612          }
   1613          
   1614          /*********************************************************************
   1615           * @fn      ZDApp_ResetTimerStart
   1616           *
   1617           * @brief   Start the reset timer.
   1618           *
   1619           * @param   delay - delay time(ms) before reset
   1620           *
   1621           * @return  none
   1622           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1623          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1624          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   1625            // Start the rest timer
   1626            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000009                ; Setup parameters for call to function osal_start_timerEx
   \   000009   EE           MOV     A,R6
   \   00000A   FC           MOV     R4,A
   \   00000B   EF           MOV     A,R7
   \   00000C   FD           MOV     R5,A
   \   00000D   7A04         MOV     R2,#0x4
   \   00000F   7B00         MOV     R3,#0x0
   \   000011   90....       MOV     DPTR,#ZDAppTaskID
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F9           MOV     R1,A
   \   000016   12....       LCALL   ??osal_start_timerEx?relay
   \   000019   E9           MOV     A,R1
   1627          }
   \   00001A   7F01         MOV     R7,#0x1
   \   00001C   02....       LJMP    ?BANKED_LEAVE_XDATA
   1628          
   1629          /*********************************************************************
   1630           * @fn      ZDApp_ResetTimerCancel
   1631           *
   1632           * @brief   Cancel the reset timer.
   1633           *
   1634           * @param   none
   1635           *
   1636           * @return  none
   1637           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1638          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1639          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1640            // Cancel the reset timer
   1641            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   \   000010   E9           MOV     A,R1
   1642          }
   \   000011   D083         POP     DPH
   \   000013   D082         POP     DPL
   \   000015   02....       LJMP    ?BRET
   1643          
   1644          /*********************************************************************
   1645           * @fn      ZDApp_LeaveCtrlInit
   1646           *
   1647           * @brief   Initialize the leave control logic.
   1648           *
   1649           * @param   none
   1650           *
   1651           * @return  none
   1652           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1653          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1654          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1655            uint8 status;
   1656          
   1657          
   1658            // Initialize control state
   1659            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000008   7400         MOV     A,#0x0
   \   00000A   F0           MOVX    @DPTR,A
   1660          
   1661            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1662                                        sizeof(ZDApp_LeaveCtrl),
   1663                                        &ZDApp_LeaveCtrl );
   \   00000B                ; Setup parameters for call to function osal_nv_item_init
   \   00000B   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00000E   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000011   78..         MOV     R0,#?V0 + 0
   \   000013   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000016   7C01         MOV     R4,#0x1
   \   000018   7D00         MOV     R5,#0x0
   \   00001A   7A85         MOV     R2,#-0x7b
   \   00001C   7B00         MOV     R3,#0x0
   \   00001E   12....       LCALL   ??osal_nv_item_init?relay
   \   000021   7402         MOV     A,#0x2
   \   000023   12....       LCALL   ?DEALLOC_XSTACK8
   \   000026   E9           MOV     A,R1
   \   000027   FE           MOV     R6,A
   1664          
   1665            if ( status == ZSUCCESS )
   \   000028   7027         JNZ     ??ZDApp_LeaveCtrlInit_0
   1666            {
   1667              // Read saved control
   1668              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1669                            0,
   1670                            sizeof( uint8 ),
   1671                            &ZDApp_LeaveCtrl);
   \   00002A                ; Setup parameters for call to function osal_nv_read
   \   00002A   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00002D   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   75..01       MOV     ?V0 + 0,#0x1
   \   000038   75..00       MOV     ?V0 + 1,#0x0
   \   00003B   78..         MOV     R0,#?V0 + 0
   \   00003D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000040   7C00         MOV     R4,#0x0
   \   000042   7D00         MOV     R5,#0x0
   \   000044   7A85         MOV     R2,#-0x7b
   \   000046   7B00         MOV     R3,#0x0
   \   000048   12....       LCALL   ??osal_nv_read?relay
   \   00004B   7404         MOV     A,#0x4
   \   00004D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000050   E9           MOV     A,R1
   1672            }
   1673          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   000051   7F02         MOV     R7,#0x2
   \   000053   02....       LJMP    ?BANKED_LEAVE_XDATA
   1674          
   1675          /*********************************************************************
   1676           * @fn      ZDApp_LeaveCtrlSet
   1677           *
   1678           * @brief   Set the leave control logic.
   1679           *
   1680           * @param   ra - reassociate flag
   1681           *
   1682           * @return  none
   1683           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1684          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1685          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1686            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   7401         MOV     A,#0x1
   \   00000C   F0           MOVX    @DPTR,A
   1687          
   1688            if ( ra == TRUE )
   \   00000D   7401         MOV     A,#0x1
   \   00000F   6E           XRL     A,R6
   \   000010   7007         JNZ     ??ZDApp_LeaveCtrlSet_0
   1689            {
   1690              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   000012   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000015   E0           MOVX    A,@DPTR
   \   000016   D2E1         SETB    0xE0 /* A   */.1
   \   000018   F0           MOVX    @DPTR,A
   1691            }
   1692          
   1693            // Write the leave control
   1694            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1695                           0,
   1696                           sizeof( uint8 ),
   1697                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000019                ; Setup parameters for call to function osal_nv_write
   \   000019   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00001C   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000024   75..01       MOV     ?V0 + 0,#0x1
   \   000027   75..00       MOV     ?V0 + 1,#0x0
   \   00002A   78..         MOV     R0,#?V0 + 0
   \   00002C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002F   7C00         MOV     R4,#0x0
   \   000031   7D00         MOV     R5,#0x0
   \   000033   7A85         MOV     R2,#-0x7b
   \   000035   7B00         MOV     R3,#0x0
   \   000037   12....       LCALL   ??osal_nv_write?relay
   \   00003A   7404         MOV     A,#0x4
   \   00003C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003F   E9           MOV     A,R1
   1698          }
   \   000040   7F02         MOV     R7,#0x2
   \   000042   02....       LJMP    ?BANKED_LEAVE_XDATA
   1699          
   1700          /*********************************************************************
   1701           * @fn      ZDApp_LeaveCtrlReset
   1702           *
   1703           * @brief   Re-initialize the leave control logic.
   1704           *
   1705           * @param   none
   1706           *
   1707           * @return  none
   1708           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1709          void ZDApp_LeaveCtrlReset( void )
   \                     ZDApp_LeaveCtrlReset:
   1710          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1711            // Set leave control to initialized state
   1712            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000008   7400         MOV     A,#0x0
   \   00000A   F0           MOVX    @DPTR,A
   1713          
   1714            // Write initialized control
   1715            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1716                          0,
   1717                          sizeof( uint8 ),
   1718                          &ZDApp_LeaveCtrl);
   \   00000B                ; Setup parameters for call to function osal_nv_write
   \   00000B   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00000E   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000011   78..         MOV     R0,#?V0 + 0
   \   000013   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000016   75..01       MOV     ?V0 + 0,#0x1
   \   000019   75..00       MOV     ?V0 + 1,#0x0
   \   00001C   78..         MOV     R0,#?V0 + 0
   \   00001E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000021   7C00         MOV     R4,#0x0
   \   000023   7D00         MOV     R5,#0x0
   \   000025   7A85         MOV     R2,#-0x7b
   \   000027   7B00         MOV     R3,#0x0
   \   000029   12....       LCALL   ??osal_nv_write?relay
   \   00002C   7404         MOV     A,#0x4
   \   00002E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000031   E9           MOV     A,R1
   1719          }
   \   000032   7F02         MOV     R7,#0x2
   \   000034   02....       LJMP    ?BANKED_LEAVE_XDATA
   1720          
   1721          /*********************************************************************
   1722           * @fn      ZDApp_LeaveCtrlBypass
   1723           *
   1724           * @brief   Check if NV restore should be skipped during a leave reset.
   1725           *
   1726           * @param   none
   1727           *
   1728           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1729           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1730          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1731          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1732            uint8 bypass;
   1733          
   1734            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   5004         JNC     ??ZDApp_LeaveCtrlBypass_0
   1735            {
   1736              bypass = TRUE;
   \   00000C   7901         MOV     R1,#0x1
   \   00000E   8002         SJMP    ??ZDApp_LeaveCtrlBypass_1
   1737            }
   1738            else
   1739            {
   1740              bypass = FALSE;
   \                     ??ZDApp_LeaveCtrlBypass_0:
   \   000010   7900         MOV     R1,#0x0
   1741            }
   1742          
   1743            return bypass;
   \                     ??ZDApp_LeaveCtrlBypass_1:
   \   000012   D083         POP     DPH
   \   000014   D082         POP     DPL
   \   000016   02....       LJMP    ?BRET
   1744          }
   1745          
   1746          /*********************************************************************
   1747           * @fn      ZDApp_LeaveCtrlStartup
   1748           *
   1749           * @brief   Check for startup conditions during a leave reset.
   1750           *
   1751           * @param   state      - devState_t determined by leave control logic
   1752           * @param   startDelay - startup delay
   1753           *
   1754           * @return  none
   1755           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1756          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1757          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
   1758            *startDelay = 0;
   \   00000D   85..82       MOV     DPL,?V0 + 0
   \   000010   85..83       MOV     DPH,?V0 + 1
   \   000013   7400         MOV     A,#0x0
   \   000015   F0           MOVX    @DPTR,A
   \   000016   A3           INC     DPTR
   \   000017   7400         MOV     A,#0x0
   \   000019   F0           MOVX    @DPTR,A
   1759          
   1760            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00001A   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   A2E0         MOV     C,0xE0 /* A   */.0
   \   000020   5021         JNC     ??ZDApp_LeaveCtrlStartup_0
   1761            {
   1762              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000022   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000025   E0           MOVX    A,@DPTR
   \   000026   A2E1         MOV     C,0xE0 /* A   */.1
   \   000028   500F         JNC     ??ZDApp_LeaveCtrlStartup_1
   1763              {
   1764                *startDelay = LEAVE_RESET_DELAY;
   \   00002A   85..82       MOV     DPL,?V0 + 0
   \   00002D   85..83       MOV     DPH,?V0 + 1
   \   000030   7488         MOV     A,#-0x78
   \   000032   F0           MOVX    @DPTR,A
   \   000033   A3           INC     DPTR
   \   000034   7413         MOV     A,#0x13
   \   000036   F0           MOVX    @DPTR,A
   \   000037   8007         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1765              }
   1766              else
   1767              {
   1768                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000039   8E82         MOV     DPL,R6
   \   00003B   8F83         MOV     DPH,R7
   \   00003D   7400         MOV     A,#0x0
   \   00003F   F0           MOVX    @DPTR,A
   1769              }
   1770          
   1771              // Reset leave control logic
   1772              ZDApp_LeaveCtrlReset();
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   000040                ; Setup parameters for call to function ZDApp_LeaveCtrlReset
   \   000040   12....       LCALL   ??ZDApp_LeaveCtrlReset?relay
   1773            }
   1774          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000043   7F02         MOV     R7,#0x2
   \   000045   02....       LJMP    ?BANKED_LEAVE_XDATA
   1775          
   1776          /*********************************************************************
   1777           * @fn      ZDApp_LeaveReset
   1778           *
   1779           * @brief   Setup a device reset due to a leave indication/confirm.
   1780           *
   1781           * @param   ra - reassociate flag
   1782           *
   1783           * @return  none
   1784           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1785          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1786          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1787            ZDApp_LeaveCtrlSet( ra );
   \   000007                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000007   F9           MOV     R1,A
   \   000008   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1788          
   1789            ZDApp_ResetTimerStart( LEAVE_RESET_DELAY );
   \   00000B                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   00000B   7A88         MOV     R2,#-0x78
   \   00000D   7B13         MOV     R3,#0x13
   \   00000F   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1790          }
   \   000012   7F01         MOV     R7,#0x1
   \   000014   02....       LJMP    ?BANKED_LEAVE_XDATA
   1791          
   1792          /*********************************************************************
   1793           * @fn      ZDApp_LeaveUpdate
   1794           *
   1795           * @brief   Update local device data related to leaving device.
   1796           *
   1797           * @param   nwkAddr        - NWK address of leaving device
   1798           * @param   extAddr        - EXT address of leaving device
   1799           * @param   removeChildren - remove children of leaving device
   1800           *
   1801           * @return  none
   1802           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1803          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1804                                  uint8 removeChildren )
   1805          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EC           MOV     A,R4
   \   00000F   FE           MOV     R6,A
   \   000010   ED           MOV     A,R5
   \   000011   FF           MOV     R7,A
   \   000012   89..         MOV     ?V0 + 2,R1
   1806            // Remove Apps Key for leaving device
   1807            ZDSecMgrDeviceRemoveByExtAddr(extAddr);
   \   000014                ; Setup parameters for call to function ZDSecMgrDeviceRemoveByExtAddr
   \   000014   EE           MOV     A,R6
   \   000015   FA           MOV     R2,A
   \   000016   EF           MOV     A,R7
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??ZDSecMgrDeviceRemoveByExtAddr?relay
   \   00001B   E9           MOV     A,R1
   1808          
   1809            // Clear SECURITY bit from Address Manager
   1810            ZDSecMgrAddrClear( extAddr );
   \   00001C                ; Setup parameters for call to function ZDSecMgrAddrClear
   \   00001C   EE           MOV     A,R6
   \   00001D   FA           MOV     R2,A
   \   00001E   EF           MOV     A,R7
   \   00001F   FB           MOV     R3,A
   \   000020   12....       LCALL   ??ZDSecMgrAddrClear?relay
   \   000023   E9           MOV     A,R1
   1811          
   1812            if ( pbindRemoveDev )
   \   000024   90....       MOV     DPTR,#pbindRemoveDev
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F8           MOV     R0,A
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F9           MOV     R1,A
   \   00002C   E8           MOV     A,R0
   \   00002D   49           ORL     A,R1
   \   00002E   6041         JZ      ??ZDApp_LeaveUpdate_0
   1813            {
   1814              zAddrType_t devAddr;
   1815          
   1816              // Remove bind entry and all related data
   1817              devAddr.addrMode = Addr64Bit;
   \   000030   7408         MOV     A,#0x8
   \   000032   12....       LCALL   ?XSTACK_DISP0_8
   \   000035   7403         MOV     A,#0x3
   \   000037   F0           MOVX    @DPTR,A
   1818              osal_memcpy(devAddr.addr.extAddr, extAddr, Z_EXTADDR_LEN);
   \   000038                ; Setup parameters for call to function osal_memcpy
   \   000038   8E..         MOV     ?V0 + 4,R6
   \   00003A   8F..         MOV     ?V0 + 5,R7
   \   00003C   75..00       MOV     ?V0 + 6,#0x0
   \   00003F   78..         MOV     R0,#?V0 + 4
   \   000041   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000044   7C08         MOV     R4,#0x8
   \   000046   7D00         MOV     R5,#0x0
   \   000048   7403         MOV     A,#0x3
   \   00004A   12....       LCALL   ?XSTACK_DISP0_8
   \   00004D   AA82         MOV     R2,DPL
   \   00004F   AB83         MOV     R3,DPH
   \   000051   12....       LCALL   ??osal_memcpy?relay
   \   000054   7403         MOV     A,#0x3
   \   000056   12....       LCALL   ?DEALLOC_XSTACK8
   1819          
   1820              pbindRemoveDev(&devAddr);
   \   000059                ; Setup parameters for indirect call
   \   000059   85..82       MOV     DPL,?XSP + 0
   \   00005C   85..83       MOV     DPH,?XSP + 1
   \   00005F   AA82         MOV     R2,DPL
   \   000061   AB83         MOV     R3,DPH
   \   000063   90....       MOV     DPTR,#pbindRemoveDev
   \   000066   E0           MOVX    A,@DPTR
   \   000067   F8           MOV     R0,A
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F583         MOV     DPH,A
   \   00006C   8882         MOV     DPL,R0
   \   00006E   12....       LCALL   ?CALL_IND
   1821            }
   1822          
   1823            // Remove if child
   1824            if ( ZSTACK_ROUTER_BUILD )
   1825            {
   1826              NLME_RemoveChild( extAddr, removeChildren );
   1827            }
   1828          
   1829            // Remove Routing table related entry
   1830            RTG_RemoveRtgEntry( nwkAddr, 0 );
   \                     ??ZDApp_LeaveUpdate_0:
   \   000071                ; Setup parameters for call to function RTG_RemoveRtgEntry
   \   000071   7900         MOV     R1,#0x0
   \   000073   AA..         MOV     R2,?V0 + 0
   \   000075   AB..         MOV     R3,?V0 + 1
   \   000077   12....       LCALL   ??RTG_RemoveRtgEntry?relay
   \   00007A   E9           MOV     A,R1
   1831          
   1832            // Remove entry from neighborTable
   1833            nwkNeighborRemove( nwkAddr, _NIB.nwkPanId );
   \   00007B                ; Setup parameters for call to function nwkNeighborRemove
   \   00007B   90....       MOV     DPTR,#_NIB + 33
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   FC           MOV     R4,A
   \   000080   A3           INC     DPTR
   \   000081   E0           MOVX    A,@DPTR
   \   000082   FD           MOV     R5,A
   \   000083   AA..         MOV     R2,?V0 + 0
   \   000085   AB..         MOV     R3,?V0 + 1
   \   000087   12....       LCALL   ??nwkNeighborRemove?relay
   1834          
   1835            // Schedule to save data to NV
   1836            ZDApp_NwkWriteNVRequest();
   \   00008A                ; Setup parameters for call to function AddrMgrWriteNVRequest
   \   00008A   12....       LCALL   ??AddrMgrWriteNVRequest?relay
   1837          }
   \   00008D   7409         MOV     A,#0x9
   \   00008F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000092   7F07         MOV     R7,#0x7
   \   000094   02....       LJMP    ?BANKED_LEAVE_XDATA
   1838          
   1839          /*********************************************************************
   1840           * @fn      ZDApp_NetworkDiscoveryReq
   1841           *
   1842           * @brief   Request a network discovery.
   1843           *
   1844           * @param  scanChannels -
   1845           * @param  scanDuration -
   1846           *
   1847           * @return  ZStatus_t
   1848           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1849          ZStatus_t ZDApp_NetworkDiscoveryReq( uint32 scanChannels, uint8 scanDuration)
   \                     ZDApp_NetworkDiscoveryReq:
   1850          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   8C..         MOV     ?V0 + 2,R4
   \   00000B   8D..         MOV     ?V0 + 3,R5
   \   00000D   E9           MOV     A,R1
   \   00000E   FE           MOV     R6,A
   1851            // Setup optional filters - tbd
   1852          
   1853            // Request NLME network discovery
   1854            return NLME_NetworkDiscoveryRequest(scanChannels, scanDuration);
   \   00000F                ; Setup parameters for call to function NLME_NetworkDiscoveryRequest
   \   00000F   F9           MOV     R1,A
   \   000010   AA..         MOV     R2,?V0 + 0
   \   000012   AB..         MOV     R3,?V0 + 1
   \   000014   AC..         MOV     R4,?V0 + 2
   \   000016   AD..         MOV     R5,?V0 + 3
   \   000018   12....       LCALL   ??NLME_NetworkDiscoveryRequest?relay
   \   00001B   7F04         MOV     R7,#0x4
   \   00001D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1855          }
   1856          
   1857          /*********************************************************************
   1858           * @fn      ZDApp_JoinReq
   1859           *
   1860           * @brief   Request the device to join a parent in a network.
   1861           *
   1862           * @param   channel -
   1863           * @param   panID -
   1864           *
   1865           * @return  ZStatus_t
   1866           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1867          ZStatus_t ZDApp_JoinReq( uint8 channel, uint16 panID, uint8 *extendedPanID,
   \                     ZDApp_JoinReq:
   1868                                   uint16 chosenParent, uint8 parentDepth, uint8 stackProfile )
   1869          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 3,R1
   \   000007   8A..         MOV     ?V0 + 0,R2
   \   000009   8B..         MOV     ?V0 + 1,R3
   \   00000B   EC           MOV     A,R4
   \   00000C   FE           MOV     R6,A
   \   00000D   ED           MOV     A,R5
   \   00000E   FF           MOV     R7,A
   \   00000F   7410         MOV     A,#0x10
   \   000011   12....       LCALL   ?XSTACK_DISP0_8
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 6,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 7,A
   \   00001B   7412         MOV     A,#0x12
   \   00001D   12....       LCALL   ?XSTACK_DISP0_8
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F5..         MOV     ?V0 + 4,A
   \   000023   7413         MOV     A,#0x13
   \   000025   12....       LCALL   ?XSTACK_DISP0_8
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F5..         MOV     ?V0 + 2,A
   1870            // Sync up the node with the stack profile (In the case where a pro device
   1871            // joins a non-pro network, or verse versa)
   1872            ZDApp_NodeProfileSync( stackProfile);
   \   00002B                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   00002B   A9..         MOV     R1,?V0 + 2
   \   00002D   12....       LCALL   ??ZDApp_NodeProfileSync?relay
   1873          
   1874            // Request NLME Join Request
   1875            return NLME_JoinRequest(extendedPanID, panID,channel,
   1876                                    ZDO_Config_Node_Descriptor.CapabilityFlags,
   1877                                    chosenParent, parentDepth);
   \   000030                ; Setup parameters for call to function NLME_JoinRequest
   \   000030   E5..         MOV     A,?V0 + 4
   \   000032   F5..         MOV     ?V0 + 5,A
   \   000034   78..         MOV     R0,#?V0 + 5
   \   000036   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000039   78..         MOV     R0,#?V0 + 6
   \   00003B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003E   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000041   E0           MOVX    A,@DPTR
   \   000042   F5..         MOV     ?V0 + 5,A
   \   000044   78..         MOV     R0,#?V0 + 5
   \   000046   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000049   A9..         MOV     R1,?V0 + 3
   \   00004B   AC..         MOV     R4,?V0 + 0
   \   00004D   AD..         MOV     R5,?V0 + 1
   \   00004F   EE           MOV     A,R6
   \   000050   FA           MOV     R2,A
   \   000051   EF           MOV     A,R7
   \   000052   FB           MOV     R3,A
   \   000053   12....       LCALL   ??NLME_JoinRequest?relay
   \   000056   7404         MOV     A,#0x4
   \   000058   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005B   7F08         MOV     R7,#0x8
   \   00005D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1878          
   1879          }
   1880          
   1881          /*********************************************************************
   1882           * @fn      ZDApp_DeviceConfigured
   1883           *
   1884           * @brief   Check to see if the local device is configured (i.e., part
   1885           *          of a network).
   1886           *
   1887           * @param   none
   1888           *
   1889           * @return  TRUE if configured. FALSE, otherwise.
   1890           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1891          uint8 ZDApp_DeviceConfigured( void )
   \                     ZDApp_DeviceConfigured:
   1892          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1893            uint16 nwkAddr = INVALID_NODE_ADDR;
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   74FE         MOV     A,#-0x2
   \   000012   F0           MOVX    @DPTR,A
   \   000013   A3           INC     DPTR
   \   000014   74FF         MOV     A,#-0x1
   \   000016   F0           MOVX    @DPTR,A
   1894          
   1895            osal_nv_read( ZCD_NV_NIB, osal_offsetof( nwkIB_t, nwkDevAddress ),
   1896                          sizeof( uint16), &nwkAddr );
   \   000017                ; Setup parameters for call to function osal_nv_read
   \   000017   85..82       MOV     DPL,?XSP + 0
   \   00001A   85..83       MOV     DPH,?XSP + 1
   \   00001D   8582..       MOV     ?V0 + 0,DPL
   \   000020   8583..       MOV     ?V0 + 1,DPH
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000028   75..02       MOV     ?V0 + 0,#0x2
   \   00002B   75..00       MOV     ?V0 + 1,#0x0
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000033   7C14         MOV     R4,#0x14
   \   000035   7D00         MOV     R5,#0x0
   \   000037   7A21         MOV     R2,#0x21
   \   000039   7B00         MOV     R3,#0x0
   \   00003B   12....       LCALL   ??osal_nv_read?relay
   \   00003E   7404         MOV     A,#0x4
   \   000040   12....       LCALL   ?DEALLOC_XSTACK8
   \   000043   E9           MOV     A,R1
   1897          
   1898            // Does the NIB have anything more than default?
   1899            return ( nwkAddr == INVALID_NODE_ADDR ? FALSE : TRUE );
   \   000044   85..82       MOV     DPL,?XSP + 0
   \   000047   85..83       MOV     DPH,?XSP + 1
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   64FE         XRL     A,#0xfe
   \   00004D   7004         JNZ     ??ZDApp_DeviceConfigured_0
   \   00004F   A3           INC     DPTR
   \   000050   E0           MOVX    A,@DPTR
   \   000051   64FF         XRL     A,#0xff
   \                     ??ZDApp_DeviceConfigured_0:
   \   000053   7004         JNZ     ??ZDApp_DeviceConfigured_1
   \   000055   7900         MOV     R1,#0x0
   \   000057   8002         SJMP    ??ZDApp_DeviceConfigured_2
   \                     ??ZDApp_DeviceConfigured_1:
   \   000059   7901         MOV     R1,#0x1
   \                     ??ZDApp_DeviceConfigured_2:
   \   00005B   7402         MOV     A,#0x2
   \   00005D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000060   7F02         MOV     R7,#0x2
   \   000062   02....       LJMP    ?BANKED_LEAVE_XDATA
   1900          }
   1901          
   1902          /*********************************************************************
   1903           * CALLBACK FUNCTIONS
   1904           */
   1905          
   1906          
   1907          /*********************************************************************
   1908           * @fn      ZDApp_SendEventMsg()
   1909           *
   1910           * @brief
   1911           *
   1912           *   Sends a Network Join message
   1913           *
   1914           * @param  cmd - command ID
   1915           * @param  len - length (in bytes) of the buf field
   1916           * @param  buf - buffer for the rest of the message.
   1917           *
   1918           * @return  none
   1919           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1920          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1921          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   8A..         MOV     ?V0 + 1,R2
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
   1922            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   00000D                ; Setup parameters for call to function ZDApp_SendMsg
   \   00000D   EE           MOV     A,R6
   \   00000E   FC           MOV     R4,A
   \   00000F   EF           MOV     A,R7
   \   000010   FD           MOV     R5,A
   \   000011   AB..         MOV     R3,?V0 + 1
   \   000013   AA..         MOV     R2,?V0 + 0
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??ZDApp_SendMsg?relay
   1923          }
   \   00001D   7F02         MOV     R7,#0x2
   \   00001F   02....       LJMP    ?BANKED_LEAVE_XDATA
   1924          
   1925          /*********************************************************************
   1926           * @fn      ZDApp_SendMsg()
   1927           *
   1928           * @brief   Sends a OSAL message
   1929           *
   1930           * @param  taskID - Where to send the message
   1931           * @param  cmd - command ID
   1932           * @param  len - length (in bytes) of the buf field
   1933           * @param  buf - buffer for the rest of the message.
   1934           *
   1935           * @return  none
   1936           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1937          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   1938          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 2,R1
   \   000007   8A..         MOV     ?V0 + 3,R2
   \   000009   8B..         MOV     ?V0 + 7,R3
   \   00000B   8C..         MOV     ?V0 + 0,R4
   \   00000D   8D..         MOV     ?V0 + 1,R5
   1939            osal_event_hdr_t *msgPtr;
   1940          
   1941            // Send the address to the task
   1942            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F                ; Setup parameters for call to function osal_msg_allocate
   \   00000F   85....       MOV     ?V0 + 4,?V0 + 7
   \   000012   75..00       MOV     ?V0 + 5,#0x0
   \   000015   AA..         MOV     R2,?V0 + 4
   \   000017   AB..         MOV     R3,?V0 + 5
   \   000019   12....       LCALL   ??osal_msg_allocate?relay
   \   00001C   8A..         MOV     ?V0 + 4,R2
   \   00001E   8B..         MOV     ?V0 + 5,R3
   \   000020   AE..         MOV     R6,?V0 + 4
   \   000022   AF..         MOV     R7,?V0 + 5
   1943            if ( msgPtr )
   \   000024   EE           MOV     A,R6
   \   000025   4F           ORL     A,R7
   \   000026   6044         JZ      ??ZDApp_SendMsg_0
   1944            {
   1945              if ( (len > 0) && (buf != NULL) )
   \   000028   E5..         MOV     A,?V0 + 7
   \   00002A   C3           CLR     C
   \   00002B   9401         SUBB    A,#0x1
   \   00002D   402A         JC      ??ZDApp_SendMsg_1
   \   00002F   E5..         MOV     A,?V0 + 0
   \   000031   45..         ORL     A,?V0 + 1
   \   000033   6024         JZ      ??ZDApp_SendMsg_1
   1946                osal_memcpy( msgPtr, buf, len );
   \   000035                ; Setup parameters for call to function osal_memcpy
   \   000035   85....       MOV     ?V0 + 4,?V0 + 0
   \   000038   85....       MOV     ?V0 + 5,?V0 + 1
   \   00003B   75..00       MOV     ?V0 + 6,#0x0
   \   00003E   78..         MOV     R0,#?V0 + 4
   \   000040   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000043   85....       MOV     ?V0 + 4,?V0 + 7
   \   000046   75..00       MOV     ?V0 + 5,#0x0
   \   000049   AC..         MOV     R4,?V0 + 4
   \   00004B   AD..         MOV     R5,?V0 + 5
   \   00004D   EE           MOV     A,R6
   \   00004E   FA           MOV     R2,A
   \   00004F   EF           MOV     A,R7
   \   000050   FB           MOV     R3,A
   \   000051   12....       LCALL   ??osal_memcpy?relay
   \   000054   7403         MOV     A,#0x3
   \   000056   12....       LCALL   ?DEALLOC_XSTACK8
   1947          
   1948              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_1:
   \   000059   E5..         MOV     A,?V0 + 3
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   E5..         MOV     A,?V0 + 3
   \   000061   F0           MOVX    @DPTR,A
   1949              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000062                ; Setup parameters for call to function osal_msg_send
   \   000062   EE           MOV     A,R6
   \   000063   FA           MOV     R2,A
   \   000064   EF           MOV     A,R7
   \   000065   FB           MOV     R3,A
   \   000066   A9..         MOV     R1,?V0 + 2
   \   000068   12....       LCALL   ??osal_msg_send?relay
   \   00006B   E9           MOV     A,R1
   1950            }
   1951          }
   \                     ??ZDApp_SendMsg_0:
   \   00006C   7F08         MOV     R7,#0x8
   \   00006E   02....       LJMP    ?BANKED_LEAVE_XDATA
   1952          
   1953          /*********************************************************************
   1954           * Call Back Functions from NWK  - API
   1955           */
   1956          
   1957          /*********************************************************************
   1958           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1959           *
   1960           * @brief       This function returns a choice of PAN to join.
   1961           *
   1962           * @param       status - return status of the nwk discovery confirm
   1963           *
   1964           * @return      ZStatus_t
   1965           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1966          ZStatus_t ZDO_NetworkDiscoveryConfirmCB(uint8 status)
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1967          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 3
   \   000004   74FD         MOV     A,#-0x3
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
   \   000009   E9           MOV     A,R1
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   F0           MOVX    @DPTR,A
   1968            osal_event_hdr_t msg;
   1969          
   1970            // If Scan is initiated by ZDO_MGMT_NWK_DISC_REQ
   1971            // Send ZDO_MGMT_NWK_DISC_RSP back
   1972          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1973            if ( zdappMgmtNwkDiscReqInProgress )
   1974            {
   1975              zdappMgmtNwkDiscReqInProgress = false;
   1976              ZDO_FinishProcessingMgmtNwkDiscReq();
   1977            }
   1978            else
   1979          #endif
   1980            {
   1981              // Pass the confirm to another task if it registers the callback
   1982              // Otherwise, pass the confirm to ZDApp.
   1983              if (zdoCBFunc[ZDO_NWK_DISCOVERY_CNF_CBID] != NULL )
   \   000011   90....       MOV     DPTR,#zdoCBFunc + 4
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F8           MOV     R0,A
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   F9           MOV     R1,A
   \   000019   E8           MOV     A,R0
   \   00001A   49           ORL     A,R1
   \   00001B   601A         JZ      ??ZDO_NetworkDiscoveryConfirmCB_0
   1984              {
   1985                zdoCBFunc[ZDO_NWK_DISCOVERY_CNF_CBID]( (void*)&status );
   \   00001D                ; Setup parameters for indirect call
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   AA82         MOV     R2,DPL
   \   000025   AB83         MOV     R3,DPH
   \   000027   90....       MOV     DPTR,#zdoCBFunc + 4
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F8           MOV     R0,A
   \   00002C   A3           INC     DPTR
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   F583         MOV     DPH,A
   \   000030   8882         MOV     DPL,R0
   \   000032   12....       LCALL   ?CALL_IND
   \   000035   801D         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   1986              }
   1987              else
   1988              {
   1989                // Otherwise, send scan confirm to ZDApp task to proceed
   1990                msg.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000037   7402         MOV     A,#0x2
   \   000039   12....       LCALL   ?XSTACK_DISP0_8
   \   00003C   7400         MOV     A,#0x0
   \   00003E   F0           MOVX    @DPTR,A
   1991                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(osal_event_hdr_t), (uint8 *)&msg );
   \   00003F                ; Setup parameters for call to function ZDApp_SendMsg
   \   00003F   7401         MOV     A,#0x1
   \   000041   12....       LCALL   ?XSTACK_DISP0_8
   \   000044   AC82         MOV     R4,DPL
   \   000046   AD83         MOV     R5,DPH
   \   000048   7B02         MOV     R3,#0x2
   \   00004A   7A01         MOV     R2,#0x1
   \   00004C   90....       MOV     DPTR,#ZDAppTaskID
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   F9           MOV     R1,A
   \   000051   12....       LCALL   ??ZDApp_SendMsg?relay
   1992              }
   1993            }
   1994            return (ZSuccess);
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   000054   7900         MOV     R1,#0x0
   \   000056   7403         MOV     A,#0x3
   \   000058   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005B   D083         POP     DPH
   \   00005D   D082         POP     DPL
   \   00005F   02....       LJMP    ?BRET
   1995          }  // ZDO_NetworkDiscoveryConfirmCB
   1996          
   1997          /*********************************************************************
   1998           * @fn          ZDApp_NwkDescListProcessing
   1999           *
   2000           * @brief       This function process the network discovery result and select
   2001           *              a parent device to join itself.
   2002           *
   2003           * @param       none
   2004           *
   2005           * @return      ZStatus_t
   2006           */
   2007          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2008          networkDesc_t* ZDApp_NwkDescListProcessing(void)
   \                     ZDApp_NwkDescListProcessing:
   2009          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   2010            networkDesc_t *pNwkDesc;
   2011            uint8 i, ResultCount = 0;
   \   000005   75..00       MOV     ?V0 + 1,#0x0
   2012            uint8 stackProfile;
   2013            uint8 stackProfilePro;
   2014            uint8 selected;
   2015          
   2016            // Count the number of nwk descriptors in the list
   2017            pNwkDesc = nwk_getNwkDescList();
   \   000008                ; Setup parameters for call to function nwk_getNwkDescList
   \   000008   12....       LCALL   ??nwk_getNwkDescList?relay
   \   00000B   8A..         MOV     ?V0 + 6,R2
   \   00000D   8B..         MOV     ?V0 + 7,R3
   \   00000F   AE..         MOV     R6,?V0 + 6
   \   000011   AF..         MOV     R7,?V0 + 7
   2018            while (pNwkDesc)
   \                     ??ZDApp_NwkDescListProcessing_0:
   \   000013   EE           MOV     A,R6
   \   000014   4F           ORL     A,R7
   \   000015   6013         JZ      ??ZDApp_NwkDescListProcessing_1
   2019            {
   2020              ResultCount++;
   \   000017   05..         INC     ?V0 + 1
   2021              pNwkDesc = pNwkDesc->nextDesc;
   \   000019   EE           MOV     A,R6
   \   00001A   2414         ADD     A,#0x14
   \   00001C   F582         MOV     DPL,A
   \   00001E   EF           MOV     A,R7
   \   00001F   3400         ADDC    A,#0x0
   \   000021   F583         MOV     DPH,A
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FE           MOV     R6,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FF           MOV     R7,A
   \   000028   80E9         SJMP    ??ZDApp_NwkDescListProcessing_0
   2022            }
   2023          
   2024            // process discovery results
   2025            stackProfilePro = FALSE;
   \                     ??ZDApp_NwkDescListProcessing_1:
   \   00002A   75..00       MOV     ?V0 + 3,#0x0
   2026            selected = FALSE;
   \   00002D   75..00       MOV     ?V0 + 4,#0x0
   2027          
   2028          
   2029            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000030   75..00       MOV     ?V0 + 2,#0x0
   \                     ??ZDApp_NwkDescListProcessing_2:
   \   000033   E5..         MOV     A,?V0 + 2
   \   000035   C3           CLR     C
   \   000036   9402         SUBB    A,#0x2
   \   000038   4003         JC      $+5
   \   00003A   02....       LJMP    ??ZDApp_NwkDescListProcessing_3 & 0xFFFF
   2030            {
   2031              pNwkDesc = nwk_getNwkDescList();
   \   00003D                ; Setup parameters for call to function nwk_getNwkDescList
   \   00003D   12....       LCALL   ??nwk_getNwkDescList?relay
   \   000040   8A..         MOV     ?V0 + 6,R2
   \   000042   8B..         MOV     ?V0 + 7,R3
   \   000044   AE..         MOV     R6,?V0 + 6
   \   000046   AF..         MOV     R7,?V0 + 7
   2032              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   000048   75..00       MOV     ?V0 + 0,#0x0
   \                     ??ZDApp_NwkDescListProcessing_4:
   \   00004B   E5..         MOV     A,?V0 + 0
   \   00004D   C3           CLR     C
   \   00004E   95..         SUBB    A,?V0 + 1
   \   000050   4003         JC      $+5
   \   000052   02....       LJMP    ??ZDApp_NwkDescListProcessing_5 & 0xFFFF
   2033              {
   2034                if ( zgConfigPANID != 0xFFFF )
   \   000055   90....       MOV     DPTR,#zgConfigPANID
   \   000058   E0           MOVX    A,@DPTR
   \   000059   64FF         XRL     A,#0xff
   \   00005B   7004         JNZ     ??ZDApp_NwkDescListProcessing_6
   \   00005D   A3           INC     DPTR
   \   00005E   E0           MOVX    A,@DPTR
   \   00005F   64FF         XRL     A,#0xff
   \                     ??ZDApp_NwkDescListProcessing_6:
   \   000061   6018         JZ      ??ZDApp_NwkDescListProcessing_7
   2035                {
   2036                  // PAN Id is preconfigured. check if it matches
   2037                  if ( pNwkDesc->panId != zgConfigPANID )
   \   000063   8E82         MOV     DPL,R6
   \   000065   8F83         MOV     DPH,R7
   \   000067   E0           MOVX    A,@DPTR
   \   000068   F8           MOV     R0,A
   \   000069   A3           INC     DPTR
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   F9           MOV     R1,A
   \   00006C   90....       MOV     DPTR,#zgConfigPANID
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   68           XRL     A,R0
   \   000071   7003         JNZ     ??ZDApp_NwkDescListProcessing_8
   \   000073   A3           INC     DPTR
   \   000074   E0           MOVX    A,@DPTR
   \   000075   69           XRL     A,R1
   \                     ??ZDApp_NwkDescListProcessing_8:
   \   000076   6003         JZ      $+5
   \   000078   02....       LJMP    ??ZDApp_NwkDescListProcessing_9 & 0xFFFF
   2038                    continue;
   2039                }
   2040          
   2041                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true )
   \                     ??ZDApp_NwkDescListProcessing_7:
   \   00007B                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   00007B   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00007D   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   00007F   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   000082   E9           MOV     A,R1
   \   000083   6401         XRL     A,#0x1
   \   000085   7012         JNZ     ??ZDApp_NwkDescListProcessing_10
   2042                {
   2043                  // If the extended Pan ID is commissioned to a non zero value
   2044                  // Only join the Pan that has match EPID
   2045                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   \   000087                ; Setup parameters for call to function sAddrExtCmp
   \   000087   EE           MOV     A,R6
   \   000088   240B         ADD     A,#0xb
   \   00008A   FC           MOV     R4,A
   \   00008B   EF           MOV     A,R7
   \   00008C   3400         ADDC    A,#0x0
   \   00008E   FD           MOV     R5,A
   \   00008F   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   000091   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000093   12....       LCALL   ??sAddrExtCmp?relay
   \   000096   E9           MOV     A,R1
   \   000097   6065         JZ      ??ZDApp_NwkDescListProcessing_9
   2046                    continue;
   2047          
   2048                }
   2049          
   2050                // check that network is allowing joining
   2051                if ( ZSTACK_ROUTER_BUILD )
   2052                {
   2053                  if ( stackProfilePro == FALSE )
   2054                  {
   2055                    if ( !pNwkDesc->routerCapacity )
   2056                    {
   2057                      continue;
   2058                    }
   2059                  }
   2060                  else
   2061                  {
   2062                    if ( !pNwkDesc->deviceCapacity )
   2063                    {
   2064                      continue;
   2065                    }
   2066                  }
   2067                }
   2068                else if ( ZSTACK_END_DEVICE_BUILD )
   2069                {
   2070                  if ( !pNwkDesc->deviceCapacity )
   \                     ??ZDApp_NwkDescListProcessing_10:
   \   000099   8E82         MOV     DPL,R6
   \   00009B   8F83         MOV     DPH,R7
   \   00009D   A3           INC     DPTR
   \   00009E   A3           INC     DPTR
   \   00009F   A3           INC     DPTR
   \   0000A0   A3           INC     DPTR
   \   0000A1   E0           MOVX    A,@DPTR
   \   0000A2   605A         JZ      ??ZDApp_NwkDescListProcessing_9
   2071                  {
   2072                    continue;
   2073                  }
   2074                }
   2075          
   2076                // check version of zigbee protocol
   2077                if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   \   0000A4   8E82         MOV     DPL,R6
   \   0000A6   8F83         MOV     DPH,R7
   \   0000A8   A3           INC     DPTR
   \   0000A9   A3           INC     DPTR
   \   0000AA   A3           INC     DPTR
   \   0000AB   A3           INC     DPTR
   \   0000AC   A3           INC     DPTR
   \   0000AD   E0           MOVX    A,@DPTR
   \   0000AE   F8           MOV     R0,A
   \   0000AF   90....       MOV     DPTR,#_NIB + 17
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   68           XRL     A,R0
   \   0000B4   7048         JNZ     ??ZDApp_NwkDescListProcessing_9
   2078                  continue;
   2079          
   2080                // check version of stack profile
   2081                if ( pNwkDesc->stackProfile != zgStackProfile  )
   \   0000B6   8E82         MOV     DPL,R6
   \   0000B8   8F83         MOV     DPH,R7
   \   0000BA   A3           INC     DPTR
   \   0000BB   A3           INC     DPTR
   \   0000BC   A3           INC     DPTR
   \   0000BD   A3           INC     DPTR
   \   0000BE   A3           INC     DPTR
   \   0000BF   A3           INC     DPTR
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   F8           MOV     R0,A
   \   0000C2   90....       MOV     DPTR,#zgStackProfile
   \   0000C5   E0           MOVX    A,@DPTR
   \   0000C6   68           XRL     A,R0
   \   0000C7   6049         JZ      ??ZDApp_NwkDescListProcessing_5
   2082                {
   2083                  if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE))
   2084                      || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   \   0000C9   90....       MOV     DPTR,#zgStackProfile
   \   0000CC   E0           MOVX    A,@DPTR
   \   0000CD   6401         XRL     A,#0x1
   \   0000CF   700F         JNZ     ??ZDApp_NwkDescListProcessing_11
   \   0000D1   8E82         MOV     DPL,R6
   \   0000D3   8F83         MOV     DPH,R7
   \   0000D5   A3           INC     DPTR
   \   0000D6   A3           INC     DPTR
   \   0000D7   A3           INC     DPTR
   \   0000D8   A3           INC     DPTR
   \   0000D9   A3           INC     DPTR
   \   0000DA   A3           INC     DPTR
   \   0000DB   E0           MOVX    A,@DPTR
   \   0000DC   6402         XRL     A,#0x2
   \   0000DE   6017         JZ      ??ZDApp_NwkDescListProcessing_12
   \                     ??ZDApp_NwkDescListProcessing_11:
   \   0000E0   90....       MOV     DPTR,#zgStackProfile
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   6402         XRL     A,#0x2
   \   0000E6   7012         JNZ     ??ZDApp_NwkDescListProcessing_13
   \   0000E8   8E82         MOV     DPL,R6
   \   0000EA   8F83         MOV     DPH,R7
   \   0000EC   A3           INC     DPTR
   \   0000ED   A3           INC     DPTR
   \   0000EE   A3           INC     DPTR
   \   0000EF   A3           INC     DPTR
   \   0000F0   A3           INC     DPTR
   \   0000F1   A3           INC     DPTR
   \   0000F2   E0           MOVX    A,@DPTR
   \   0000F3   6401         XRL     A,#0x1
   \   0000F5   7003         JNZ     ??ZDApp_NwkDescListProcessing_13
   2085                  {
   2086                    stackProfilePro = TRUE;
   \                     ??ZDApp_NwkDescListProcessing_12:
   \   0000F7   75..01       MOV     ?V0 + 3,#0x1
   2087                  }
   2088          
   2089                  if ( stackProfile == 0 )
   \                     ??ZDApp_NwkDescListProcessing_13:
   \   0000FA   E5..         MOV     A,?V0 + 2
   \   0000FC   7014         JNZ     ??ZDApp_NwkDescListProcessing_5
   2090                  {
   2091                    continue;
   2092                  }
   2093                }
   2094          
   2095                break;
   2096              }
   \                     ??ZDApp_NwkDescListProcessing_9:
   \   0000FE   05..         INC     ?V0 + 0
   \   000100   EE           MOV     A,R6
   \   000101   2414         ADD     A,#0x14
   \   000103   F582         MOV     DPL,A
   \   000105   EF           MOV     A,R7
   \   000106   3400         ADDC    A,#0x0
   \   000108   F583         MOV     DPH,A
   \   00010A   E0           MOVX    A,@DPTR
   \   00010B   FE           MOV     R6,A
   \   00010C   A3           INC     DPTR
   \   00010D   E0           MOVX    A,@DPTR
   \   00010E   FF           MOV     R7,A
   \   00010F   02....       LJMP    ??ZDApp_NwkDescListProcessing_4 & 0xFFFF
   2097          
   2098              if (i < ResultCount)
   \                     ??ZDApp_NwkDescListProcessing_5:
   \   000112   E5..         MOV     A,?V0 + 0
   \   000114   C3           CLR     C
   \   000115   95..         SUBB    A,?V0 + 1
   \   000117   5005         JNC     ??ZDApp_NwkDescListProcessing_14
   2099              {
   2100               selected = TRUE;
   \   000119   75..01       MOV     ?V0 + 4,#0x1
   2101                break;
   \   00011C   800F         SJMP    ??ZDApp_NwkDescListProcessing_3
   2102              }
   2103          
   2104              // break if selected or stack profile pro wasn't found
   2105              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \                     ??ZDApp_NwkDescListProcessing_14:
   \   00011E   7401         MOV     A,#0x1
   \   000120   65..         XRL     A,?V0 + 4
   \   000122   6009         JZ      ??ZDApp_NwkDescListProcessing_3
   \   000124   E5..         MOV     A,?V0 + 3
   \   000126   6005         JZ      ??ZDApp_NwkDescListProcessing_3
   2106              {
   2107                break;
   2108              }
   2109            }
   \   000128   05..         INC     ?V0 + 2
   \   00012A   02....       LJMP    ??ZDApp_NwkDescListProcessing_2 & 0xFFFF
   2110          
   2111            if ( i == ResultCount )
   \                     ??ZDApp_NwkDescListProcessing_3:
   \   00012D   E5..         MOV     A,?V0 + 1
   \   00012F   65..         XRL     A,?V0 + 0
   \   000131   7006         JNZ     ??ZDApp_NwkDescListProcessing_15
   2112            {
   2113              return (NULL);   // couldn't find appropriate PAN to join !
   \   000133   7A00         MOV     R2,#0x0
   \   000135   7B00         MOV     R3,#0x0
   \   000137   8004         SJMP    ??ZDApp_NwkDescListProcessing_16
   2114            }
   2115            else
   2116            {
   2117              return (pNwkDesc);
   \                     ??ZDApp_NwkDescListProcessing_15:
   \   000139   EE           MOV     A,R6
   \   00013A   FA           MOV     R2,A
   \   00013B   EF           MOV     A,R7
   \   00013C   FB           MOV     R3,A
   \                     ??ZDApp_NwkDescListProcessing_16:
   \   00013D   7F08         MOV     R7,#0x8
   \   00013F   02....       LJMP    ?BANKED_LEAVE_XDATA
   2118            }
   2119          }// ZDApp_NwkDescListProcessing()
   2120          
   2121          /*********************************************************************
   2122           * @fn          ZDO_NetworkFormationConfirmCB
   2123           *
   2124           * @brief       This function reports the results of the request to
   2125           *              initialize a coordinator in a network.
   2126           *
   2127           * @param       Status - Result of NLME_NetworkFormationRequest()
   2128           *
   2129           * @return      none
   2130           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2131          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   2132          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2133            nwkStatus = (byte)Status;
   \   000007   EE           MOV     A,R6
   \   000008   90....       MOV     DPTR,#nwkStatus
   \   00000B   F0           MOVX    @DPTR,A
   2134          
   2135            if ( Status == ZSUCCESS )
   \   00000C   EE           MOV     A,R6
   \   00000D   701C         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   2136            {
   2137              // LED on shows Coordinator started
   2138              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000F                ; Setup parameters for call to function HalLedSet
   \   00000F   7A01         MOV     R2,#0x1
   \   000011   7904         MOV     R1,#0x4
   \   000013   12....       LCALL   ??HalLedSet?relay
   \   000016   E9           MOV     A,R1
   2139          
   2140              // LED off forgets HOLD_AUTO_START
   2141              HalLedSet (HAL_LED_4, HAL_LED_MODE_OFF);
   \   000017                ; Setup parameters for call to function HalLedSet
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7908         MOV     R1,#0x8
   \   00001B   12....       LCALL   ??HalLedSet?relay
   \   00001E   E9           MOV     A,R1
   2142          
   2143          #if defined ( ZBIT )
   2144              SIM_SetColor(0xd0ffd0);
   2145          #endif
   2146          
   2147              if ( devState == DEV_HOLD )
   \   00001F   90....       MOV     DPTR,#devState
   \   000022   E0           MOVX    A,@DPTR
   \   000023   7006         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   2148              {
   2149                // Began with HOLD_AUTO_START
   2150                devState = DEV_COORD_STARTING;
   \   000025   90....       MOV     DPTR,#devState
   \   000028   7408         MOV     A,#0x8
   \   00002A   F0           MOVX    @DPTR,A
   2151              }
   2152            }
   2153          #if defined(BLINK_LEDS)
   2154            else
   2155            {
   2156              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   2157            }
   2158          #endif
   2159          
   2160            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   00002B                ; Setup parameters for call to function osal_set_event
   \   00002B   7A02         MOV     R2,#0x2
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   90....       MOV     DPTR,#ZDAppTaskID
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F9           MOV     R1,A
   \   000034   12....       LCALL   ??osal_set_event?relay
   \   000037   E9           MOV     A,R1
   2161          }
   \   000038   7F01         MOV     R7,#0x1
   \   00003A   02....       LJMP    ?BANKED_LEAVE_XDATA
   2162          
   2163          /****************************************************************************
   2164           * @fn          ZDApp_beaconIndProcessing
   2165           *
   2166           * @brief       This function processes the incoming beacon indication.
   2167           *
   2168           *              When another task (MT or App) is registered to process
   2169           *              beacon indication themselves, this function will parse the
   2170           *              beacon payload and pass the beacon descriptor to that task
   2171           *              If no other tasks registered, this function will process
   2172           *              the beacon payload and generate the network descriptor link
   2173           *              list.
   2174           *
   2175           * @param
   2176           *
   2177           * @return      none
   2178           *
   2179           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2180          void ZDO_beaconNotifyIndCB( NLME_beaconInd_t *pBeacon )
   \                     ZDO_beaconNotifyIndCB:
   2181          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   2182            // Pass the beacon Indication to another task if it registers the callback
   2183            // Otherwise, process the beacon notification here.
   2184            if (zdoCBFunc[ZDO_BEACON_NOTIFY_IND_CBID] != NULL )
   \   000009   90....       MOV     DPTR,#zdoCBFunc + 6
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F8           MOV     R0,A
   \   00000E   A3           INC     DPTR
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F9           MOV     R1,A
   \   000011   E8           MOV     A,R0
   \   000012   49           ORL     A,R1
   \   000013   6015         JZ      ??ZDO_beaconNotifyIndCB_0
   2185            {
   2186              zdoCBFunc[ZDO_BEACON_NOTIFY_IND_CBID]( (void*)pBeacon );
   \   000015                ; Setup parameters for indirect call
   \   000015   AA..         MOV     R2,?V0 + 0
   \   000017   AB..         MOV     R3,?V0 + 1
   \   000019   90....       MOV     DPTR,#zdoCBFunc + 6
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F8           MOV     R0,A
   \   00001E   A3           INC     DPTR
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F583         MOV     DPH,A
   \   000022   8882         MOV     DPL,R0
   \   000024   12....       LCALL   ?CALL_IND
   \   000027   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2187            }
   2188            else
   2189            {
   2190              networkDesc_t *pNwkDesc;
   2191              networkDesc_t *pLastNwkDesc;
   2192              uint8 found = false;
   \                     ??ZDO_beaconNotifyIndCB_0:
   \   00002A   75..00       MOV     ?V0 + 2,#0x0
   2193          
   2194              // Add the network to the Network Descriptor List
   2195              pNwkDesc = NwkDescList;
   \   00002D   90....       MOV     DPTR,#NwkDescList
   \   000030   E0           MOVX    A,@DPTR
   \   000031   F8           MOV     R0,A
   \   000032   A3           INC     DPTR
   \   000033   E0           MOVX    A,@DPTR
   \   000034   F9           MOV     R1,A
   \   000035   E8           MOV     A,R0
   \   000036   FE           MOV     R6,A
   \   000037   E9           MOV     A,R1
   \   000038   FF           MOV     R7,A
   2196              pLastNwkDesc = NwkDescList;
   \   000039   90....       MOV     DPTR,#NwkDescList
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   F8           MOV     R0,A
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   F9           MOV     R1,A
   \   000041   88..         MOV     ?V0 + 4,R0
   \   000043   89..         MOV     ?V0 + 5,R1
   2197              while (pNwkDesc)
   \                     ??ZDO_beaconNotifyIndCB_2:
   \   000045   EE           MOV     A,R6
   \   000046   4F           ORL     A,R7
   \   000047   604A         JZ      ??ZDO_beaconNotifyIndCB_3
   2198              {
   2199                if ((pNwkDesc->panId == pBeacon->panID) &&
   2200                    (pNwkDesc->logicalChannel == pBeacon->logicalChannel))
   \   000049   8E82         MOV     DPL,R6
   \   00004B   8F83         MOV     DPH,R7
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   F8           MOV     R0,A
   \   00004F   A3           INC     DPTR
   \   000050   E0           MOVX    A,@DPTR
   \   000051   F9           MOV     R1,A
   \   000052   85..82       MOV     DPL,?V0 + 0
   \   000055   85..83       MOV     DPH,?V0 + 1
   \   000058   A3           INC     DPTR
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   68           XRL     A,R0
   \   00005C   7003         JNZ     ??ZDO_beaconNotifyIndCB_4
   \   00005E   A3           INC     DPTR
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   69           XRL     A,R1
   \                     ??ZDO_beaconNotifyIndCB_4:
   \   000061   701B         JNZ     ??ZDO_beaconNotifyIndCB_5
   \   000063   8E82         MOV     DPL,R6
   \   000065   8F83         MOV     DPH,R7
   \   000067   A3           INC     DPTR
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F8           MOV     R0,A
   \   00006B   85..82       MOV     DPL,?V0 + 0
   \   00006E   85..83       MOV     DPH,?V0 + 1
   \   000071   A3           INC     DPTR
   \   000072   A3           INC     DPTR
   \   000073   A3           INC     DPTR
   \   000074   A3           INC     DPTR
   \   000075   E0           MOVX    A,@DPTR
   \   000076   68           XRL     A,R0
   \   000077   7005         JNZ     ??ZDO_beaconNotifyIndCB_5
   2201                {
   2202                  found = true;
   \   000079   75..01       MOV     ?V0 + 2,#0x1
   2203                  break;
   \   00007C   8015         SJMP    ??ZDO_beaconNotifyIndCB_3
   2204                }
   2205                pLastNwkDesc = pNwkDesc;
   \                     ??ZDO_beaconNotifyIndCB_5:
   \   00007E   8E..         MOV     ?V0 + 4,R6
   \   000080   8F..         MOV     ?V0 + 5,R7
   2206                pNwkDesc = pNwkDesc->nextDesc;
   \   000082   EE           MOV     A,R6
   \   000083   2414         ADD     A,#0x14
   \   000085   F582         MOV     DPL,A
   \   000087   EF           MOV     A,R7
   \   000088   3400         ADDC    A,#0x0
   \   00008A   F583         MOV     DPH,A
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   FE           MOV     R6,A
   \   00008E   A3           INC     DPTR
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   FF           MOV     R7,A
   \   000091   80B2         SJMP    ??ZDO_beaconNotifyIndCB_2
   2207              }
   2208          
   2209              // If no existing descriptor found, make a new one and add to the list
   2210              if (found == false)
   \                     ??ZDO_beaconNotifyIndCB_3:
   \   000093   E5..         MOV     A,?V0 + 2
   \   000095   706D         JNZ     ??ZDO_beaconNotifyIndCB_6
   2211              {
   2212                pNwkDesc = osal_mem_alloc( sizeof(networkDesc_t)  );
   \   000097                ; Setup parameters for call to function osal_mem_alloc
   \   000097   7A16         MOV     R2,#0x16
   \   000099   7B00         MOV     R3,#0x0
   \   00009B   12....       LCALL   ??osal_mem_alloc?relay
   \   00009E   8A..         MOV     ?V0 + 6,R2
   \   0000A0   8B..         MOV     ?V0 + 7,R3
   \   0000A2   AE..         MOV     R6,?V0 + 6
   \   0000A4   AF..         MOV     R7,?V0 + 7
   2213                if ( !pNwkDesc )
   \   0000A6   EE           MOV     A,R6
   \   0000A7   4F           ORL     A,R7
   \   0000A8   7003         JNZ     $+5
   \   0000AA   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2214                {
   2215                  // Memory alloc failed, discard this beacon
   2216                  return;
   2217                }
   2218          
   2219                // Clear the network descriptor
   2220                osal_memset( pNwkDesc, 0, sizeof(networkDesc_t)  );
   \   0000AD                ; Setup parameters for call to function osal_memset
   \   0000AD   7C16         MOV     R4,#0x16
   \   0000AF   7D00         MOV     R5,#0x0
   \   0000B1   7900         MOV     R1,#0x0
   \   0000B3   EE           MOV     A,R6
   \   0000B4   FA           MOV     R2,A
   \   0000B5   EF           MOV     A,R7
   \   0000B6   FB           MOV     R3,A
   \   0000B7   12....       LCALL   ??osal_memset?relay
   2221          
   2222                // Initialize the descriptor
   2223                pNwkDesc->chosenRouter = INVALID_NODE_ADDR;
   \   0000BA   8E82         MOV     DPL,R6
   \   0000BC   8F83         MOV     DPH,R7
   \   0000BE   A3           INC     DPTR
   \   0000BF   A3           INC     DPTR
   \   0000C0   A3           INC     DPTR
   \   0000C1   A3           INC     DPTR
   \   0000C2   A3           INC     DPTR
   \   0000C3   A3           INC     DPTR
   \   0000C4   A3           INC     DPTR
   \   0000C5   74FE         MOV     A,#-0x2
   \   0000C7   F0           MOVX    @DPTR,A
   \   0000C8   A3           INC     DPTR
   \   0000C9   74FF         MOV     A,#-0x1
   \   0000CB   F0           MOVX    @DPTR,A
   2224                pNwkDesc->chosenRouterDepth = 0xFF;
   \   0000CC   8E82         MOV     DPL,R6
   \   0000CE   8F83         MOV     DPH,R7
   \   0000D0   A3           INC     DPTR
   \   0000D1   A3           INC     DPTR
   \   0000D2   A3           INC     DPTR
   \   0000D3   A3           INC     DPTR
   \   0000D4   A3           INC     DPTR
   \   0000D5   A3           INC     DPTR
   \   0000D6   A3           INC     DPTR
   \   0000D7   A3           INC     DPTR
   \   0000D8   A3           INC     DPTR
   \   0000D9   A3           INC     DPTR
   \   0000DA   74FF         MOV     A,#-0x1
   \   0000DC   F0           MOVX    @DPTR,A
   2225          
   2226                // Save new entry into the descriptor list
   2227                if ( !NwkDescList )
   \   0000DD   90....       MOV     DPTR,#NwkDescList
   \   0000E0   E0           MOVX    A,@DPTR
   \   0000E1   F8           MOV     R0,A
   \   0000E2   A3           INC     DPTR
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   F9           MOV     R1,A
   \   0000E5   E8           MOV     A,R0
   \   0000E6   49           ORL     A,R1
   \   0000E7   700A         JNZ     ??ZDO_beaconNotifyIndCB_7
   2228                {
   2229                  NwkDescList = pNwkDesc;
   \   0000E9   90....       MOV     DPTR,#NwkDescList
   \   0000EC   EE           MOV     A,R6
   \   0000ED   F0           MOVX    @DPTR,A
   \   0000EE   A3           INC     DPTR
   \   0000EF   EF           MOV     A,R7
   \   0000F0   F0           MOVX    @DPTR,A
   \   0000F1   8011         SJMP    ??ZDO_beaconNotifyIndCB_6
   2230                }
   2231                else
   2232                {
   2233                  pLastNwkDesc->nextDesc = pNwkDesc;
   \                     ??ZDO_beaconNotifyIndCB_7:
   \   0000F3   E5..         MOV     A,?V0 + 4
   \   0000F5   2414         ADD     A,#0x14
   \   0000F7   F582         MOV     DPL,A
   \   0000F9   E5..         MOV     A,?V0 + 5
   \   0000FB   3400         ADDC    A,#0x0
   \   0000FD   F583         MOV     DPH,A
   \   0000FF   EE           MOV     A,R6
   \   000100   F0           MOVX    @DPTR,A
   \   000101   A3           INC     DPTR
   \   000102   EF           MOV     A,R7
   \   000103   F0           MOVX    @DPTR,A
   2234                }
   2235              }
   2236          
   2237              // Update the descriptor with the incoming beacon
   2238              pNwkDesc->stackProfile   = pBeacon->stackProfile;
   \                     ??ZDO_beaconNotifyIndCB_6:
   \   000104   85..82       MOV     DPL,?V0 + 0
   \   000107   85..83       MOV     DPH,?V0 + 1
   \   00010A   A3           INC     DPTR
   \   00010B   A3           INC     DPTR
   \   00010C   A3           INC     DPTR
   \   00010D   A3           INC     DPTR
   \   00010E   A3           INC     DPTR
   \   00010F   A3           INC     DPTR
   \   000110   A3           INC     DPTR
   \   000111   A3           INC     DPTR
   \   000112   A3           INC     DPTR
   \   000113   E0           MOVX    A,@DPTR
   \   000114   8E82         MOV     DPL,R6
   \   000116   8F83         MOV     DPH,R7
   \   000118   A3           INC     DPTR
   \   000119   A3           INC     DPTR
   \   00011A   A3           INC     DPTR
   \   00011B   A3           INC     DPTR
   \   00011C   A3           INC     DPTR
   \   00011D   A3           INC     DPTR
   \   00011E   F0           MOVX    @DPTR,A
   2239              pNwkDesc->version        = pBeacon->protocolVersion;
   \   00011F   85..82       MOV     DPL,?V0 + 0
   \   000122   85..83       MOV     DPH,?V0 + 1
   \   000125   A3           INC     DPTR
   \   000126   A3           INC     DPTR
   \   000127   A3           INC     DPTR
   \   000128   A3           INC     DPTR
   \   000129   A3           INC     DPTR
   \   00012A   A3           INC     DPTR
   \   00012B   A3           INC     DPTR
   \   00012C   A3           INC     DPTR
   \   00012D   E0           MOVX    A,@DPTR
   \   00012E   8E82         MOV     DPL,R6
   \   000130   8F83         MOV     DPH,R7
   \   000132   A3           INC     DPTR
   \   000133   A3           INC     DPTR
   \   000134   A3           INC     DPTR
   \   000135   A3           INC     DPTR
   \   000136   A3           INC     DPTR
   \   000137   F0           MOVX    @DPTR,A
   2240              pNwkDesc->logicalChannel = pBeacon->logicalChannel;
   \   000138   85..82       MOV     DPL,?V0 + 0
   \   00013B   85..83       MOV     DPH,?V0 + 1
   \   00013E   A3           INC     DPTR
   \   00013F   A3           INC     DPTR
   \   000140   A3           INC     DPTR
   \   000141   A3           INC     DPTR
   \   000142   E0           MOVX    A,@DPTR
   \   000143   8E82         MOV     DPL,R6
   \   000145   8F83         MOV     DPH,R7
   \   000147   A3           INC     DPTR
   \   000148   A3           INC     DPTR
   \   000149   F0           MOVX    @DPTR,A
   2241              pNwkDesc->panId          = pBeacon->panID;
   \   00014A   85..82       MOV     DPL,?V0 + 0
   \   00014D   85..83       MOV     DPH,?V0 + 1
   \   000150   A3           INC     DPTR
   \   000151   A3           INC     DPTR
   \   000152   E0           MOVX    A,@DPTR
   \   000153   F8           MOV     R0,A
   \   000154   A3           INC     DPTR
   \   000155   E0           MOVX    A,@DPTR
   \   000156   F9           MOV     R1,A
   \   000157   8E82         MOV     DPL,R6
   \   000159   8F83         MOV     DPH,R7
   \   00015B   E8           MOV     A,R0
   \   00015C   F0           MOVX    @DPTR,A
   \   00015D   A3           INC     DPTR
   \   00015E   E9           MOV     A,R1
   \   00015F   F0           MOVX    @DPTR,A
   2242              pNwkDesc->updateId       = pBeacon->updateID;
   \   000160   E5..         MOV     A,?V0 + 0
   \   000162   240C         ADD     A,#0xc
   \   000164   F582         MOV     DPL,A
   \   000166   E5..         MOV     A,?V0 + 1
   \   000168   3400         ADDC    A,#0x0
   \   00016A   F583         MOV     DPH,A
   \   00016C   E0           MOVX    A,@DPTR
   \   00016D   C0E0         PUSH    A
   \   00016F   EE           MOV     A,R6
   \   000170   2413         ADD     A,#0x13
   \   000172   F582         MOV     DPL,A
   \   000174   EF           MOV     A,R7
   \   000175   3400         ADDC    A,#0x0
   \   000177   F583         MOV     DPH,A
   \   000179   D0E0         POP     A
   \   00017B   F0           MOVX    @DPTR,A
   2243          
   2244              // Save the extended PAN ID from the beacon payload only if 1.1 version network
   2245              if ( pBeacon->protocolVersion != ZB_PROT_V1_0 )
   \   00017C   85..82       MOV     DPL,?V0 + 0
   \   00017F   85..83       MOV     DPH,?V0 + 1
   \   000182   A3           INC     DPTR
   \   000183   A3           INC     DPTR
   \   000184   A3           INC     DPTR
   \   000185   A3           INC     DPTR
   \   000186   A3           INC     DPTR
   \   000187   A3           INC     DPTR
   \   000188   A3           INC     DPTR
   \   000189   A3           INC     DPTR
   \   00018A   E0           MOVX    A,@DPTR
   \   00018B   6401         XRL     A,#0x1
   \   00018D   6017         JZ      ??ZDO_beaconNotifyIndCB_8
   2246              {
   2247                osal_cpyExtAddr( pNwkDesc->extendedPANID, pBeacon->extendedPanID );
   \   00018F                ; Setup parameters for call to function sAddrExtCpy
   \   00018F   E5..         MOV     A,?V0 + 0
   \   000191   240D         ADD     A,#0xd
   \   000193   FC           MOV     R4,A
   \   000194   E5..         MOV     A,?V0 + 1
   \   000196   3400         ADDC    A,#0x0
   \   000198   FD           MOV     R5,A
   \   000199   EE           MOV     A,R6
   \   00019A   240B         ADD     A,#0xb
   \   00019C   FA           MOV     R2,A
   \   00019D   EF           MOV     A,R7
   \   00019E   3400         ADDC    A,#0x0
   \   0001A0   FB           MOV     R3,A
   \   0001A1   12....       LCALL   ??sAddrExtCpy?relay
   \   0001A4   8011         SJMP    ??ZDO_beaconNotifyIndCB_9
   2248              }
   2249              else
   2250              {
   2251                osal_memset( pNwkDesc->extendedPANID, 0xFF, Z_EXTADDR_LEN );
   \                     ??ZDO_beaconNotifyIndCB_8:
   \   0001A6                ; Setup parameters for call to function osal_memset
   \   0001A6   7C08         MOV     R4,#0x8
   \   0001A8   7D00         MOV     R5,#0x0
   \   0001AA   79FF         MOV     R1,#-0x1
   \   0001AC   EE           MOV     A,R6
   \   0001AD   240B         ADD     A,#0xb
   \   0001AF   FA           MOV     R2,A
   \   0001B0   EF           MOV     A,R7
   \   0001B1   3400         ADDC    A,#0x0
   \   0001B3   FB           MOV     R3,A
   \   0001B4   12....       LCALL   ??osal_memset?relay
   2252              }
   2253          
   2254              // check if this device is a better choice to join...
   2255              // ...dont bother checking assocPermit flag is doing a rejoin
   2256              if ( ( pBeacon->LQI > gMIN_TREE_LINK_COST ) &&
   2257                  ( ( pBeacon->permitJoining == TRUE ) || ( _tmpRejoinState ) ) )
   \                     ??ZDO_beaconNotifyIndCB_9:
   \   0001B7   85..82       MOV     DPL,?V0 + 0
   \   0001BA   85..83       MOV     DPH,?V0 + 1
   \   0001BD   A3           INC     DPTR
   \   0001BE   A3           INC     DPTR
   \   0001BF   A3           INC     DPTR
   \   0001C0   A3           INC     DPTR
   \   0001C1   A3           INC     DPTR
   \   0001C2   A3           INC     DPTR
   \   0001C3   A3           INC     DPTR
   \   0001C4   A3           INC     DPTR
   \   0001C5   A3           INC     DPTR
   \   0001C6   A3           INC     DPTR
   \   0001C7   E0           MOVX    A,@DPTR
   \   0001C8   F8           MOV     R0,A
   \   0001C9   90....       MOV     DPTR,#gMIN_TREE_LINK_COST
   \   0001CC   E0           MOVX    A,@DPTR
   \   0001CD   C3           CLR     C
   \   0001CE   98           SUBB    A,R0
   \   0001CF   4003         JC      $+5
   \   0001D1   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   \   0001D4   85..82       MOV     DPL,?V0 + 0
   \   0001D7   85..83       MOV     DPH,?V0 + 1
   \   0001DA   A3           INC     DPTR
   \   0001DB   A3           INC     DPTR
   \   0001DC   A3           INC     DPTR
   \   0001DD   A3           INC     DPTR
   \   0001DE   A3           INC     DPTR
   \   0001DF   E0           MOVX    A,@DPTR
   \   0001E0   6401         XRL     A,#0x1
   \   0001E2   6009         JZ      ??ZDO_beaconNotifyIndCB_10
   \   0001E4   90....       MOV     DPTR,#_tmpRejoinState
   \   0001E7   E0           MOVX    A,@DPTR
   \   0001E8   7003         JNZ     $+5
   \   0001EA   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2258              {
   2259                uint8 selected = FALSE;
   \                     ??ZDO_beaconNotifyIndCB_10:
   \   0001ED   7A00         MOV     R2,#0x0
   2260                uint8 capacity = FALSE;
   \   0001EF   7B00         MOV     R3,#0x0
   2261          
   2262                if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   \   0001F1   90....       MOV     DPTR,#_NIB + 96
   \   0001F4   E0           MOVX    A,@DPTR
   \   0001F5   6402         XRL     A,#0x2
   \   0001F7   707E         JNZ     ??ZDO_beaconNotifyIndCB_11
   2263                {
   2264                  if ( ((pBeacon->LQI   > pNwkDesc->chosenRouterLinkQuality) &&
   2265                        (pBeacon->depth < MAX_NODE_DEPTH)) ||
   2266                      ((pBeacon->LQI   == pNwkDesc->chosenRouterLinkQuality) &&
   2267                       (pBeacon->depth < pNwkDesc->chosenRouterDepth)) )
   \   0001F9   85..82       MOV     DPL,?V0 + 0
   \   0001FC   85..83       MOV     DPH,?V0 + 1
   \   0001FF   A3           INC     DPTR
   \   000200   A3           INC     DPTR
   \   000201   A3           INC     DPTR
   \   000202   A3           INC     DPTR
   \   000203   A3           INC     DPTR
   \   000204   A3           INC     DPTR
   \   000205   A3           INC     DPTR
   \   000206   A3           INC     DPTR
   \   000207   A3           INC     DPTR
   \   000208   A3           INC     DPTR
   \   000209   E0           MOVX    A,@DPTR
   \   00020A   F8           MOV     R0,A
   \   00020B   8E82         MOV     DPL,R6
   \   00020D   8F83         MOV     DPH,R7
   \   00020F   A3           INC     DPTR
   \   000210   A3           INC     DPTR
   \   000211   A3           INC     DPTR
   \   000212   A3           INC     DPTR
   \   000213   A3           INC     DPTR
   \   000214   A3           INC     DPTR
   \   000215   A3           INC     DPTR
   \   000216   A3           INC     DPTR
   \   000217   A3           INC     DPTR
   \   000218   E0           MOVX    A,@DPTR
   \   000219   C3           CLR     C
   \   00021A   98           SUBB    A,R0
   \   00021B   5012         JNC     ??ZDO_beaconNotifyIndCB_12
   \   00021D   E5..         MOV     A,?V0 + 0
   \   00021F   240B         ADD     A,#0xb
   \   000221   F582         MOV     DPL,A
   \   000223   E5..         MOV     A,?V0 + 1
   \   000225   3400         ADDC    A,#0x0
   \   000227   F583         MOV     DPH,A
   \   000229   E0           MOVX    A,@DPTR
   \   00022A   C3           CLR     C
   \   00022B   9414         SUBB    A,#0x14
   \   00022D   4044         JC      ??ZDO_beaconNotifyIndCB_13
   \                     ??ZDO_beaconNotifyIndCB_12:
   \   00022F   85..82       MOV     DPL,?V0 + 0
   \   000232   85..83       MOV     DPH,?V0 + 1
   \   000235   A3           INC     DPTR
   \   000236   A3           INC     DPTR
   \   000237   A3           INC     DPTR
   \   000238   A3           INC     DPTR
   \   000239   A3           INC     DPTR
   \   00023A   A3           INC     DPTR
   \   00023B   A3           INC     DPTR
   \   00023C   A3           INC     DPTR
   \   00023D   A3           INC     DPTR
   \   00023E   A3           INC     DPTR
   \   00023F   E0           MOVX    A,@DPTR
   \   000240   F8           MOV     R0,A
   \   000241   8E82         MOV     DPL,R6
   \   000243   8F83         MOV     DPH,R7
   \   000245   A3           INC     DPTR
   \   000246   A3           INC     DPTR
   \   000247   A3           INC     DPTR
   \   000248   A3           INC     DPTR
   \   000249   A3           INC     DPTR
   \   00024A   A3           INC     DPTR
   \   00024B   A3           INC     DPTR
   \   00024C   A3           INC     DPTR
   \   00024D   A3           INC     DPTR
   \   00024E   E0           MOVX    A,@DPTR
   \   00024F   68           XRL     A,R0
   \   000250   7048         JNZ     ??ZDO_beaconNotifyIndCB_14
   \   000252   8E82         MOV     DPL,R6
   \   000254   8F83         MOV     DPH,R7
   \   000256   A3           INC     DPTR
   \   000257   A3           INC     DPTR
   \   000258   A3           INC     DPTR
   \   000259   A3           INC     DPTR
   \   00025A   A3           INC     DPTR
   \   00025B   A3           INC     DPTR
   \   00025C   A3           INC     DPTR
   \   00025D   A3           INC     DPTR
   \   00025E   A3           INC     DPTR
   \   00025F   A3           INC     DPTR
   \   000260   E0           MOVX    A,@DPTR
   \   000261   F8           MOV     R0,A
   \   000262   E5..         MOV     A,?V0 + 0
   \   000264   240B         ADD     A,#0xb
   \   000266   F582         MOV     DPL,A
   \   000268   E5..         MOV     A,?V0 + 1
   \   00026A   3400         ADDC    A,#0x0
   \   00026C   F583         MOV     DPH,A
   \   00026E   E0           MOVX    A,@DPTR
   \   00026F   C3           CLR     C
   \   000270   98           SUBB    A,R0
   \   000271   5027         JNC     ??ZDO_beaconNotifyIndCB_14
   2268                  {
   2269                    selected = TRUE;
   \                     ??ZDO_beaconNotifyIndCB_13:
   \   000273   7A01         MOV     R2,#0x1
   \   000275   8023         SJMP    ??ZDO_beaconNotifyIndCB_14
   2270                  }
   2271                }
   2272                else
   2273                {
   2274                  if ( pBeacon->depth < pNwkDesc->chosenRouterDepth )
   \                     ??ZDO_beaconNotifyIndCB_11:
   \   000277   8E82         MOV     DPL,R6
   \   000279   8F83         MOV     DPH,R7
   \   00027B   A3           INC     DPTR
   \   00027C   A3           INC     DPTR
   \   00027D   A3           INC     DPTR
   \   00027E   A3           INC     DPTR
   \   00027F   A3           INC     DPTR
   \   000280   A3           INC     DPTR
   \   000281   A3           INC     DPTR
   \   000282   A3           INC     DPTR
   \   000283   A3           INC     DPTR
   \   000284   A3           INC     DPTR
   \   000285   E0           MOVX    A,@DPTR
   \   000286   F8           MOV     R0,A
   \   000287   E5..         MOV     A,?V0 + 0
   \   000289   240B         ADD     A,#0xb
   \   00028B   F582         MOV     DPL,A
   \   00028D   E5..         MOV     A,?V0 + 1
   \   00028F   3400         ADDC    A,#0x0
   \   000291   F583         MOV     DPH,A
   \   000293   E0           MOVX    A,@DPTR
   \   000294   C3           CLR     C
   \   000295   98           SUBB    A,R0
   \   000296   5002         JNC     ??ZDO_beaconNotifyIndCB_14
   2275                  {
   2276                    selected = TRUE;
   \   000298   7A01         MOV     R2,#0x1
   2277                  }
   2278                }
   2279          
   2280                if ( ZSTACK_ROUTER_BUILD )
   2281                {
   2282                  capacity = pBeacon->routerCapacity;
   2283                }
   2284                else if ( ZSTACK_END_DEVICE_BUILD )
   2285                {
   2286                  capacity = pBeacon->deviceCapacity;
   \                     ??ZDO_beaconNotifyIndCB_14:
   \   00029A   85..82       MOV     DPL,?V0 + 0
   \   00029D   85..83       MOV     DPH,?V0 + 1
   \   0002A0   A3           INC     DPTR
   \   0002A1   A3           INC     DPTR
   \   0002A2   A3           INC     DPTR
   \   0002A3   A3           INC     DPTR
   \   0002A4   A3           INC     DPTR
   \   0002A5   A3           INC     DPTR
   \   0002A6   A3           INC     DPTR
   \   0002A7   E0           MOVX    A,@DPTR
   \   0002A8   FB           MOV     R3,A
   2287                }
   2288          
   2289                if ( (capacity) && (selected) )
   \   0002A9   6059         JZ      ??ZDO_beaconNotifyIndCB_15
   \   0002AB   EA           MOV     A,R2
   \   0002AC   6056         JZ      ??ZDO_beaconNotifyIndCB_15
   2290                {
   2291                  // this is the new chosen router for joining...
   2292                  pNwkDesc->chosenRouter            = pBeacon->sourceAddr;
   \   0002AE   85..82       MOV     DPL,?V0 + 0
   \   0002B1   85..83       MOV     DPH,?V0 + 1
   \   0002B4   E0           MOVX    A,@DPTR
   \   0002B5   F8           MOV     R0,A
   \   0002B6   A3           INC     DPTR
   \   0002B7   E0           MOVX    A,@DPTR
   \   0002B8   F9           MOV     R1,A
   \   0002B9   8E82         MOV     DPL,R6
   \   0002BB   8F83         MOV     DPH,R7
   \   0002BD   A3           INC     DPTR
   \   0002BE   A3           INC     DPTR
   \   0002BF   A3           INC     DPTR
   \   0002C0   A3           INC     DPTR
   \   0002C1   A3           INC     DPTR
   \   0002C2   A3           INC     DPTR
   \   0002C3   A3           INC     DPTR
   \   0002C4   E8           MOV     A,R0
   \   0002C5   F0           MOVX    @DPTR,A
   \   0002C6   A3           INC     DPTR
   \   0002C7   E9           MOV     A,R1
   \   0002C8   F0           MOVX    @DPTR,A
   2293                  pNwkDesc->chosenRouterLinkQuality = pBeacon->LQI;
   \   0002C9   85..82       MOV     DPL,?V0 + 0
   \   0002CC   85..83       MOV     DPH,?V0 + 1
   \   0002CF   A3           INC     DPTR
   \   0002D0   A3           INC     DPTR
   \   0002D1   A3           INC     DPTR
   \   0002D2   A3           INC     DPTR
   \   0002D3   A3           INC     DPTR
   \   0002D4   A3           INC     DPTR
   \   0002D5   A3           INC     DPTR
   \   0002D6   A3           INC     DPTR
   \   0002D7   A3           INC     DPTR
   \   0002D8   A3           INC     DPTR
   \   0002D9   E0           MOVX    A,@DPTR
   \   0002DA   8E82         MOV     DPL,R6
   \   0002DC   8F83         MOV     DPH,R7
   \   0002DE   A3           INC     DPTR
   \   0002DF   A3           INC     DPTR
   \   0002E0   A3           INC     DPTR
   \   0002E1   A3           INC     DPTR
   \   0002E2   A3           INC     DPTR
   \   0002E3   A3           INC     DPTR
   \   0002E4   A3           INC     DPTR
   \   0002E5   A3           INC     DPTR
   \   0002E6   A3           INC     DPTR
   \   0002E7   F0           MOVX    @DPTR,A
   2294                  pNwkDesc->chosenRouterDepth       = pBeacon->depth;
   \   0002E8   E5..         MOV     A,?V0 + 0
   \   0002EA   240B         ADD     A,#0xb
   \   0002EC   F582         MOV     DPL,A
   \   0002EE   E5..         MOV     A,?V0 + 1
   \   0002F0   3400         ADDC    A,#0x0
   \   0002F2   F583         MOV     DPH,A
   \   0002F4   E0           MOVX    A,@DPTR
   \   0002F5   8E82         MOV     DPL,R6
   \   0002F7   8F83         MOV     DPH,R7
   \   0002F9   A3           INC     DPTR
   \   0002FA   A3           INC     DPTR
   \   0002FB   A3           INC     DPTR
   \   0002FC   A3           INC     DPTR
   \   0002FD   A3           INC     DPTR
   \   0002FE   A3           INC     DPTR
   \   0002FF   A3           INC     DPTR
   \   000300   A3           INC     DPTR
   \   000301   A3           INC     DPTR
   \   000302   A3           INC     DPTR
   \   000303   F0           MOVX    @DPTR,A
   2295                }
   2296          
   2297                if ( pBeacon->deviceCapacity )
   \                     ??ZDO_beaconNotifyIndCB_15:
   \   000304   85..82       MOV     DPL,?V0 + 0
   \   000307   85..83       MOV     DPH,?V0 + 1
   \   00030A   A3           INC     DPTR
   \   00030B   A3           INC     DPTR
   \   00030C   A3           INC     DPTR
   \   00030D   A3           INC     DPTR
   \   00030E   A3           INC     DPTR
   \   00030F   A3           INC     DPTR
   \   000310   A3           INC     DPTR
   \   000311   E0           MOVX    A,@DPTR
   \   000312   600B         JZ      ??ZDO_beaconNotifyIndCB_16
   2298                  pNwkDesc->deviceCapacity = 1;
   \   000314   8E82         MOV     DPL,R6
   \   000316   8F83         MOV     DPH,R7
   \   000318   A3           INC     DPTR
   \   000319   A3           INC     DPTR
   \   00031A   A3           INC     DPTR
   \   00031B   A3           INC     DPTR
   \   00031C   7401         MOV     A,#0x1
   \   00031E   F0           MOVX    @DPTR,A
   2299          
   2300                if ( pBeacon->routerCapacity )
   \                     ??ZDO_beaconNotifyIndCB_16:
   \   00031F   85..82       MOV     DPL,?V0 + 0
   \   000322   85..83       MOV     DPH,?V0 + 1
   \   000325   A3           INC     DPTR
   \   000326   A3           INC     DPTR
   \   000327   A3           INC     DPTR
   \   000328   A3           INC     DPTR
   \   000329   A3           INC     DPTR
   \   00032A   A3           INC     DPTR
   \   00032B   E0           MOVX    A,@DPTR
   \   00032C   600A         JZ      ??ZDO_beaconNotifyIndCB_1
   2301                  pNwkDesc->routerCapacity = 1;
   \   00032E   8E82         MOV     DPL,R6
   \   000330   8F83         MOV     DPH,R7
   \   000332   A3           INC     DPTR
   \   000333   A3           INC     DPTR
   \   000334   A3           INC     DPTR
   \   000335   7401         MOV     A,#0x1
   \   000337   F0           MOVX    @DPTR,A
   2302              }
   2303            }
   2304          }
   \                     ??ZDO_beaconNotifyIndCB_1:
   \   000338   7F08         MOV     R7,#0x8
   \   00033A   02....       LJMP    ?BANKED_LEAVE_XDATA
   2305          
   2306          /*********************************************************************
   2307           * @fn          ZDO_StartRouterConfirmCB
   2308           *
   2309           * @brief       This function reports the results of the request to
   2310           *              start functioning as a router in a network.
   2311           *
   2312           * @param       Status - Result of NLME_StartRouterRequest()
   2313           *
   2314           * @return      none
   2315           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2316          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   2317          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2318            nwkStatus = (byte)Status;
   \   000007   EE           MOV     A,R6
   \   000008   90....       MOV     DPTR,#nwkStatus
   \   00000B   F0           MOVX    @DPTR,A
   2319          
   2320            if ( Status == ZSUCCESS )
   \   00000C   EE           MOV     A,R6
   \   00000D   701C         JNZ     ??ZDO_StartRouterConfirmCB_0
   2321            {
   2322              // LED on shows Router started
   2323              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000F                ; Setup parameters for call to function HalLedSet
   \   00000F   7A01         MOV     R2,#0x1
   \   000011   7904         MOV     R1,#0x4
   \   000013   12....       LCALL   ??HalLedSet?relay
   \   000016   E9           MOV     A,R1
   2324              // LED off forgets HOLD_AUTO_START
   2325              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   \   000017                ; Setup parameters for call to function HalLedSet
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7908         MOV     R1,#0x8
   \   00001B   12....       LCALL   ??HalLedSet?relay
   \   00001E   E9           MOV     A,R1
   2326              if ( devState == DEV_HOLD )
   \   00001F   90....       MOV     DPTR,#devState
   \   000022   E0           MOVX    A,@DPTR
   \   000023   7006         JNZ     ??ZDO_StartRouterConfirmCB_0
   2327              {
   2328                // Began with HOLD_AUTO_START
   2329                devState = DEV_END_DEVICE;
   \   000025   90....       MOV     DPTR,#devState
   \   000028   7406         MOV     A,#0x6
   \   00002A   F0           MOVX    @DPTR,A
   2330              }
   2331            }
   2332          #if defined(BLINK_LEDS)
   2333            else
   2334            {
   2335              HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   2336            }
   2337          #endif
   2338          
   2339            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   00002B                ; Setup parameters for call to function osal_set_event
   \   00002B   7A20         MOV     R2,#0x20
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   90....       MOV     DPTR,#ZDAppTaskID
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F9           MOV     R1,A
   \   000034   12....       LCALL   ??osal_set_event?relay
   \   000037   E9           MOV     A,R1
   2340          }
   \   000038   7F01         MOV     R7,#0x1
   \   00003A   02....       LJMP    ?BANKED_LEAVE_XDATA
   2341          
   2342          /*********************************************************************
   2343           * @fn          ZDO_JoinConfirmCB
   2344           *
   2345           * @brief       This function allows the next hight layer to be notified
   2346           *              of the results of its request to join itself or another
   2347           *              device to a network.
   2348           *
   2349           * @param       Status - Result of NLME_JoinRequest()
   2350           *
   2351           * @return      none
   2352           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2353          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   2354          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   \   00000E   89..         MOV     ?V0 + 0,R1
   2355            (void)PanId;  // remove if this parameter is used.
   2356          
   2357            nwkStatus = (byte)Status;
   \   000010   E5..         MOV     A,?V0 + 0
   \   000012   90....       MOV     DPTR,#nwkStatus
   \   000015   F0           MOVX    @DPTR,A
   2358          
   2359            if ( Status == ZSUCCESS )
   \   000016   E5..         MOV     A,?V0 + 0
   \   000018   701F         JNZ     ??ZDO_JoinConfirmCB_0
   2360            {
   2361              // LED on shows device joined
   2362              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00001A                ; Setup parameters for call to function HalLedSet
   \   00001A   7A01         MOV     R2,#0x1
   \   00001C   7904         MOV     R1,#0x4
   \   00001E   12....       LCALL   ??HalLedSet?relay
   \   000021   E9           MOV     A,R1
   2363              // LED off forgets HOLD_AUTO_START
   2364              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   \   000022                ; Setup parameters for call to function HalLedSet
   \   000022   7A00         MOV     R2,#0x0
   \   000024   7908         MOV     R1,#0x8
   \   000026   12....       LCALL   ??HalLedSet?relay
   \   000029   E9           MOV     A,R1
   2365              if ( (devState == DEV_HOLD) )
   \   00002A   90....       MOV     DPTR,#devState
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   7006         JNZ     ??ZDO_JoinConfirmCB_1
   2366              {
   2367                // Began with HOLD_AUTO_START
   2368                devState = DEV_NWK_JOINING;
   \   000030   90....       MOV     DPTR,#devState
   \   000033   7403         MOV     A,#0x3
   \   000035   F0           MOVX    @DPTR,A
   2369              }
   2370          
   2371              if ( !ZG_SECURE_ENABLED )
   2372              {
   2373                // Notify to save info into NV
   2374                ZDApp_NVUpdate();
   \                     ??ZDO_JoinConfirmCB_1:
   \   000036                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000036   12....       LCALL   ??ZDApp_NVUpdate?relay
   2375              }
   2376            }
   2377            else
   2378            {
   2379          #if defined(BLINK_LEDS)
   2380              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   2381          #endif
   2382            }
   2383          
   2384            // Pass the join confirm to higher layer if callback registered
   2385            if (zdoCBFunc[ZDO_JOIN_CNF_CBID] != NULL )
   \                     ??ZDO_JoinConfirmCB_0:
   \   000039   90....       MOV     DPTR,#zdoCBFunc + 8
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   F8           MOV     R0,A
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   F9           MOV     R1,A
   \   000041   E8           MOV     A,R0
   \   000042   49           ORL     A,R1
   \   000043   6047         JZ      ??ZDO_JoinConfirmCB_2
   2386            {
   2387              zdoJoinCnf_t joinCnf;
   2388          
   2389              joinCnf.status = Status;
   \   000045   E5..         MOV     A,?V0 + 0
   \   000047   85..82       MOV     DPL,?XSP + 0
   \   00004A   85..83       MOV     DPH,?XSP + 1
   \   00004D   E5..         MOV     A,?V0 + 0
   \   00004F   F0           MOVX    @DPTR,A
   2390              joinCnf.deviceAddr = _NIB.nwkDevAddress;
   \   000050   90....       MOV     DPTR,#_NIB + 20
   \   000053   E0           MOVX    A,@DPTR
   \   000054   F8           MOV     R0,A
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F9           MOV     R1,A
   \   000058   7401         MOV     A,#0x1
   \   00005A   12....       LCALL   ?XSTACK_DISP0_8
   \   00005D   E8           MOV     A,R0
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   A3           INC     DPTR
   \   000060   E9           MOV     A,R1
   \   000061   F0           MOVX    @DPTR,A
   2391              joinCnf.parentAddr = _NIB.nwkCoordAddress;
   \   000062   90....       MOV     DPTR,#_NIB + 23
   \   000065   E0           MOVX    A,@DPTR
   \   000066   F8           MOV     R0,A
   \   000067   A3           INC     DPTR
   \   000068   E0           MOVX    A,@DPTR
   \   000069   F9           MOV     R1,A
   \   00006A   7403         MOV     A,#0x3
   \   00006C   12....       LCALL   ?XSTACK_DISP0_8
   \   00006F   E8           MOV     A,R0
   \   000070   F0           MOVX    @DPTR,A
   \   000071   A3           INC     DPTR
   \   000072   E9           MOV     A,R1
   \   000073   F0           MOVX    @DPTR,A
   2392          
   2393              zdoCBFunc[ZDO_JOIN_CNF_CBID]( (void*)&joinCnf );
   \   000074                ; Setup parameters for indirect call
   \   000074   85..82       MOV     DPL,?XSP + 0
   \   000077   85..83       MOV     DPH,?XSP + 1
   \   00007A   AA82         MOV     R2,DPL
   \   00007C   AB83         MOV     R3,DPH
   \   00007E   90....       MOV     DPTR,#zdoCBFunc + 8
   \   000081   E0           MOVX    A,@DPTR
   \   000082   F8           MOV     R0,A
   \   000083   A3           INC     DPTR
   \   000084   E0           MOVX    A,@DPTR
   \   000085   F583         MOV     DPH,A
   \   000087   8882         MOV     DPL,R0
   \   000089   12....       LCALL   ?CALL_IND
   2394            }
   2395          
   2396            // Notify ZDApp
   2397            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_2:
   \   00008C                ; Setup parameters for call to function ZDApp_SendMsg
   \   00008C   7C00         MOV     R4,#0x0
   \   00008E   7D00         MOV     R5,#0x0
   \   000090   7B02         MOV     R3,#0x2
   \   000092   7A02         MOV     R2,#0x2
   \   000094   90....       MOV     DPTR,#ZDAppTaskID
   \   000097   E0           MOVX    A,@DPTR
   \   000098   F9           MOV     R1,A
   \   000099   12....       LCALL   ??ZDApp_SendMsg?relay
   2398          
   2399          }
   \   00009C   7405         MOV     A,#0x5
   \   00009E   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000A1   7F01         MOV     R7,#0x1
   \   0000A3   02....       LJMP    ?BANKED_LEAVE_XDATA
   2400          
   2401          /*********************************************************************
   2402           * @fn          ZDO_AddrChangeIndicationCB
   2403           *
   2404           * @brief       This function notifies the application that this
   2405           *              device's address has changed.  Could happen in
   2406           *              a network with stochastic addressing (PRO).
   2407           *
   2408           * @param       newAddr - the new address
   2409           *
   2410           * @return      none
   2411           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2412          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   2413          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 2,R2
   \   000007   8B..         MOV     ?V0 + 3,R3
   2414            ZDO_AddrChangeInd_t *pZDOAddrChangeMsg;
   2415            epList_t *pItem = epList;
   \   000009   90....       MOV     DPTR,#epList
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F5..         MOV     ?V0 + 0,A
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 1,A
   2416          
   2417            // Notify to save info into NV
   2418            ZDApp_NVUpdate();
   \   000013                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000013   12....       LCALL   ??ZDApp_NVUpdate?relay
   2419          
   2420            // Notify the applications
   2421            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000016                ; Setup parameters for call to function osal_set_event
   \   000016   7A10         MOV     R2,#0x10
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   90....       MOV     DPTR,#ZDAppTaskID
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F9           MOV     R1,A
   \   00001F   12....       LCALL   ??osal_set_event?relay
   \   000022   E9           MOV     A,R1
   2422          
   2423            while (pItem != NULL)
   \                     ??ZDO_AddrChangeIndicationCB_0:
   \   000023   E5..         MOV     A,?V0 + 0
   \   000025   45..         ORL     A,?V0 + 1
   \   000027   606C         JZ      ??ZDO_AddrChangeIndicationCB_1
   2424            {
   2425              if (pItem->epDesc->endPoint != ZDO_EP)
   \   000029   85..82       MOV     DPL,?V0 + 0
   \   00002C   85..83       MOV     DPH,?V0 + 1
   \   00002F   A3           INC     DPTR
   \   000030   A3           INC     DPTR
   \   000031   E0           MOVX    A,@DPTR
   \   000032   F8           MOV     R0,A
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F583         MOV     DPH,A
   \   000037   8882         MOV     DPL,R0
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   604A         JZ      ??ZDO_AddrChangeIndicationCB_2
   2426              {
   2427                pZDOAddrChangeMsg = (ZDO_AddrChangeInd_t *)osal_msg_allocate( sizeof( ZDO_AddrChangeInd_t ) );
   \   00003C                ; Setup parameters for call to function osal_msg_allocate
   \   00003C   7A04         MOV     R2,#0x4
   \   00003E   7B00         MOV     R3,#0x0
   \   000040   12....       LCALL   ??osal_msg_allocate?relay
   \   000043   8A..         MOV     ?V0 + 4,R2
   \   000045   8B..         MOV     ?V0 + 5,R3
   \   000047   AE..         MOV     R6,?V0 + 4
   \   000049   AF..         MOV     R7,?V0 + 5
   2428                if (pZDOAddrChangeMsg != NULL)
   \   00004B   EE           MOV     A,R6
   \   00004C   4F           ORL     A,R7
   \   00004D   6037         JZ      ??ZDO_AddrChangeIndicationCB_2
   2429                {
   2430                  pZDOAddrChangeMsg->hdr.event = ZDO_ADDR_CHANGE_IND;
   \   00004F   8E82         MOV     DPL,R6
   \   000051   8F83         MOV     DPH,R7
   \   000053   74D6         MOV     A,#-0x2a
   \   000055   F0           MOVX    @DPTR,A
   2431                  pZDOAddrChangeMsg->shortAddr = newAddr;
   \   000056   8E82         MOV     DPL,R6
   \   000058   8F83         MOV     DPH,R7
   \   00005A   A3           INC     DPTR
   \   00005B   A3           INC     DPTR
   \   00005C   E5..         MOV     A,?V0 + 2
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   A3           INC     DPTR
   \   000060   E5..         MOV     A,?V0 + 3
   \   000062   F0           MOVX    @DPTR,A
   2432                  osal_msg_send( *(pItem->epDesc->task_id), (uint8 *)pZDOAddrChangeMsg );
   \   000063                ; Setup parameters for call to function osal_msg_send
   \   000063   EE           MOV     A,R6
   \   000064   FA           MOV     R2,A
   \   000065   EF           MOV     A,R7
   \   000066   FB           MOV     R3,A
   \   000067   85..82       MOV     DPL,?V0 + 0
   \   00006A   85..83       MOV     DPH,?V0 + 1
   \   00006D   A3           INC     DPTR
   \   00006E   A3           INC     DPTR
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F8           MOV     R0,A
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F583         MOV     DPH,A
   \   000075   8882         MOV     DPL,R0
   \   000077   A3           INC     DPTR
   \   000078   E0           MOVX    A,@DPTR
   \   000079   F8           MOV     R0,A
   \   00007A   A3           INC     DPTR
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   F583         MOV     DPH,A
   \   00007E   8882         MOV     DPL,R0
   \   000080   E0           MOVX    A,@DPTR
   \   000081   F9           MOV     R1,A
   \   000082   12....       LCALL   ??osal_msg_send?relay
   \   000085   E9           MOV     A,R1
   2433                }
   2434              }
   2435              pItem = pItem->nextDesc;
   \                     ??ZDO_AddrChangeIndicationCB_2:
   \   000086   85..82       MOV     DPL,?V0 + 0
   \   000089   85..83       MOV     DPH,?V0 + 1
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   F5..         MOV     ?V0 + 0,A
   \   00008F   A3           INC     DPTR
   \   000090   E0           MOVX    A,@DPTR
   \   000091   F5..         MOV     ?V0 + 1,A
   \   000093   808E         SJMP    ??ZDO_AddrChangeIndicationCB_0
   2436            }
   2437          
   2438            // Send out a device announce
   2439            ZDApp_AnnounceNewAddress();
   \                     ??ZDO_AddrChangeIndicationCB_1:
   \   000095                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000095   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   2440          }
   \   000098   7F06         MOV     R7,#0x6
   \   00009A   02....       LJMP    ?BANKED_LEAVE_XDATA
   2441          
   2442          /*********************************************************************
   2443           * @fn          ZDO_JoinIndicationCB
   2444           *
   2445           * @brief       This function allows the next higher layer of a
   2446           *              coordinator to be notified of a remote join request.
   2447           *
   2448           * @param       ShortAddress - 16-bit address
   2449           * @param       ExtendedAddress - IEEE (64-bit) address
   2450           * @param       CapabilityFlags - Association Capability Flags
   2451           * @param       type - of joining -
   2452           *                          NWK_ASSOC_JOIN
   2453           *                          NWK_ASSOC_REJOIN_UNSECURE
   2454           *                          NWK_ASSOC_REJOIN_SECURE
   2455           *
   2456           * @return      ZStatus_t
   2457           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2458          ZStatus_t ZDO_JoinIndicationCB(uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   2459                                          uint8 CapabilityFlags, uint8 type)
   2460          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
   \   00000D   89..         MOV     ?V0 + 2,R1
   \   00000F   740C         MOV     A,#0xc
   \   000011   12....       LCALL   ?XSTACK_DISP0_8
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 3,A
   2461            (void)ShortAddress;
   2462            (void)ExtendedAddress;
   2463          #if ZDO_NV_SAVE_RFDs
   2464            (void)CapabilityFlags;
   2465          
   2466          #else  // if !ZDO_NV_SAVE_RFDs
   2467            if (CapabilityFlags & CAPINFO_DEVICETYPE_FFD)
   2468          #endif
   2469            {
   2470              ZDApp_NVUpdate();  // Notify to save info into NV.
   \   000017                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000017   12....       LCALL   ??ZDApp_NVUpdate?relay
   2471            }
   2472          
   2473            if (ZG_SECURE_ENABLED)  // Send notification to TC of new device.
   2474            {
   2475              if (type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE)
   2476              {
   2477                osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   2478              }
   2479            }
   2480          
   2481            return ZSuccess;
   \   00001A   7900         MOV     R1,#0x0
   \   00001C   7F04         MOV     R7,#0x4
   \   00001E   02....       LJMP    ?BANKED_LEAVE_XDATA
   2482          }
   2483          
   2484          /*********************************************************************
   2485           * @fn          ZDO_ConcentratorIndicationCB
   2486           *
   2487           * @brief       This function allows the next higher layer of a
   2488           *              device to be notified of existence of the concentrator.
   2489           *
   2490           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2491           * @param       extAddr - pointer to extended Address
   2492           *                        NULL if not available
   2493           * @param       pktCost - PktCost from RREQ
   2494           *
   2495           * @return      void
   2496           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2497          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr, uint8 *extAddr, uint8 pktCost )
   \                     ZDO_ConcentratorIndicationCB:
   2498          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EC           MOV     A,R4
   \   00000F   FE           MOV     R6,A
   \   000010   ED           MOV     A,R5
   \   000011   FF           MOV     R7,A
   \   000012   89..         MOV     ?V0 + 2,R1
   2499            zdoConcentratorInd_t conInd;
   2500          
   2501            conInd.nwkAddr = nwkAddr;
   \   000014   85..82       MOV     DPL,?XSP + 0
   \   000017   85..83       MOV     DPH,?XSP + 1
   \   00001A   E5..         MOV     A,?V0 + 0
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   E5..         MOV     A,?V0 + 1
   \   000020   F0           MOVX    @DPTR,A
   2502            conInd.extAddr = extAddr;
   \   000021   7402         MOV     A,#0x2
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   EE           MOV     A,R6
   \   000027   F0           MOVX    @DPTR,A
   \   000028   A3           INC     DPTR
   \   000029   EF           MOV     A,R7
   \   00002A   F0           MOVX    @DPTR,A
   2503            conInd.pktCost = pktCost;
   \   00002B   E5..         MOV     A,?V0 + 2
   \   00002D   7404         MOV     A,#0x4
   \   00002F   12....       LCALL   ?XSTACK_DISP0_8
   \   000032   E5..         MOV     A,?V0 + 2
   \   000034   F0           MOVX    @DPTR,A
   2504          
   2505            if( zdoCBFunc[ZDO_CONCENTRATOR_IND_CBID] != NULL )
   \   000035   90....       MOV     DPTR,#zdoCBFunc + 2
   \   000038   E0           MOVX    A,@DPTR
   \   000039   F8           MOV     R0,A
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   F9           MOV     R1,A
   \   00003D   E8           MOV     A,R0
   \   00003E   49           ORL     A,R1
   \   00003F   6018         JZ      ??ZDO_ConcentratorIndicationCB_0
   2506            {
   2507              zdoCBFunc[ZDO_CONCENTRATOR_IND_CBID]( (void*)&conInd );
   \   000041                ; Setup parameters for indirect call
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   90....       MOV     DPTR,#zdoCBFunc + 2
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   F8           MOV     R0,A
   \   000050   A3           INC     DPTR
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F583         MOV     DPH,A
   \   000054   8882         MOV     DPL,R0
   \   000056   12....       LCALL   ?CALL_IND
   2508            }
   2509          }
   \                     ??ZDO_ConcentratorIndicationCB_0:
   \   000059   7405         MOV     A,#0x5
   \   00005B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005E   7F03         MOV     R7,#0x3
   \   000060   02....       LJMP    ?BANKED_LEAVE_XDATA
   2510          
   2511          /*********************************************************************
   2512           * @fn          ZDO_LeaveCnf
   2513           *
   2514           * @brief       This function allows the next higher layer to be
   2515           *              notified of the results of its request for this or
   2516           *              a child device to leave the network.
   2517           *
   2518           * @param       cnf - NLME_LeaveCnf_t
   2519           *
   2520           * @return      none
   2521           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2522          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2523          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2524            // Check for this device
   2525            if ( osal_ExtAddrEqual( cnf->extAddr,
   2526                                    NLME_GetExtAddr() ) == TRUE )
   \   000009                ; Setup parameters for call to function sAddrExtCmp
   \   000009                ; Setup parameters for call to function NLME_GetExtAddr
   \   000009   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000C   EA           MOV     A,R2
   \   00000D   FC           MOV     R4,A
   \   00000E   EB           MOV     A,R3
   \   00000F   FD           MOV     R5,A
   \   000010   EE           MOV     A,R6
   \   000011   2402         ADD     A,#0x2
   \   000013   FA           MOV     R2,A
   \   000014   EF           MOV     A,R7
   \   000015   3400         ADDC    A,#0x0
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??sAddrExtCmp?relay
   \   00001B   E9           MOV     A,R1
   \   00001C   6401         XRL     A,#0x1
   \   00001E   7037         JNZ     ??ZDO_LeaveCnf_0
   2527            {
   2528              // Pass the leave confirm to higher layer if callback registered
   2529              if ( ( zdoCBFunc[ZDO_LEAVE_CNF_CBID] == NULL ) ||
   2530                   ( (*zdoCBFunc[ZDO_LEAVE_CNF_CBID])( cnf ) == NULL ) )
   \   000020   90....       MOV     DPTR,#zdoCBFunc + 10
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F8           MOV     R0,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F9           MOV     R1,A
   \   000028   E8           MOV     A,R0
   \   000029   49           ORL     A,R1
   \   00002A   601C         JZ      ??ZDO_LeaveCnf_1
   \   00002C                ; Setup parameters for indirect call
   \   00002C   EE           MOV     A,R6
   \   00002D   FA           MOV     R2,A
   \   00002E   EF           MOV     A,R7
   \   00002F   FB           MOV     R3,A
   \   000030   90....       MOV     DPTR,#zdoCBFunc + 10
   \   000033   E0           MOVX    A,@DPTR
   \   000034   F8           MOV     R0,A
   \   000035   A3           INC     DPTR
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F583         MOV     DPH,A
   \   000039   8882         MOV     DPL,R0
   \   00003B   12....       LCALL   ?CALL_IND
   \   00003E   8A..         MOV     ?V0 + 0,R2
   \   000040   8B..         MOV     ?V0 + 1,R3
   \   000042   E5..         MOV     A,?V0 + 0
   \   000044   45..         ORL     A,?V0 + 1
   \   000046   700F         JNZ     ??ZDO_LeaveCnf_0
   2531              {
   2532                // Prepare to leave with reset
   2533                ZDApp_LeaveReset( cnf->rejoin );
   \                     ??ZDO_LeaveCnf_1:
   \   000048                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000048   EE           MOV     A,R6
   \   000049   240B         ADD     A,#0xb
   \   00004B   F582         MOV     DPL,A
   \   00004D   EF           MOV     A,R7
   \   00004E   3400         ADDC    A,#0x0
   \   000050   F583         MOV     DPH,A
   \   000052   E0           MOVX    A,@DPTR
   \   000053   F9           MOV     R1,A
   \   000054   12....       LCALL   ??ZDApp_LeaveReset?relay
   2534              }
   2535            }
   2536            else if ( ZSTACK_ROUTER_BUILD )
   2537            {
   2538              // Remove device address(optionally descendents) from data
   2539              ZDApp_LeaveUpdate( cnf->dstAddr,
   2540                                 cnf->extAddr,
   2541                                 cnf->removeChildren );
   2542            }
   2543          }
   \                     ??ZDO_LeaveCnf_0:
   \   000057   7F02         MOV     R7,#0x2
   \   000059   02....       LJMP    ?BANKED_LEAVE_XDATA
   2544          
   2545          /*********************************************************************
   2546           * @fn          ZDO_LeaveInd
   2547           *
   2548           * @brief       This function allows the next higher layer of a
   2549           *              device to be notified of a remote leave request or
   2550           *              indication.
   2551           *
   2552           * @param       ind - NLME_LeaveInd_t
   2553           *
   2554           * @return      none
   2555           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2556          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2557          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2558            uint8 leave;
   2559          
   2560          
   2561            // Parent is requesting the leave - NWK layer filters out illegal
   2562            // requests
   2563            if ( ind->request == TRUE )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   6401         XRL     A,#0x1
   \   00001A   7011         JNZ     ??ZDO_LeaveInd_0
   2564            {
   2565              // Notify network of leave
   2566              if ( ZSTACK_ROUTER_BUILD )
   2567              {
   2568                NLME_LeaveRsp_t rsp;
   2569                rsp.rejoin         = ind->rejoin;
   2570                rsp.removeChildren = ind->removeChildren;
   2571                NLME_LeaveRsp( &rsp );
   2572              }
   2573          
   2574              // Prepare to leave with reset
   2575              ZDApp_LeaveReset( ind->rejoin );
   \   00001C                ; Setup parameters for call to function ZDApp_LeaveReset
   \   00001C   EE           MOV     A,R6
   \   00001D   240C         ADD     A,#0xc
   \   00001F   F582         MOV     DPL,A
   \   000021   EF           MOV     A,R7
   \   000022   3400         ADDC    A,#0x0
   \   000024   F583         MOV     DPH,A
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F9           MOV     R1,A
   \   000028   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00002B   8074         SJMP    ??ZDO_LeaveInd_1
   2576            }
   2577            else
   2578            {
   2579              leave = FALSE;
   \                     ??ZDO_LeaveInd_0:
   \   00002D   75..00       MOV     ?V0 + 0,#0x0
   2580          
   2581              // Check if this device needs to leave as a child or descendent
   2582              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \   000030   8E82         MOV     DPL,R6
   \   000032   8F83         MOV     DPH,R7
   \   000034   C082         PUSH    DPL
   \   000036   C083         PUSH    DPH
   \   000038                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000038   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   00003B   8A..         MOV     ?V0 + 2,R2
   \   00003D   8B..         MOV     ?V0 + 3,R3
   \   00003F   D083         POP     DPH
   \   000041   D082         POP     DPL
   \   000043   E0           MOVX    A,@DPTR
   \   000044   65..         XRL     A,?V0 + 2
   \   000046   7004         JNZ     ??ZDO_LeaveInd_2
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   65..         XRL     A,?V0 + 3
   \                     ??ZDO_LeaveInd_2:
   \   00004C   701C         JNZ     ??ZDO_LeaveInd_3
   2583              {
   2584                if ( ( ind->removeChildren == TRUE               ) ||
   2585                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2586                       NODETYPE_DEVICE                           )    )
   \   00004E   EE           MOV     A,R6
   \   00004F   240B         ADD     A,#0xb
   \   000051   F582         MOV     DPL,A
   \   000053   EF           MOV     A,R7
   \   000054   3400         ADDC    A,#0x0
   \   000056   F583         MOV     DPH,A
   \   000058   E0           MOVX    A,@DPTR
   \   000059   6401         XRL     A,#0x1
   \   00005B   600A         JZ      ??ZDO_LeaveInd_4
   \   00005D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000060   E0           MOVX    A,@DPTR
   \   000061   5407         ANL     A,#0x7
   \   000063   6402         XRL     A,#0x2
   \   000065   7003         JNZ     ??ZDO_LeaveInd_3
   2587                {
   2588                  leave = TRUE;
   \                     ??ZDO_LeaveInd_4:
   \   000067   75..01       MOV     ?V0 + 0,#0x1
   2589                }
   2590              }
   2591              else if ( ind->removeChildren == TRUE )
   2592              {
   2593                // Check NWK address allocation algorithm
   2594                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2595              }
   2596          
   2597              if ( leave == TRUE )
   \                     ??ZDO_LeaveInd_3:
   \   00006A   7401         MOV     A,#0x1
   \   00006C   65..         XRL     A,?V0 + 0
   \   00006E   7011         JNZ     ??ZDO_LeaveInd_5
   2598              {
   2599                // Prepare to leave with reset
   2600                ZDApp_LeaveReset( ind->rejoin );
   \   000070                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000070   EE           MOV     A,R6
   \   000071   240C         ADD     A,#0xc
   \   000073   F582         MOV     DPL,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   F583         MOV     DPH,A
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   F9           MOV     R1,A
   \   00007C   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00007F   8020         SJMP    ??ZDO_LeaveInd_1
   2601              }
   2602              else
   2603              {
   2604                // Remove device address(optionally descendents) from data
   2605                ZDApp_LeaveUpdate( ind->srcAddr,
   2606                                   ind->extAddr,
   2607                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_5:
   \   000081                ; Setup parameters for call to function ZDApp_LeaveUpdate
   \   000081   EE           MOV     A,R6
   \   000082   240B         ADD     A,#0xb
   \   000084   F582         MOV     DPL,A
   \   000086   EF           MOV     A,R7
   \   000087   3400         ADDC    A,#0x0
   \   000089   F583         MOV     DPH,A
   \   00008B   E0           MOVX    A,@DPTR
   \   00008C   F9           MOV     R1,A
   \   00008D   EE           MOV     A,R6
   \   00008E   2402         ADD     A,#0x2
   \   000090   FC           MOV     R4,A
   \   000091   EF           MOV     A,R7
   \   000092   3400         ADDC    A,#0x0
   \   000094   FD           MOV     R5,A
   \   000095   8E82         MOV     DPL,R6
   \   000097   8F83         MOV     DPH,R7
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   FA           MOV     R2,A
   \   00009B   A3           INC     DPTR
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   FB           MOV     R3,A
   \   00009E   12....       LCALL   ??ZDApp_LeaveUpdate?relay
   2608              }
   2609            }
   2610          
   2611            // Pass the leave indication to higher layer if callback registered.
   2612            if (zdoCBFunc[ZDO_LEAVE_IND_CBID] != NULL)
   \                     ??ZDO_LeaveInd_1:
   \   0000A1   90....       MOV     DPTR,#zdoCBFunc + 12
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   F8           MOV     R0,A
   \   0000A6   A3           INC     DPTR
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   F9           MOV     R1,A
   \   0000A9   E8           MOV     A,R0
   \   0000AA   49           ORL     A,R1
   \   0000AB   601C         JZ      ??ZDO_LeaveInd_6
   2613            {
   2614              (void)zdoCBFunc[ZDO_LEAVE_IND_CBID](ind);
   \   0000AD                ; Setup parameters for indirect call
   \   0000AD   EE           MOV     A,R6
   \   0000AE   FA           MOV     R2,A
   \   0000AF   EF           MOV     A,R7
   \   0000B0   FB           MOV     R3,A
   \   0000B1   90....       MOV     DPTR,#zdoCBFunc + 12
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   F8           MOV     R0,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   F583         MOV     DPH,A
   \   0000BA   8882         MOV     DPL,R0
   \   0000BC   12....       LCALL   ?CALL_IND
   \   0000BF   8A..         MOV     ?V0 + 2,R2
   \   0000C1   8B..         MOV     ?V0 + 3,R3
   \   0000C3   85..82       MOV     DPL,?V0 + 2
   \   0000C6   85..83       MOV     DPH,?V0 + 3
   2615            }
   2616          }
   \                     ??ZDO_LeaveInd_6:
   \   0000C9   7F04         MOV     R7,#0x4
   \   0000CB   02....       LJMP    ?BANKED_LEAVE_XDATA
   2617          
   2618          /*********************************************************************
   2619           * @fn          ZDO_SyncIndicationCB
   2620           *
   2621           * @brief       This function allows the next higher layer of a
   2622           *              coordinator to be notified of a loss of synchronization
   2623           *                          with the parent/child device.
   2624           *
   2625           * @param       type: 0 - child; 1 - parent
   2626           *
   2627           *
   2628           * @return      none
   2629           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2630          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2631          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
   2632            (void)shortAddr;  // Remove this line if this parameter is used.
   2633          
   2634            if ( ZSTACK_END_DEVICE_BUILD
   2635              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityFlags & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   2636            {
   2637              if ( type == 1 )
   \   00000B   7401         MOV     A,#0x1
   \   00000D   65..         XRL     A,?V0 + 0
   \   00000F   7013         JNZ     ??ZDO_SyncIndicationCB_0
   2638              {
   2639                // We lost contact with our parent.  Clear the neighbor Table.
   2640                nwkNeighborInitTable();
   \   000011                ; Setup parameters for call to function nwkNeighborInitTable
   \   000011   12....       LCALL   ??nwkNeighborInitTable?relay
   2641          
   2642                // Start the rejoin process.
   2643                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   000014                ; Setup parameters for call to function ZDApp_SendMsg
   \   000014   7C00         MOV     R4,#0x0
   \   000016   7D00         MOV     R5,#0x0
   \   000018   7B02         MOV     R3,#0x2
   \   00001A   7A03         MOV     R2,#0x3
   \   00001C   90....       MOV     DPTR,#ZDAppTaskID
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F9           MOV     R1,A
   \   000021   12....       LCALL   ??ZDApp_SendMsg?relay
   2644              }
   2645            }
   2646          }
   \                     ??ZDO_SyncIndicationCB_0:
   \   000024   7F01         MOV     R7,#0x1
   \   000026   02....       LJMP    ?BANKED_LEAVE_XDATA
   2647          
   2648          /*********************************************************************
   2649           * @fn          ZDO_ManytoOneFailureIndicationCB
   2650           *
   2651           * @brief       This function allows the next higher layer of a
   2652           *              concentrator to be notified of a many-to-one route
   2653           *              failure.
   2654           *
   2655           * @param       none
   2656           *
   2657           *
   2658           * @return      none
   2659           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2660          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2661          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2662            // By default, the concentrator automatically redo many-to-one route
   2663            // discovery to update all many-to-one routes in the network
   2664            // If you want anything processing other than the default,
   2665            // please replace the following code.
   2666          
   2667            RTG_MTORouteReq();
   \   000004                ; Setup parameters for call to function RTG_MTORouteReq
   \   000004   12....       LCALL   ??RTG_MTORouteReq?relay
   2668          }
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
   2669          
   2670          /*********************************************************************
   2671           * @fn          ZDO_PollConfirmCB
   2672           *
   2673           * @brief       This function allows the next higher layer to be
   2674           *              notified of a Poll Confirm.
   2675           *
   2676           * @param       none
   2677           *
   2678           * @return      none
   2679           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2680          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2681          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2682            (void)status;  // Remove this line if this parameter is used.
   2683            return;
   \   000000   02....       LJMP    ?BRET
   2684          }
   2685          
   2686          /******************************************************************************
   2687           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2688           *
   2689           * @brief       Stub routine implemented by NHLE. NHLE should call
   2690           *              <AddrMgrWriteNV> when appropriate.
   2691           *
   2692           * @param       none
   2693           *
   2694           * @return      none
   2695           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2696          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2697          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2698          #if defined ( NV_RESTORE )
   2699            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   2700            {
   2701              // Trigger to save info into NV
   2702              ZDApp_NVUpdate();
   2703            }
   2704          #endif
   2705          }
   \   000000   02....       LJMP    ?BRET
   2706          
   2707          /*********************************************************************
   2708           * Call Back Functions from Security  - API
   2709           */
   2710          
   2711           /*********************************************************************
   2712           * @fn          ZDO_UpdateDeviceIndication
   2713           *
   2714           * @brief       This function notifies the "Trust Center" of a
   2715           *              network when a device joins or leaves the network.
   2716           *
   2717           * @param       extAddr - pointer to 64 bit address of new device
   2718           * @param       status  - 0 if a new device joined securely
   2719           *                      - 1 if a new device joined un-securely
   2720           *                      - 2 if a device left the network
   2721           *
   2722           * @return      true if newly joined device should be allowed to
   2723           *                                              remain on network
   2724           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2725          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2726          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   \   000000   E9           MOV     A,R1
   \   000001   F8           MOV     R0,A
   2727            // can implement a network access policy based on the
   2728            // IEEE address of newly joining devices...
   2729            (void)extAddr;
   2730            (void)status;
   2731          
   2732            return ZSuccess;
   \   000002   7900         MOV     R1,#0x0
   \   000004   02....       LJMP    ?BRET
   2733          }
   2734          
   2735          /*********************************************************************
   2736           * @fn          ZDApp_InMsgCB
   2737           *
   2738           * @brief       This function is called to pass up any message that is
   2739           *              not yet supported.  This allows for the developer to
   2740           *              support features themselves..
   2741           *
   2742           * @return      none
   2743           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2744          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2745          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2746            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \   000009   EE           MOV     A,R6
   \   00000A   240C         ADD     A,#0xc
   \   00000C   F582         MOV     DPL,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F583         MOV     DPH,A
   \   000013   E0           MOVX    A,@DPTR
   \   000014   5400         ANL     A,#0x0
   \   000016   F8           MOV     R0,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   5480         ANL     A,#0x80
   \   00001B   F9           MOV     R1,A
   \   00001C   E8           MOV     A,R0
   \   00001D   49           ORL     A,R1
   \   00001E   7071         JNZ     ??ZDApp_InMsgCB_0
   2747            {
   2748              // Handle the response message
   2749            }
   2750            else
   2751            {
   2752              // Handle the request message by sending a generic "not supported".
   2753              // Device Announce doesn't have a response.
   2754              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000020   EE           MOV     A,R6
   \   000021   240B         ADD     A,#0xb
   \   000023   F582         MOV     DPL,A
   \   000025   EF           MOV     A,R7
   \   000026   3400         ADDC    A,#0x0
   \   000028   F583         MOV     DPH,A
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   7064         JNZ     ??ZDApp_InMsgCB_0
   \   00002D   EE           MOV     A,R6
   \   00002E   240C         ADD     A,#0xc
   \   000030   F582         MOV     DPL,A
   \   000032   EF           MOV     A,R7
   \   000033   3400         ADDC    A,#0x0
   \   000035   F583         MOV     DPH,A
   \   000037   E0           MOVX    A,@DPTR
   \   000038   6413         XRL     A,#0x13
   \   00003A   7004         JNZ     ??ZDApp_InMsgCB_1
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   6400         XRL     A,#0x0
   \                     ??ZDApp_InMsgCB_1:
   \   000040   604F         JZ      ??ZDApp_InMsgCB_0
   2755              {
   2756                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2757                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   000042                ; Setup parameters for call to function ZDP_GenericRsp
   \   000042   EE           MOV     A,R6
   \   000043   240C         ADD     A,#0xc
   \   000045   F582         MOV     DPL,A
   \   000047   EF           MOV     A,R7
   \   000048   3400         ADDC    A,#0x0
   \   00004A   F583         MOV     DPH,A
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   4400         ORL     A,#0x0
   \   00004F   F5..         MOV     ?V0 + 0,A
   \   000051   A3           INC     DPTR
   \   000052   E0           MOVX    A,@DPTR
   \   000053   4480         ORL     A,#0x80
   \   000055   F5..         MOV     ?V0 + 1,A
   \   000057   78..         MOV     R0,#?V0 + 0
   \   000059   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005C   E4           CLR     A
   \   00005D   F5..         MOV     ?V0 + 0,A
   \   00005F   F5..         MOV     ?V0 + 1,A
   \   000061   78..         MOV     R0,#?V0 + 0
   \   000063   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000066   EE           MOV     A,R6
   \   000067   240E         ADD     A,#0xe
   \   000069   F582         MOV     DPL,A
   \   00006B   EF           MOV     A,R7
   \   00006C   3400         ADDC    A,#0x0
   \   00006E   F583         MOV     DPH,A
   \   000070   E0           MOVX    A,@DPTR
   \   000071   FD           MOV     R5,A
   \   000072   7C84         MOV     R4,#-0x7c
   \   000074   EE           MOV     A,R6
   \   000075   2402         ADD     A,#0x2
   \   000077   FA           MOV     R2,A
   \   000078   EF           MOV     A,R7
   \   000079   3400         ADDC    A,#0x0
   \   00007B   FB           MOV     R3,A
   \   00007C   EE           MOV     A,R6
   \   00007D   240F         ADD     A,#0xf
   \   00007F   F582         MOV     DPL,A
   \   000081   EF           MOV     A,R7
   \   000082   3400         ADDC    A,#0x0
   \   000084   F583         MOV     DPH,A
   \   000086   E0           MOVX    A,@DPTR
   \   000087   F9           MOV     R1,A
   \   000088   12....       LCALL   ??ZDP_GenericRsp?relay
   \   00008B   7404         MOV     A,#0x4
   \   00008D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000090   E9           MOV     A,R1
   2758              }
   2759            }
   2760          }
   \                     ??ZDApp_InMsgCB_0:
   \   000091   7F02         MOV     R7,#0x2
   \   000093   02....       LJMP    ?BANKED_LEAVE_XDATA
   2761          
   2762          
   2763          /*********************************************************************
   2764           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2765           *
   2766           * @brief   Changes the Match Descriptor Response permission.
   2767           *
   2768           * @param   endpoint - endpoint to allow responses
   2769           * @param   action - true to allow responses, false to not
   2770           *
   2771           * @return  none
   2772           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2773          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2774          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FF           MOV     R7,A
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   2775            // Store the action
   2776            afSetMatch( endpoint, action );
   \   000009                ; Setup parameters for call to function afSetMatch
   \   000009   FA           MOV     R2,A
   \   00000A   EF           MOV     A,R7
   \   00000B   F9           MOV     R1,A
   \   00000C   12....       LCALL   ??afSetMatch?relay
   \   00000F   E9           MOV     A,R1
   2777          }
   \   000010   7F01         MOV     R7,#0x1
   \   000012   02....       LJMP    ?BANKED_LEAVE_XDATA
   2778          
   2779          /*********************************************************************
   2780           * @fn      ZDApp_NetworkInit()
   2781           *
   2782           * @brief   Used to start the network joining process
   2783           *
   2784           * @param   delay - mSec delay to wait before starting
   2785           *
   2786           * @return  none
   2787           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2788          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2789          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2790            if ( delay )
   \   000009   EE           MOV     A,R6
   \   00000A   4F           ORL     A,R7
   \   00000B   6013         JZ      ??ZDApp_NetworkInit_0
   2791            {
   2792              // Wait awhile before starting the device
   2793              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   00000D                ; Setup parameters for call to function osal_start_timerEx
   \   00000D   EE           MOV     A,R6
   \   00000E   FC           MOV     R4,A
   \   00000F   EF           MOV     A,R7
   \   000010   FD           MOV     R5,A
   \   000011   7A01         MOV     R2,#0x1
   \   000013   7B00         MOV     R3,#0x0
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??osal_start_timerEx?relay
   \   00001D   E9           MOV     A,R1
   \   00001E   800D         SJMP    ??ZDApp_NetworkInit_1
   2794            }
   2795            else
   2796            {
   2797              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_0:
   \   000020                ; Setup parameters for call to function osal_set_event
   \   000020   7A01         MOV     R2,#0x1
   \   000022   7B00         MOV     R3,#0x0
   \   000024   90....       MOV     DPTR,#ZDAppTaskID
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F9           MOV     R1,A
   \   000029   12....       LCALL   ??osal_set_event?relay
   \   00002C   E9           MOV     A,R1
   2798            }
   2799          }
   \                     ??ZDApp_NetworkInit_1:
   \   00002D   7F01         MOV     R7,#0x1
   \   00002F   02....       LJMP    ?BANKED_LEAVE_XDATA
   2800          
   2801          /*********************************************************************
   2802           * @fn      ZDApp_NwkStateUpdateCB()
   2803           *
   2804           * @brief   This function notifies that this device's network
   2805           *          state info has been changed.
   2806           *
   2807           * @param   none
   2808           *
   2809           * @return  none
   2810           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2811          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2812          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2813            // Notify to save info into NV
   2814            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000005                ; Setup parameters for call to function osal_get_timeoutEx
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B02         MOV     R3,#0x2
   \   000009   90....       MOV     DPTR,#ZDAppTaskID
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??osal_get_timeoutEx?relay
   \   000011   8A..         MOV     ?V0 + 0,R2
   \   000013   8B..         MOV     ?V0 + 1,R3
   \   000015   E5..         MOV     A,?V0 + 0
   \   000017   45..         ORL     A,?V0 + 1
   \   000019   7003         JNZ     ??ZDApp_NwkStateUpdateCB_0
   2815            {
   2816              // Trigger to save info into NV
   2817              ZDApp_NVUpdate();
   \   00001B                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00001B   12....       LCALL   ??ZDApp_NVUpdate?relay
   2818            }
   2819          }
   \                     ??ZDApp_NwkStateUpdateCB_0:
   \   00001E   7F02         MOV     R7,#0x2
   \   000020   02....       LJMP    ?BANKED_LEAVE_XDATA
   2820          
   2821          /*********************************************************************
   2822           * @fn      ZDApp_NodeProfileSync()
   2823           *
   2824           * @brief   Sync node with stack profile.
   2825           *
   2826           * @param   stackProfile - stack profile of the network to join
   2827           *
   2828           * @return  none
   2829           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2830          void ZDApp_NodeProfileSync( uint8 stackProfile )
   \                     ZDApp_NodeProfileSync:
   2831          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2832            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000007   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5021         JNC     ??ZDApp_NodeProfileSync_0
   2833            {
   2834              if ( stackProfile != zgStackProfile )
   \   00000F   90....       MOV     DPTR,#zgStackProfile
   \   000012   E0           MOVX    A,@DPTR
   \   000013   6E           XRL     A,R6
   \   000014   601A         JZ      ??ZDApp_NodeProfileSync_0
   2835              {
   2836                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000016   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   54F8         ANL     A,#0xf8
   \   00001C   4402         ORL     A,#0x2
   \   00001E   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000021   F0           MOVX    @DPTR,A
   2837                ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   000022   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000025   740C         MOV     A,#0xc
   \   000027   F0           MOVX    @DPTR,A
   2838                NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000028                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000028   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F9           MOV     R1,A
   \   00002D   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2839              }
   2840            }
   2841          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000030   7F01         MOV     R7,#0x1
   \   000032   02....       LJMP    ?BANKED_LEAVE_XDATA
   2842          
   2843          /*********************************************************************
   2844           * @fn      ZDApp_StartJoiningCycle()
   2845           *
   2846           * @brief   Starts the joining cycle of a device.  This will only
   2847           *          continue an already started (or stopped) joining cycle.
   2848           *
   2849           * @param   none
   2850           *
   2851           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2852           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2853          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2854          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2855            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6008         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6402         XRL     A,#0x2
   \   000012   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2856            {
   2857              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000014   90....       MOV     DPTR,#continueJoining
   \   000017   7401         MOV     A,#0x1
   \   000019   F0           MOVX    @DPTR,A
   2858              ZDApp_NetworkInit( 0 );
   \   00001A                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00001A   7A00         MOV     R2,#0x0
   \   00001C   7B00         MOV     R3,#0x0
   \   00001E   12....       LCALL   ??ZDApp_NetworkInit?relay
   2859          
   2860              return ( TRUE );
   \   000021   7901         MOV     R1,#0x1
   \   000023   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2861            }
   2862            else
   2863              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000025   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000027   D083         POP     DPH
   \   000029   D082         POP     DPL
   \   00002B   02....       LJMP    ?BRET
   2864          }
   2865          
   2866          /*********************************************************************
   2867           * @fn      ZDApp_StopJoiningCycle()
   2868           *
   2869           * @brief   Stops the joining or rejoining process of a device.
   2870           *
   2871           * @param   none
   2872           *
   2873           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2874           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2875          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2876          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2877            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6008         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6402         XRL     A,#0x2
   \   000012   700A         JNZ     ??ZDApp_StopJoiningCycle_1
   2878            {
   2879              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000014   90....       MOV     DPTR,#continueJoining
   \   000017   7400         MOV     A,#0x0
   \   000019   F0           MOVX    @DPTR,A
   2880              return ( TRUE );
   \   00001A   7901         MOV     R1,#0x1
   \   00001C   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2881            }
   2882            else
   2883              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001E   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   000020   D083         POP     DPH
   \   000022   D082         POP     DPL
   \   000024   02....       LJMP    ?BRET
   2884          }
   2885          
   2886          /*********************************************************************
   2887           * @fn      ZDApp_AnnounceNewAddress()
   2888           *
   2889           * @brief   Send Device Announce and hold all transmissions for
   2890           *          new address timeout.
   2891           *
   2892           * @param   none
   2893           *
   2894           * @return  none
   2895           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2896          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   2897          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2898          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2899            // Turn off data request hold
   2900            APSME_HoldDataRequests( 0 );
   \   000005                ; Setup parameters for call to function APSME_HoldDataRequests
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B00         MOV     R3,#0x0
   \   000009   12....       LCALL   ??APSME_HoldDataRequests?relay
   2901          #endif
   2902          
   2903            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   2904                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   00000C                ; Setup parameters for call to function NLME_GetExtAddr
   \   00000C   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000F   8A..         MOV     ?V0 + 0,R2
   \   000011   8B..         MOV     ?V0 + 1,R3
   \   000013   AE..         MOV     R6,?V0 + 0
   \   000015   AF..         MOV     R7,?V0 + 1
   \   000017                ; Setup parameters for call to function NLME_GetShortAddr
   \   000017   12....       LCALL   ??NLME_GetShortAddr?relay
   \   00001A   8A..         MOV     ?V0 + 0,R2
   \   00001C   8B..         MOV     ?V0 + 1,R3
   \   00001E   AA..         MOV     R2,?V0 + 0
   \   000020   AB..         MOV     R3,?V0 + 1
   \   000022                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000022   75..00       MOV     ?V0 + 0,#0x0
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00002A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   F9           MOV     R1,A
   \   00002F   EE           MOV     A,R6
   \   000030   FC           MOV     R4,A
   \   000031   EF           MOV     A,R7
   \   000032   FD           MOV     R5,A
   \   000033   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   000036   7401         MOV     A,#0x1
   \   000038   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003B   E9           MOV     A,R1
   2905          
   2906          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2907            // Setup the timeout
   2908            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   \   00003C                ; Setup parameters for call to function APSME_HoldDataRequests
   \   00003C   7A00         MOV     R2,#0x0
   \   00003E   7B00         MOV     R3,#0x0
   \   000040   12....       LCALL   ??APSME_HoldDataRequests?relay
   2909          #endif
   2910          }
   \   000043   7F02         MOV     R7,#0x2
   \   000045   02....       LJMP    ?BANKED_LEAVE_XDATA
   2911          
   2912          /*********************************************************************
   2913           * @fn          ZDApp_NVUpdate
   2914           *
   2915           * @brief       Set the NV Update Timer.
   2916           *
   2917           * @param       none
   2918           *
   2919           * @return      none
   2920           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2921          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2922          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2923          #if defined ( NV_RESTORE )
   2924            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   2925          #endif
   2926          }
   \   000000   02....       LJMP    ?BRET
   2927          
   2928          /*********************************************************************
   2929           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2930           *
   2931           * @brief   Returns a PAN ID for the network layer to use during
   2932           *          a coordinator start and there is another network with
   2933           *          the intended PANID.
   2934           *
   2935           * @param   panid - the intended PAN ID
   2936           *
   2937           * @return  PANID to try
   2938           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2939          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2940          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2941            return ( panid + 1 );
   \   000000   EA           MOV     A,R2
   \   000001   2401         ADD     A,#0x1
   \   000003   FA           MOV     R2,A
   \   000004   EB           MOV     A,R3
   \   000005   3400         ADDC    A,#0x0
   \   000007   FB           MOV     R3,A
   \   000008   02....       LJMP    ?BRET
   2942          }
   2943          
   2944          /*********************************************************************
   2945           * @fn          ZDO_SrcRtgIndCB
   2946           *
   2947           * @brief       This function notifies the ZDO available src route record received.
   2948           *
   2949           * @param       srcAddr - source address of the source route
   2950           * @param       relayCnt - number of devices in the relay list
   2951           * @param       relayList - relay list of the source route
   2952           *
   2953           * @return      none
   2954           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2955          void ZDO_SrcRtgIndCB (uint16 srcAddr, uint8 relayCnt, uint16* pRelayList )
   \                     ZDO_SrcRtgIndCB:
   2956          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   89..         MOV     ?V0 + 2,R1
   \   000010   EC           MOV     A,R4
   \   000011   FE           MOV     R6,A
   \   000012   ED           MOV     A,R5
   \   000013   FF           MOV     R7,A
   2957            zdoSrcRtg_t srcRtg;
   2958          
   2959            srcRtg.srcAddr = srcAddr;
   \   000014   85..82       MOV     DPL,?XSP + 0
   \   000017   85..83       MOV     DPH,?XSP + 1
   \   00001A   E5..         MOV     A,?V0 + 0
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   E5..         MOV     A,?V0 + 1
   \   000020   F0           MOVX    @DPTR,A
   2960            srcRtg.relayCnt = relayCnt;
   \   000021   E5..         MOV     A,?V0 + 2
   \   000023   7402         MOV     A,#0x2
   \   000025   12....       LCALL   ?XSTACK_DISP0_8
   \   000028   E5..         MOV     A,?V0 + 2
   \   00002A   F0           MOVX    @DPTR,A
   2961            srcRtg.pRelayList = pRelayList;
   \   00002B   7403         MOV     A,#0x3
   \   00002D   12....       LCALL   ?XSTACK_DISP0_8
   \   000030   EE           MOV     A,R6
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   EF           MOV     A,R7
   \   000034   F0           MOVX    @DPTR,A
   2962          
   2963            if( zdoCBFunc[ZDO_SRC_RTG_IND_CBID] != NULL )
   \   000035   90....       MOV     DPTR,#zdoCBFunc
   \   000038   E0           MOVX    A,@DPTR
   \   000039   F8           MOV     R0,A
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   F9           MOV     R1,A
   \   00003D   E8           MOV     A,R0
   \   00003E   49           ORL     A,R1
   \   00003F   6018         JZ      ??ZDO_SrcRtgIndCB_0
   2964            {
   2965              zdoCBFunc[ZDO_SRC_RTG_IND_CBID]( (void*)&srcRtg );
   \   000041                ; Setup parameters for indirect call
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   90....       MOV     DPTR,#zdoCBFunc
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   F8           MOV     R0,A
   \   000050   A3           INC     DPTR
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F583         MOV     DPH,A
   \   000054   8882         MOV     DPL,R0
   \   000056   12....       LCALL   ?CALL_IND
   2966            }
   2967          }
   \                     ??ZDO_SrcRtgIndCB_0:
   \   000059   7405         MOV     A,#0x5
   \   00005B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005E   7F03         MOV     R7,#0x3
   \   000060   02....       LJMP    ?BANKED_LEAVE_XDATA
   2968          
   2969          /*********************************************************************
   2970           * @fn          ZDApp_InitZdoCBFunc
   2971           *
   2972           * @brief       Call this function to initialize zdoCBFunc[]
   2973           *
   2974           * @param       none
   2975           *
   2976           * @return      none
   2977           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2978          void ZDApp_InitZdoCBFunc( void )
   \                     ZDApp_InitZdoCBFunc:
   2979          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2980            uint8 i;
   2981          
   2982            for ( i=0; i< MAX_ZDO_CB_FUNC; i++ )
   \   000004   7B00         MOV     R3,#0x0
   \                     ??ZDApp_InitZdoCBFunc_0:
   \   000006   EB           MOV     A,R3
   \   000007   C3           CLR     C
   \   000008   9407         SUBB    A,#0x7
   \   00000A   502D         JNC     ??ZDApp_InitZdoCBFunc_1
   2983            {
   2984              zdoCBFunc[i] = NULL;
   \   00000C   EB           MOV     A,R3
   \   00000D   F8           MOV     R0,A
   \   00000E   7900         MOV     R1,#0x0
   \   000010   E8           MOV     A,R0
   \   000011   75F002       MOV     B,#0x2
   \   000014   A4           MUL     AB
   \   000015   C8           XCH     A,R0
   \   000016   AAF0         MOV     R2,B
   \   000018   75F000       MOV     B,#0x0
   \   00001B   A4           MUL     AB
   \   00001C   2A           ADD     A,R2
   \   00001D   FA           MOV     R2,A
   \   00001E   75F002       MOV     B,#0x2
   \   000021   E9           MOV     A,R1
   \   000022   A4           MUL     AB
   \   000023   2A           ADD     A,R2
   \   000024   F9           MOV     R1,A
   \   000025   74..         MOV     A,#zdoCBFunc & 0xff
   \   000027   28           ADD     A,R0
   \   000028   F582         MOV     DPL,A
   \   00002A   74..         MOV     A,#(zdoCBFunc >> 8) & 0xff
   \   00002C   39           ADDC    A,R1
   \   00002D   F583         MOV     DPH,A
   \   00002F   7400         MOV     A,#0x0
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   7400         MOV     A,#0x0
   \   000035   F0           MOVX    @DPTR,A
   2985            }
   \   000036   0B           INC     R3
   \   000037   80CD         SJMP    ??ZDApp_InitZdoCBFunc_0
   2986          }
   \                     ??ZDApp_InitZdoCBFunc_1:
   \   000039   D083         POP     DPH
   \   00003B   D082         POP     DPL
   \   00003D   02....       LJMP    ?BRET
   2987          
   2988          /*********************************************************************
   2989           * @fn          ZDO_RegisterForZdoCB
   2990           *
   2991           * @brief       Call this function to register the higher layer (for
   2992           *              example, the Application layer or MT layer) with ZDO
   2993           *              callbacks to get notified of some ZDO indication like
   2994           *              existence of a concentrator or receipt of a source
   2995           *              route record.
   2996           *
   2997           * @param       indID - ZDO Indication ID
   2998           * @param       pFn   - Callback function pointer
   2999           *
   3000           * @return      ZSuccess - successful, ZInvalidParameter if not
   3001           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3002          ZStatus_t ZDO_RegisterForZdoCB( uint8 indID, pfnZdoCb pFn )
   \                     ZDO_RegisterForZdoCB:
   3003          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FD           MOV     R5,A
   3004            // Check the range of the indication ID
   3005            if ( indID < MAX_ZDO_CB_FUNC )
   \   000006   ED           MOV     A,R5
   \   000007   C3           CLR     C
   \   000008   9407         SUBB    A,#0x7
   \   00000A   502C         JNC     ??ZDO_RegisterForZdoCB_0
   3006            {
   3007              zdoCBFunc[indID] = pFn;
   \   00000C   ED           MOV     A,R5
   \   00000D   F8           MOV     R0,A
   \   00000E   7900         MOV     R1,#0x0
   \   000010   E8           MOV     A,R0
   \   000011   75F002       MOV     B,#0x2
   \   000014   A4           MUL     AB
   \   000015   C8           XCH     A,R0
   \   000016   ACF0         MOV     R4,B
   \   000018   75F000       MOV     B,#0x0
   \   00001B   A4           MUL     AB
   \   00001C   2C           ADD     A,R4
   \   00001D   FC           MOV     R4,A
   \   00001E   75F002       MOV     B,#0x2
   \   000021   E9           MOV     A,R1
   \   000022   A4           MUL     AB
   \   000023   2C           ADD     A,R4
   \   000024   F9           MOV     R1,A
   \   000025   74..         MOV     A,#zdoCBFunc & 0xff
   \   000027   28           ADD     A,R0
   \   000028   F582         MOV     DPL,A
   \   00002A   74..         MOV     A,#(zdoCBFunc >> 8) & 0xff
   \   00002C   39           ADDC    A,R1
   \   00002D   F583         MOV     DPH,A
   \   00002F   EA           MOV     A,R2
   \   000030   F0           MOVX    @DPTR,A
   \   000031   A3           INC     DPTR
   \   000032   EB           MOV     A,R3
   \   000033   F0           MOVX    @DPTR,A
   3008              return ZSuccess;
   \   000034   7900         MOV     R1,#0x0
   \   000036   8002         SJMP    ??ZDO_RegisterForZdoCB_1
   3009            }
   3010          
   3011            return ZInvalidParameter;
   \                     ??ZDO_RegisterForZdoCB_0:
   \   000038   7902         MOV     R1,#0x2
   \                     ??ZDO_RegisterForZdoCB_1:
   \   00003A   D083         POP     DPH
   \   00003C   D082         POP     DPL
   \   00003E   02....       LJMP    ?BRET
   3012          }
   3013          
   3014          /*********************************************************************
   3015           * @fn          ZDO_DeregisterForZdoCB
   3016           *
   3017           * @brief       Call this function to de-register the higher layer (for
   3018           *              example, the Application layer or MT layer) with ZDO
   3019           *              callbacks to get notified of some ZDO indication like
   3020           *              existence of a concentrator or receipt of a source
   3021           *              route record.
   3022           *
   3023           * @param       indID - ZDO Indication ID
   3024           *
   3025           * @return      ZSuccess - successful, ZInvalidParameter if not
   3026           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3027          ZStatus_t ZDO_DeregisterForZdoCB( uint8 indID )
   \                     ZDO_DeregisterForZdoCB:
   3028          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FB           MOV     R3,A
   3029            // Check the range of the indication ID
   3030            if ( indID < MAX_ZDO_CB_FUNC )
   \   000006   EB           MOV     A,R3
   \   000007   C3           CLR     C
   \   000008   9407         SUBB    A,#0x7
   \   00000A   502E         JNC     ??ZDO_DeregisterForZdoCB_0
   3031            {
   3032              zdoCBFunc[indID] = NULL;
   \   00000C   EB           MOV     A,R3
   \   00000D   F8           MOV     R0,A
   \   00000E   7900         MOV     R1,#0x0
   \   000010   E8           MOV     A,R0
   \   000011   75F002       MOV     B,#0x2
   \   000014   A4           MUL     AB
   \   000015   C8           XCH     A,R0
   \   000016   AAF0         MOV     R2,B
   \   000018   75F000       MOV     B,#0x0
   \   00001B   A4           MUL     AB
   \   00001C   2A           ADD     A,R2
   \   00001D   FA           MOV     R2,A
   \   00001E   75F002       MOV     B,#0x2
   \   000021   E9           MOV     A,R1
   \   000022   A4           MUL     AB
   \   000023   2A           ADD     A,R2
   \   000024   F9           MOV     R1,A
   \   000025   74..         MOV     A,#zdoCBFunc & 0xff
   \   000027   28           ADD     A,R0
   \   000028   F582         MOV     DPL,A
   \   00002A   74..         MOV     A,#(zdoCBFunc >> 8) & 0xff
   \   00002C   39           ADDC    A,R1
   \   00002D   F583         MOV     DPH,A
   \   00002F   7400         MOV     A,#0x0
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   7400         MOV     A,#0x0
   \   000035   F0           MOVX    @DPTR,A
   3033              return ZSuccess;
   \   000036   7900         MOV     R1,#0x0
   \   000038   8002         SJMP    ??ZDO_DeregisterForZdoCB_1
   3034            }
   3035          
   3036            return ZInvalidParameter;
   \                     ??ZDO_DeregisterForZdoCB_0:
   \   00003A   7902         MOV     R1,#0x2
   \                     ??ZDO_DeregisterForZdoCB_1:
   \   00003C   D083         POP     DPH
   \   00003E   D082         POP     DPL
   \   000040   02....       LJMP    ?BRET
   3037          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devState>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....         DW ZDAppTaskID
   \   000003   0000         DW 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   F401         DW 500

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkDiscoveryReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkDiscoveryReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_JoinReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_JoinReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceConfigured?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceConfigured

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkDescListProcessing?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkDescListProcessing

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_beaconNotifyIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_beaconNotifyIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SrcRtgIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SrcRtgIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitZdoCBFunc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitZdoCBFunc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZdoCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_DeregisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_DeregisterForZdoCB
   3038          
   3039          /*********************************************************************
   3040          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0     24
     ZDAppCheckForHoldKey               0      0     12
     ZDAppDetermineDeviceType           2      0     14
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     25
       -> APSME_HoldDataRequests        0      0     20
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
       -> APSME_HoldDataRequests        0      0     20
     ZDApp_ChangeMatchDescRespPermission
                                        0      0      9
       -> afSetMatch                    0      0     18
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> ZDApp_NVUpdate                4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
       -> ZDApp_NVUpdate                4      0      0
     ZDApp_DeviceConfigured             0      0     16
       -> osal_nv_read                  0      0     32
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         0      0     12
       -> NLME_GetExtAddr               0      0     24
       -> ZDAppCheckForHoldKey          0      0     24
       -> ZDO_Init                      0      0     24
       -> afRegister                    0      0     24
       -> ZDOInitDevice                 0      0     24
       -> ZDOInitDevice                 0      0     24
       -> HalLedBlink                   0      0     24
       -> ZDApp_InitZdoCBFunc           0      0     24
       -> ZDApp_RegisterCBs             0      0     24
     ZDApp_InitUserDesc                 0      0     31
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_InitZdoCBFunc                2      0     12
     ZDApp_JoinReq                      0      0     24
       -> ZDApp_NodeProfileSync         0      0     32
       -> NLME_JoinRequest              0      0     40
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     28
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlReset               0      0     24
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlSet                 0      0     23
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             0      0     24
       -> ZDApp_LeaveCtrlReset          0      0     20
     ZDApp_LeaveReset                   0      0     21
       -> ZDApp_LeaveCtrlSet            0      0     18
       -> ZDApp_ResetTimerStart         0      0     18
     ZDApp_LeaveUpdate                  0      0     39
       -> ZDSecMgrDeviceRemoveByExtAddr
                                        0      0     48
       -> ZDSecMgrAddrClear             0      0     48
       -> osal_memcpy                   0      0     54
       -> RTG_RemoveRtgEntry            0      0     48
       -> nwkNeighborRemove             0      0     48
       -> AddrMgrWriteNVRequest         0      0     48
     ZDApp_NVUpdate                     0      0     14
     ZDApp_NetworkDiscoveryReq          0      0     12
       -> NLME_NetworkDiscoveryRequest
                                        0      0     24
     ZDApp_NetworkInit                  0      0     26
       -> osal_start_timerEx            0      0     18
       -> osal_set_event                0      0     18
     ZDApp_NetworkStartEvt              2      0      0
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     26
       -> NLME_SetBroadcastFilter       0      0     18
     ZDApp_NwkDescListProcessing        0      0     33
       -> nwk_getNwkDescList            0      0     32
       -> nwk_getNwkDescList            0      0     32
       -> nwk_ExtPANIDValid             0      0     32
       -> sAddrExtCmp                   0      0     32
     ZDApp_NwkStateUpdateCB             0      0     10
       -> osal_get_timeoutEx            0      0     20
       -> ZDApp_NVUpdate                0      0     20
     ZDApp_ProcessMsgCBs                0      0     50
       -> ZDO_ParseAddrRsp              0      0     66
       -> ZDO_UpdateAddrManager         0      0     66
       -> osal_mem_free                 0      0     66
       -> ZDO_ParseBindUnbindReq        0      0     66
       -> ZDO_ProcessBindUnbindReq      0      0     66
     ZDApp_ProcessNetworkJoin           0      0     29
       -> osal_set_event                0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> osal_set_event                0      0     24
     ZDApp_ProcessOSALMsg               0      0     35
       -> ZDP_IncomingData              0      0     34
       -> ZDApp_ProcessMsgCBs           0      0     34
       -> ZDApp_NwkDescListProcessing
                                        0      0     34
       -> ZDApp_NodeProfileSync         0      0     34
       -> NLME_JoinRequest              0      0     42
       -> osal_rand                     0      0     34
       -> ZDApp_NetworkInit             0      0     34
       -> osal_rand                     0      0     34
       -> ZMacSetReq                    0      0     34
       -> ZMacSetReq                    0      0     34
       -> ZMacSetReq                    0      0     34
       -> NLME_ReJoinRequest            0      0     34
       -> osal_rand                     0      0     34
       -> ZDApp_NetworkInit             0      0     34
       -> NLME_SetPollRate              0      0     34
       -> NLME_SetQueuedPollRate        0      0     34
       -> NLME_SetResponseRate          0      0     34
       -> osal_rand                     0      0     34
       -> ZDApp_NetworkInit             0      0     34
       -> ZDApp_ProcessNetworkJoin      0      0     34
       -> sAddrExtCpy                   0      0     34
       -> ZDApp_NetworkInit             0      0     34
     ZDApp_ProcessSecEvent              0      0      9
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
       -> ZDSecMgrSaveTCLinkKey         0      0     18
     ZDApp_ProcessSecMsg                0      0      9
       -> ZDSecMgrTransportKeyInd       0      0     18
       -> ZDSecMgrSwitchKeyInd          0      0     18
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0     12
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              0      0     18
       -> osal_start_timerEx            0      0     18
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                0      0     37
       -> osal_nv_read                  0      0     74
       -> osal_memset                   0      0     66
     ZDApp_SaveNetworkStateEvt          0      0     14
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
       -> osal_memset                   0      0     66
     ZDApp_SecInit                      0      0     23
       -> ZDSecMgrInit                  0      0     18
     ZDApp_SendEventMsg                 0      0     10
       -> ZDApp_SendMsg                 0      0     20
     ZDApp_SendMsg                      1      0     33
       -> osal_msg_allocate             0      0     32
       -> osal_memcpy                   0      0     38
       -> osal_msg_send                 0      0     32
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     14
       -> osal_msg_receive              0      0     28
       -> ZDApp_ProcessOSALMsg          0      0     28
       -> osal_msg_deallocate           0      0     28
       -> osal_set_event                0      0     28
       -> ZDO_StartDevice               0      0     28
       -> ZDO_UpdateNwkStatus           0      0     28
       -> osal_start_timerEx            0      0     28
       -> ZDApp_SaveNetworkStateEvt     0      0     28
       -> zgWriteStartupOptions         0      0     28
       -> Onboard_soft_reset            0      0     28
     ZDOInitDevice                      0      0     26
       -> zgInitItems                   0      0     28
       -> ZDConfig_InitDescriptors      0      0     28
       -> ZDAppDetermineDeviceType      0      0     28
       -> osal_rand                     0      0     28
       -> ZDApp_SecInit                 0      0     28
       -> ZDApp_LeaveCtrlInit           0      0     28
       -> ZDApp_LeaveCtrlStartup        0      0     28
       -> zgWriteStartupOptions         0      0     28
       -> osal_set_event                0      0     28
       -> ZDApp_NetworkInit             0      0     28
       -> NLME_SetBroadcastFilter       0      0     28
     ZDO_AddrChangeIndicationCB         0      0     14
       -> ZDApp_NVUpdate                0      0     28
       -> osal_set_event                0      0     28
       -> osal_msg_allocate             0      0     28
       -> osal_msg_send                 0      0     28
       -> ZDApp_AnnounceNewAddress      0      0     28
     ZDO_ConcentratorIndicationCB       1      0     16
     ZDO_DeregisterForZdoCB             2      0      0
     ZDO_JoinConfirmCB                  1      0     14
       -> HalLedSet                     0      0     28
       -> HalLedSet                     0      0     28
       -> ZDApp_NVUpdate                0      0     28
       -> ZDApp_SendMsg                 0      0     28
     ZDO_JoinIndicationCB               0      0     13
       -> ZDApp_NVUpdate                0      0     24
     ZDO_LeaveCnf                       0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> sAddrExtCmp                   0      0     20
       -> ZDApp_LeaveReset              0      0     20
     ZDO_LeaveInd                       2      0     12
       -> ZDApp_LeaveReset              0      0     24
       -> NLME_GetCoordShortAddr        4      0     24
       -> ZDApp_LeaveReset              0      0     24
       -> ZDApp_LeaveUpdate             0      0     24
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> RTG_MTORouteReq               4      0      0
     ZDO_NetworkDiscoveryConfirmCB      3      0      3
       -> ZDApp_SendMsg                 4      0      6
     ZDO_NetworkFormationConfirmCB      0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_PollConfirmCB                  0      0      0
     ZDO_RegisterForZdoCB               2      0      0
     ZDO_SrcRtgIndCB                    1      0     16
     ZDO_StartRouterConfirmCB           0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_SyncIndicationCB               0      0      9
       -> nwkNeighborInitTable          0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_UpdateDeviceIndication         0      0      0
     ZDO_beaconNotifyIndCB              1      0     16
       -> osal_mem_alloc                0      0     32
       -> osal_memset                   0      0     32
       -> sAddrExtCpy                   0      0     32
       -> osal_memset                   0      0     32


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     zdoCBFunc                                     14
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                   102
     ZDApp_SecInit                                 16
     ZDApp_event_loop                             241
     ZDApp_ProcessSecEvent                        143
     ZDOInitDevice                                211
     ZDApp_ReadNetworkRestoreState                 25
     ZDAppDetermineDeviceType                      98
     ZDApp_NetworkStartEvt                        123
     ZDApp_DeviceAuthEvt                           74
     ZDApp_SaveNetworkStateEvt                      3
     ZDApp_RestoreNetworkState                     86
     ZDApp_InitUserDesc                           138
     ZDAppCheckForHoldKey                           3
     ZDApp_ProcessOSALMsg                         651
     ZDApp_ProcessMsgCBs                          164
     ZDApp_RegisterCBs                             63
     ZDApp_ProcessSecMsg                           97
     ZDApp_ProcessNetworkJoin                     503
     ZDApp_SaveNwkKey                             125
     ZDApp_ResetNwkKey                             84
     ZDApp_RestoreNwkKey                          154
     ZDApp_ResetTimerStart                         31
     ZDApp_ResetTimerCancel                        24
     ZDApp_LeaveCtrlInit                           86
     ZDApp_LeaveCtrlSet                            69
     ZDApp_LeaveCtrlReset                          55
     ZDApp_LeaveCtrlBypass                         25
     ZDApp_LeaveCtrlStartup                        72
     ZDApp_LeaveReset                              23
     ZDApp_LeaveUpdate                            151
     ZDApp_NetworkDiscoveryReq                     32
     ZDApp_JoinReq                                 96
     ZDApp_DeviceConfigured                       101
     ZDApp_SendEventMsg                            34
     ZDApp_SendMsg                                113
     ZDO_NetworkDiscoveryConfirmCB                 98
     ZDApp_NwkDescListProcessing                  322
     ZDO_NetworkFormationConfirmCB                 61
     ZDO_beaconNotifyIndCB                        829
     ZDO_StartRouterConfirmCB                      61
     ZDO_JoinConfirmCB                            166
     ZDO_AddrChangeIndicationCB                   157
     ZDO_JoinIndicationCB                          33
     ZDO_ConcentratorIndicationCB                  99
     ZDO_LeaveCnf                                  92
     ZDO_LeaveInd                                 206
     ZDO_SyncIndicationCB                          41
     ZDO_ManytoOneFailureIndicationCB
                                                   14
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                          3
     ZDO_UpdateDeviceIndication                     7
     ZDApp_InMsgCB                                150
     ZDApp_ChangeMatchDescRespPermission
                                                   21
     ZDApp_NetworkInit                             50
     ZDApp_NwkStateUpdateCB                        35
     ZDApp_NodeProfileSync                         53
     ZDApp_StartJoiningCycle                       46
     ZDApp_StopJoiningCycle                        39
     ZDApp_AnnounceNewAddress                      72
     ZDApp_NVUpdate                                 3
     ZDApp_CoordStartPANIDConflictCB
                                                   11
     ZDO_SrcRtgIndCB                               99
     ZDApp_InitZdoCBFunc                           64
     ZDO_RegisterForZdoCB                          65
     ZDO_DeregisterForZdoCB                        67
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for devState>                    1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_1                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlReset?relay                   6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_NetworkDiscoveryReq?relay              6
     ??ZDApp_JoinReq?relay                          6
     ??ZDApp_DeviceConfigured?relay                 6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDApp_NwkDescListProcessing?relay            6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_beaconNotifyIndCB?relay                  6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6
     ??ZDO_SrcRtgIndCB?relay                        6
     ??ZDApp_InitZdoCBFunc?relay                    6
     ??ZDO_RegisterForZdoCB?relay                   6
     ??ZDO_DeregisterForZdoCB?relay                 6

 
 6 983 bytes in segment BANKED_CODE
   390 bytes in segment BANK_RELAYS
    11 bytes in segment XDATA_I
    11 bytes in segment XDATA_ID
     8 bytes in segment XDATA_ROM_C
    54 bytes in segment XDATA_Z
 
 7 384 bytes of CODE  memory
     0 bytes of CONST memory (+ 8 bytes shared)
    65 bytes of XDATA memory

Errors: none
Warnings: none
